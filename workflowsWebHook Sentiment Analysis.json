{"createdAt":"2025-04-15T14:01:34.769Z","updatedAt":"2025-04-22T01:10:48.000Z","id":"1FSEWJzgZSOoJh9W","name":"WebHook Sentiment Analysis","active":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"evaluate-tk","responseMode":"lastNode","options":{"responseContentType":"application/json"}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[180,0],"id":"864a2b50-fed9-43f2-9d49-c11d29858ba4","name":"Webhook","webhookId":"0811396b-fd2d-4383-85a3-b3182853788f"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Primero, logueamos la información completa para depuración:\nconsole.log(\"Datos del Webhook:\", $json);\n\n// Extraer el array body; si no existe o está vacío, retorna un mensaje predeterminado.\nconst dataArray = $json.body;\nif (!dataArray || !Array.isArray(dataArray) || dataArray.length === 0) {\n  return {\n    json: {\n      fullText: \"Mensaje no disponible\"\n    }\n  };\n}\n\n// Tomamos el primer registro del array\nconst record = dataArray[0];\nconsole.log(\"Registro extraído:\", record);\n\n// Extraer Datamessage del registro\nconst data = record.Datamessage;\n\n// Validar que Datamessage es un objeto válido\nif (!data || typeof data !== 'object') {\n  return {\n    json: {\n      CID: record.CID,\n      Customer: record.Customer,\n      caseID: record.caseID,\n      fullText: \"Mensaje no disponible\"\n    }\n  };\n}\n\n// Concatenar los valores de Datamessage con \";\" y salto de línea\nconst fullText = Object.values(data).map(line => `- ${line}`).join(\"\\n\");\n\n// Devolver el objeto con el mensaje unificado\nreturn {\n  json: {\n    CID: record.CID,\n    Customer: record.Customer,\n    caseID: record.caseID,\n    fullText\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[640,0],"id":"2ebd90d7-1011-45e0-89f9-c3d46c209a18","name":"Unir Mensajes"},{"parameters":{"jsCode":"// Muestra cada elemento recibido en la consola del servidor o en el log de n8n\nconsole.log(\"Recibido del Webhook:\", $input.all());\n\n// Retorna los datos tal cual para continuar el flujo\nreturn $input.all();\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[400,0],"id":"e6e9311f-758f-45a3-b7d9-5970988ac941","name":"Code"},{"parameters":{"inputText":"={{ $json.fullText }}","options":{}},"type":"@n8n/n8n-nodes-langchain.sentimentAnalysis","typeVersion":1,"position":[880,0],"id":"3b4c20ce-6d15-4dc2-8bc0-649c5d633c96","name":"Sentiment Analysis"},{"parameters":{"model":{"__rl":true,"value":"llama-8B-Instruct","mode":"list","cachedResultName":"llama-8B-Instruct"},"options":{"temperature":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[880,240],"id":"e8251c04-1634-4fef-88a9-7958c87e2143","name":"Ollama 8B Model","credentials":{"openAiApi":{"id":"S46eGA7oXnm2SZCZ","name":"OpenAi account 2"}}},{"parameters":{"assignments":{"assignments":[{"id":"9c9f95c5-6850-4f04-bb00-acf500596f17","name":"CID","value":"={{ $json.CID }}","type":"string"},{"id":"163957b2-6da8-4c45-ac2b-cc7eb1104a0e","name":"Customer","value":"={{ $json.Customer }}","type":"string"},{"id":"397dc5af-2df7-4144-8147-100ec80811ac","name":"caseID","value":"={{ $json.caseID }}","type":"string"},{"id":"576518c9-92f7-4701-ae23-ba4d2be3e5be","name":"sentiment","value":"={{ $json.sentimentAnalysis.category }}","type":"string"},{"id":"e514fa08-eb44-4678-b44f-c19b1392954a","name":"confidence","value":"={{ $json.confidence }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1320,-140],"id":"54e1bc9b-95ff-4a12-b4f7-df8fe155d7ff","name":"Edit Fields"}],"connections":{"Webhook":{"main":[[{"node":"Code","type":"main","index":0}]]},"Unir Mensajes":{"main":[[{"node":"Sentiment Analysis","type":"main","index":0}]]},"Code":{"main":[[{"node":"Unir Mensajes","type":"main","index":0}]]},"Ollama 8B Model":{"ai_languageModel":[[{"node":"Sentiment Analysis","type":"ai_languageModel","index":0}]]},"Sentiment Analysis":{"main":[[{"node":"Edit Fields","type":"main","index":0}],[{"node":"Edit Fields","type":"main","index":0}],[{"node":"Edit Fields","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"61e70b97-caa5-4c59-8ecd-de254c71eeb8","triggerCount":0,"tags":[]}