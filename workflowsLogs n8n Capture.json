{"createdAt":"2025-05-23T01:41:21.365Z","updatedAt":"2025-05-23T11:49:14.000Z","id":"QeQIj1WdMCizSR9I","name":"Logs n8n Capture","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"b0b06537-ed5b-474d-b1f7-789f17935028","name":"When clicking ‘Test workflow’"},{"parameters":{"command":"tail -n 4000 /home/node/.n8n/home/node/n8n/logs/n8n.log"},"type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[220,0],"id":"7c046629-e4fa-4479-83e9-5db74c4da47e","name":"Execute Command"},{"parameters":{"jsCode":"const output = [];\nconst logLines = $input.first().json.stdout.split('\\n').filter(line => line.trim());\n\nfor (const line of logLines) {\n  try {\n    const logData = JSON.parse(line);\n    const metadata = logData.metadata || {};\n    \n    output.push({\n      json: {\n        timestamp: metadata.timestamp ? new Date(metadata.timestamp) : null,\n        level: logData.level || null,\n        message: logData.message || null,\n        execution_id: metadata.executionId || null,\n        workflow_id: metadata.workflowId || null,\n        file: metadata.file || null,\n        function: metadata.function || null,\n        push_ref: metadata.pushRef || metadata.pushRefs || null,\n        data_type: metadata.dataType || null,\n      }\n    });\n  } catch (e) {\n    // Saltar líneas con JSON inválido\n  }\n}\n\nreturn output;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[440,0],"id":"4194d829-cfc0-44d7-8a75-3143a3ad6dcb","name":"Code"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[660,0],"id":"7d44c095-66f9-4c05-9381-4640b89082ea","name":"Loop Over Items"},{"parameters":{"schema":{"__rl":true,"value":"public","mode":"list","cachedResultName":"public"},"table":{"__rl":true,"value":"n8n_logs","mode":"list","cachedResultName":"n8n_logs"},"columns":{"mappingMode":"defineBelow","value":{"timestamp":"={{ $json.timestamp }}","level":"={{ $json.level }}","message":"={{ $json.message }}","execution_id":"={{ $json.execution_id }}","workflow_id":"={{ $json.workflow_id }}","node_name":"={{ $json.node_name }}","function":"={{ $json.function }}","file":"={{ $json.file }}","push_ref":"={{ $json.push_ref }}","data_type":"={{ $json.data_type }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"timestamp","displayName":"timestamp","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"level","displayName":"level","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"message","displayName":"message","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"execution_id","displayName":"execution_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"workflow_id","displayName":"workflow_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"node_name","displayName":"node_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"file","displayName":"file","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"function","displayName":"function","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"push_ref","displayName":"push_ref","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"data_type","displayName":"data_type","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[940,20],"id":"76294db3-038a-4bef-80a3-10bbd8a9b6f7","name":"Postgres","credentials":{"postgres":{"id":"brzMaPB6iJB9Pcyc","name":"Postgres n8n logs"}}}],"connections":{"When clicking ‘Test workflow’":{"main":[[{"node":"Execute Command","type":"main","index":0}]]},"Execute Command":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Postgres","type":"main","index":0}]]},"Postgres":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"d9e3d0ea-009e-4506-b31f-c8ece327a64c","triggerCount":0,"tags":[]}