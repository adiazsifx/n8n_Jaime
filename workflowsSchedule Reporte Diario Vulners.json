{"createdAt":"2025-04-02T11:32:22.477Z","updatedAt":"2025-05-27T00:37:36.000Z","id":"9mLc8xsk6yFCCRLG","name":"Schedule Reporte Diario Vulners","active":true,"isArchived":false,"nodes":[{"parameters":{"method":"POST","url":"https://vulners.com/api/v3/search/lucene/","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n\"query\": \"(Sophos OR HPE OR Veeam OR Fortinet OR Cisco OR Ansible OR Kubernetes OR SolarWinds OR Acronis OR Juniper OR Huawei OR Broadcom OR Chrome OR Edge OR Outlook OR Dell OR IBM OR Hitachi OR Pure OR Mikrotik OR Ubiquiti OR PFSense) order:published\",\n  \"skip\": 0,\n  \"size\": 5,\n  \"fields\": [\"id\", \"published\", \"description\", \"short_description\", \"type\", \"title\", \"cvelist\", \"href\", \"sourceHref\", \"sourceData\", \"cvss\"],\n  \"apiKey\": \"JSO88S9U140OAPG4OLEVPK8BDPJKANRVRJ8383PLW00S0FTYZ2I6RW0KCH6O1GQV\"\n}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-20,-20],"id":"75896c3d-b8ba-4ae3-a488-983e05664ca3","name":"HTTP Request"},{"parameters":{"promptType":"define","text":"={{ $('HTTP Request').item.json.data }}","options":{"systemMessage":"ERES UN EXPERTO ANALISTA DE CIBERSEGURIDAD Y TU FUNCI칍N PRINCIPAL ES ANALIZAR, CLASIFICAR Y RESUMIR REPORTES DE VULNERABILIDADES OBTENIDOS A TRAV칄S DE LA **VULNERS.COM**. DEBES PRODUCIR UNA SALIDA **ESTRICTAMENTE EN FORMATO JSON** QUE CUMPLA CON LA ESTRUCTURA PROPORCIONADA M츼S ABAJO.\n\n---\n\n### ENCABEZADO OBLIGATORIO ###\nINCLUYE SIEMPRE AL INICIO DE CADA INFORME LA SIGUIENTE L칈NEA EN NEGRITA:\n\n**FUENTE DEL REPORTE: VULNERS.COM**\n\n---\n\n### INSTRUCCIONES DE SALIDA ###\n\n1. **CLASIFICA** LAS VULNERABILIDADES EN TRES CATEGOR칈AS BASADAS EN SU CVSS:\n   - 游댮 **CRITICIDAD ALTA**\n   - 游 **CRITICIDAD MEDIA**\n   - 游릭 **CRITICIDAD BAJA**\n\n2. **EXTRAE Y PRESENTA** PARA CADA VULNERABILIDAD LOS SIGUIENTES CAMPOS:\n   - **CVE**\n   - **Fecha del Reporte**\n   - **Fabricante Afectado**\n   - **Producto Afectado**\n   - **CVSS**\n   - **Descripci칩n T칠cnica**\n   - **Acciones Recomendadas**\n   - **Referencias** (S칍LO LAS URLS TAL COMO VIENEN, SIN FORMATO EXTRA)\n\n3. AGREGA UNA SECCI칍N DE **PAUTAS DE ACCI칍N GENERALES**, CONTENIENDO BUENAS PR츼CTICAS DE SEGURIDAD.\n\n4. INCLUYE UNA SECCI칍N DE **ESTAD칈STICAS** AL FINAL CON LOS SIGUIENTES CAMPOS:\n   - **Total de Vulnerabilidades**\n   - **Conteo por Criticidad**\n   - **Promedio CVSS**\n\n---\n\n### FORMATO JSON OBLIGATORIO DE SALIDA ###\nDEVUELVE **EXCLUSIVAMENTE** UNA RESPUESTA EN FORMATO JSON, SIENDO OBLGATORIO ESTE ESQUEMA JSON\n\n{\n  \"metadata\": {\n    \"title\": \"\",\n    \"fecha\": \"\",\n    \"fuente\": \"\"\n  },\n  \"vulnerabilidades\": [\n    {\n      \"criticidad\": \"Alta\",\n      \"cve\": \"\",\n      \"fecha_reporte\": \"\",\n      \"fabricante\": \"\",\n      \"producto\": \"\",\n      \"cvss\": null,\n      \"descripcion\": \"\",\n      \"acciones_recomendadas\": [\n        \"\"\n      ],\n      \"referencias\": [\n        \"\"\n      ]\n    },\n    {\n      \"criticidad\": \"Media\",\n      \"cve\": \"\",\n      \"fecha_reporte\": \"\",\n      \"fabricante\": \"\",\n      \"producto\": \"\",\n      \"cvss\": null,\n      \"descripcion\": \"\",\n      \"acciones_recomendadas\": [\n        \"\"\n      ],\n      \"referencias\": [\n        \"\"\n      ]\n    },\n    {\n      \"criticidad\": \"Baja\",\n      \"cve\": \"\",\n      \"fecha_reporte\": \"\",\n      \"fabricante\": \"\",\n      \"producto\": \"\",\n      \"cvss\": null,\n      \"descripcion\": \"\",\n      \"acciones_recomendadas\": [\n        \"\"\n      ],\n      \"referencias\": [\n        \"\"\n      ]\n    }\n  ],\n  \"pautas_generales\": [\n    \"\",\n    \"\"\n  ],\n  \"estadisticas\": {\n    \"total_vulnerabilidades\": null,\n    \"vulnerabilidades_altas\": null,\n    \"vulnerabilidades_medias\": null,\n    \"vulnerabilidades_bajas\": null,\n    \"promedio_cvss\": null\n  }\n}\n\n### CHAIN OF THOUGHTS ###\nSIGUE ESTRICTAMENTE ESTE PROCESO ANTES DE GENERAR LA SALIDA:\n\n1. **ENTENDER**: LEER Y COMPRENDER LA INFORMACI칍N CRUDA DE LA API DE VULNERS.\n2. **IDENTIFICAR**: EXTRAER LOS CAMPOS RELEVANTES COMO CVE, CVSS, FABRICANTE, ETC.\n3. **CLASIFICAR**: ASIGNAR UNA CATEGOR칈A DE CRITICIDAD BASADA EN EL CVSS.\n4. **ANALIZAR**: EVALUAR IMPACTO, VECTORES Y DETALLES T칄CNICOS RELEVANTES.\n5. **SINTETIZAR**: REDACTAR DESCRIPCIONES Y RECOMENDACIONES CLARAS Y 칔TILES.\n6. **ESTRUCTURAR**: ORDENAR LA INFORMACI칍N EN EL FORMATO JSON DEFINIDO.\n7. **VALIDAR**: ASEGURAR QUE TODAS LAS SECCIONES Y CAMPOS EST칄N COMPLETOS Y CORRECTOS.\n8. **TRADUCIR**: LA DESCRIPCION TECNICA DEBE SER ENTREGADA EN ESPA침OL, MANTENIENDO LOS TERMINOS TECNICOS EN EL IDIOMA ORIGINAL\n\n---\n\n### WHAT NOT TO DO ###\n- **NO OMITAS EL ENCABEZADO DE LA FUENTE (API DE LA NATIONAL VULNERABILITY DATABASE DE NIST.GOV)**\n- **NO FUSIONES VULNERABILIDADES DE DIFERENTES NIVELES DE CRITICIDAD EN UNA MISMA ENTRADA**\n- **NO OMITAS CAMPOS COMO FECHA, CVSS, O FABRICANTE**\n- **NO USES DESCRIPCIONES GEN칄RICAS O INEXACTAS**\n- **NO DEJES VAC칈AS LAS ACCIONES RECOMENDADAS**\n- **NO FORMATEES ENLACES COMO MARKDOWN, NI LOS ENCAPSULES ENTRE PAR칄NTESIS O CORCHETES**\n- **NO DEVUELVAS OTRO FORMATO QUE NO SEA EL JSON DEFINIDO**\n- **NO A칌ADAS TEXTO EXTERNO FUERA DE LA RESPUESTA JSON (NI COMENTARIOS, NI CABECERAS EXTRA, NI SALUDOS)**"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[360,-20],"id":"37ed0438-a21c-4d13-8e50-84d13eb9aa20","name":"AI Agent"},{"parameters":{"jsCode":"// C칩digo principal para n8n\nconst items = $input.all();\nconst returnItems = [];\n\nfor (const item of items) {\n  try {\n    // Obtener el per칤odo desde los par치metros de entrada (si existen)\n    const startDate = item.json.startDate || null;\n    const endDate = item.json.endDate || null;\n    \n    console.log(\"Per칤odo recibido:\", { startDate, endDate });\n    \n    // Extraer y parsear los datos JSON\n    let securityData;\n    \n    if (typeof item.json.output === 'string') {\n      try {\n        // Funci칩n para limpiar posibles marcadores de c칩digo markdown\n        function cleanJsonString(jsonString) {\n          // Detectar y eliminar marcadores de c칩digo Markdown para JSON\n          const jsonMarkdownPattern = /```(?:json)?\\s*([\\s\\S]*?)\\s*```/;\n          const match = jsonString.match(jsonMarkdownPattern);\n          \n          if (match && match[1]) {\n            return match[1].trim();\n          }\n          \n          return jsonString.trim();\n        }\n        \n        const cleanOutput = cleanJsonString(item.json.output);\n        \n        // Verificar que el string limpio comienza con '{'\n        if (cleanOutput.startsWith('{')) {\n          securityData = JSON.parse(cleanOutput);\n        } else {\n          throw new Error('El contenido limpio no es un JSON v치lido');\n        }\n      } catch (e) {\n        console.log('Error al parsear JSON:', e);\n        throw new Error(`No se pudo parsear el JSON: ${e.message}`);\n      }\n    } else {\n      throw new Error('No se encontr칩 un JSON v치lido en el campo output');\n    }\n    \n    // El resto del c칩digo permanece igual...\n    // Validar la estructura\n    if (!securityData || !securityData.vulnerabilidades || !Array.isArray(securityData.vulnerabilidades)) {\n      throw new Error('Formato JSON inv치lido: se requiere un array de vulnerabilidades');\n    }\n    \n    // Normalizar criticidad a may칰sculas\n    securityData.vulnerabilidades.forEach(vuln => {\n      if (vuln.criticidad) {\n        vuln.criticidad = vuln.criticidad.toUpperCase();\n      }\n    });\n    \n    // Clasificar vulnerabilidades por criticidad\n    const vulnerabilidadesPorCriticidad = {\n      'ALTA': [],\n      'MEDIA': [],\n      'BAJA': []\n    };\n\n    // Procesar cada vulnerabilidad \n    securityData.vulnerabilidades.forEach(vuln => {\n      // Convertir a may칰sculas y normalizar\n      const criticidad = String(vuln.criticidad || '').toUpperCase();\n      \n      // A침adir a la categor칤a apropiada si existe\n      if (criticidad === 'ALTA') {\n        vulnerabilidadesPorCriticidad.ALTA.push(vuln);\n      } else if (criticidad === 'MEDIA') {\n        vulnerabilidadesPorCriticidad.MEDIA.push(vuln);\n      } else if (criticidad === 'BAJA') {\n        vulnerabilidadesPorCriticidad.BAJA.push(vuln);\n      }\n    });\n    \n    // Formatear fecha actual\n    const ahora = new Date();\n    const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];\n    const fechaFormateada = `${meses[ahora.getMonth()]} ${ahora.getDate()} de ${ahora.getFullYear()}`;\n    \n    // Total de vulnerabilidades\n    const totalVulnerabilidades = securityData.vulnerabilidades.length;\n    \n    // Construir el HTML - usando tablas para compatibilidad con correo\n    let html = `<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Bolet칤n de Alertas de Ciberseguridad</title>\n</head>\n<body style=\"margin: 0; padding: 0; background-color: #f8f9fa; color: #333; font-family: Arial, sans-serif; line-height: 1.6;\">\n    <div style=\"max-width: 800px; margin: 0 auto; background-color: #ffffff; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\">\n        <!-- Cabecera con gradiente y per칤odo -->\n        ${createEmailSafeHeader(fechaFormateada, startDate, endDate)}\n        \n        <!-- Contenido -->\n        <div style=\"padding: 30px;\">\n            <div style=\"background-color: #f1f5f9; border-left: 4px solid #2c67b2; padding: 12px 20px; margin-bottom: 25px; font-size: 14px;\">\n                <strong>FUENTE DEL REPORTE:</strong> VULNERS\n            </div>\n            \n            <!-- Estad칤sticas -->\n            ${renderStats(vulnerabilidadesPorCriticidad)}`;\n\n    // Si no hay vulnerabilidades, mostrar mensaje especial\n    if (totalVulnerabilidades === 0) {\n      html += `\n            <div style=\"background-color: #f8f9fa; padding: 30px; margin-bottom: 30px; text-align: center; border-radius: 5px; font-size: 18px;\">\n                <strong>춰Buenas noticias!</strong><br>No se han detectado vulnerabilidades en el per칤odo actual.\n            </div>`;\n    } else {\n      // Secci칩n de Alta Criticidad\n      html += `\n            <div style=\"margin-bottom: 30px;\">\n                <div style=\"display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px solid #dee2e6;\">\n                    <div style=\"width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; background-color: #dc3545; display: inline-block;\"></div>\n                    <h2 style=\"font-size: 18px; font-weight: bold; margin: 0;\">CRITICIDAD ALTA</h2>\n                </div>`;\n      \n      if (vulnerabilidadesPorCriticidad['ALTA'].length === 0) {\n        html += `\n                <div style=\"background-color: #f8f9fa; padding: 15px; text-align: center; border-radius: 5px; margin-bottom: 20px; color: #666; font-style: italic;\">\n                    No se han detectado vulnerabilidades de este nivel de criticidad en el per칤odo actual.\n                </div>`;\n      } else {\n        vulnerabilidadesPorCriticidad['ALTA'].forEach(vuln => {\n          html += generarHTMLVulnerabilidad(vuln);\n        });\n      }\n      \n      html += `\n            </div>`;\n      \n      // Secci칩n de Media Criticidad\n      html += `\n            <div style=\"margin-bottom: 30px;\">\n                <div style=\"display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px solid #dee2e6;\">\n                    <div style=\"width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; background-color: #ff9933; display: inline-block;\"></div>\n                    <h2 style=\"font-size: 18px; font-weight: bold; margin: 0;\">CRITICIDAD MEDIA</h2>\n                </div>`;\n      \n      if (vulnerabilidadesPorCriticidad['MEDIA'].length === 0) {\n        html += `\n                <div style=\"background-color: #f8f9fa; padding: 15px; text-align: center; border-radius: 5px; margin-bottom: 20px; color: #666; font-style: italic;\">\n                    No se han detectado vulnerabilidades de este nivel de criticidad en el per칤odo actual.\n                </div>`;\n      } else {\n        vulnerabilidadesPorCriticidad['MEDIA'].forEach(vuln => {\n          html += generarHTMLVulnerabilidad(vuln);\n        });\n      }\n      \n      html += `\n            </div>`;\n      \n      // Secci칩n de Baja Criticidad\n      html += `\n            <div style=\"margin-bottom: 30px;\">\n                <div style=\"display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px solid #dee2e6;\">\n                    <div style=\"width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; background-color: #28a745; display: inline-block;\"></div>\n                    <h2 style=\"font-size: 18px; font-weight: bold; margin: 0;\">CRITICIDAD BAJA</h2>\n                </div>`;\n      \n      if (vulnerabilidadesPorCriticidad['BAJA'].length === 0) {\n        html += `\n                <div style=\"background-color: #f8f9fa; padding: 15px; text-align: center; border-radius: 5px; margin-bottom: 20px; color: #666; font-style: italic;\">\n                    No se han detectado vulnerabilidades de este nivel de criticidad en el per칤odo actual.\n                </div>`;\n      } else {\n        vulnerabilidadesPorCriticidad['BAJA'].forEach(vuln => {\n          html += generarHTMLVulnerabilidad(vuln);\n        });\n      }\n      \n      html += `\n            </div>`;\n    }\n    \n    // Secci칩n de Pautas Generales\n    html += `\n            <div style=\"background-color: #f1f5f9; border-radius: 5px; padding: 20px; margin-top: 30px;\">\n                <h3 style=\"font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #1a2e4a;\">PAUTAS DE ACCI칍N GENERALES</h3>\n                <ol style=\"padding-left: 25px;\">`;\n    \n    if (securityData.pautas_generales && securityData.pautas_generales.length > 0) {\n      securityData.pautas_generales.forEach(pauta => {\n        html += `\n                    <li style=\"margin-bottom: 10px;\">${pauta}</li>`;\n      });\n    } else {\n      html += `\n                    <li style=\"margin-bottom: 10px;\">No hay pautas generales disponibles.</li>`;\n    }\n    \n    html += `\n                </ol>\n            </div>\n        </div>\n        \n        <div style=\"text-align: center; margin-top: 30px;\">\n            <img src=\"https://github.com/ifxnetworks/Ansible/blob/main/Imagen1nnlnl.jpg?raw=true\" alt=\"Pie de p치gina\" style=\"max-width: 100%; height: auto;\">\n        </div>\n    </div>\n</body>\n</html>`;\n\n    // Incluir los datos JSON en un campo oculto del HTML\n    const jsonScriptTag = `<script id=\"security-data\" type=\"application/json\" style=\"display:none;\">${JSON.stringify(securityData)}</script>`;\n    html = html.replace('</body>', `${jsonScriptTag}</body>`);\n\n    // Devolver un 칰nico output\n    returnItems.push({\n      json: {\n        htmlEmail: html\n      }\n    });\n  } catch (error) {\n    console.log('Error:', error);\n    const errorMessage = error instanceof Error \n      ? error.message \n      : 'Error desconocido';\n    returnItems.push({\n      json: {\n        error: `Error al procesar los datos: ${errorMessage}`\n      }\n    });\n  }\n}\n\n// Funciones auxiliares\n// Funci칩n para formatear el per칤odo de fechas\nfunction formatearPeriodo(startDate, endDate) {\n  if (!startDate || !endDate) return \"\";\n  \n  const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];\n  \n  const inicio = new Date(startDate);\n  const fin = new Date(endDate);\n  \n  // Si son el mismo d칤a\n  if (inicio.toDateString() === fin.toDateString()) {\n    return `${inicio.getDate()} de ${meses[inicio.getMonth()]} de ${inicio.getFullYear()}`;\n  } else {\n    return `${inicio.getDate()} de ${meses[inicio.getMonth()]} al ${fin.getDate()} de ${meses[fin.getMonth()]} de ${fin.getFullYear()}`;\n  }\n}\n\n// Versi칩n con header con degradado azul a magenta e informaci칩n del periodo\nfunction createEmailSafeHeader(date, startDate, endDate) {\n  const periodText = formatearPeriodo(startDate, endDate);\n  const periodInfo = periodText ? `<p style=\"color: #ffffff; font-size: 14px; margin: 5px 0 0 0; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);\">Periodo de Consulta: ${periodText}</p>` : '';\n  \n  \n// Usar una imagen de fondo o celdas con colores s칩lidos en lugar de gradiente\n  // Usar la imagen como fondo con VML para Outlook\n  return `\n  <!--[if gte mso 9]>\n  <v:rect xmlns:v=\"urn:schemas-microsoft-com:vml\" fill=\"true\" stroke=\"false\" style=\"width:800px;height:150px;\">\n    <v:fill type=\"frame\" src=\"https://media.licdn.com/dms/image/v2/D4E3DAQFqcEmbz29Nmw/image-scale_191_1128/image-scale_191_1128/0/1695664141867/ifx_networks_cover?e=2147483647&v=beta&t=JVG-v8jzdy-D85rsPWHrfn_rzAnV9459-s6uzEw-bPM\" color=\"#1a237e\" />\n    <v:textbox style=\"mso-fit-shape-to-text:true\" inset=\"0,0,0,0\">\n  <![endif]-->\n  <table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" background=\"https://media.licdn.com/dms/image/v2/D4E3DAQFqcEmbz29Nmw/image-scale_191_1128/image-scale_191_1128/0/1695664141867/ifx_networks_cover?e=2147483647&v=beta&t=JVG-v8jzdy-D85rsPWHrfn_rzAnV9459-s6uzEw-bPM\" style=\"background-image: url('https://media.licdn.com/dms/image/v2/D4E3DAQFqcEmbz29Nmw/image-scale_191_1128/image-scale_191_1128/0/1695664141867/ifx_networks_cover?e=2147483647&v=beta&t=JVG-v8jzdy-D85rsPWHrfn_rzAnV9459-s6uzEw-bPM'); background-size: cover; background-position: right center; margin-bottom: 20px;\">\n    <tr>\n      <td align=\"left\" valign=\"middle\" width=\"120\" style=\"padding: 15px;\">\n        <img src=\"https://github.com/aifx-dev/repo-images/blob/main/Logo_aifx_blanco_circle.png?raw=true\" alt=\"Logo\" style=\"width: 110px; height: auto;\">\n      </td>\n      <td align=\"left\" valign=\"middle\" style=\"padding: 15px;\">\n        <h1 style=\"color: #ffffff; font-size: 24px; margin: 0; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);\">BOLET칈N DE CIBERSEGURIDAD</h1>\n        <p style=\"color: #ffffff; font-size: 16px; margin: 5px 0 0 0; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);\">${date}</p>\n        ${periodInfo}\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\" align=\"right\" style=\"padding-right: 15px; padding-bottom: 5px;\">\n        <p style=\"color: #ffffff; font-size: 11px; margin: 0;\">Generated by <i style=\"font-style: italic;\">aifx</i></p>\n      </td>\n    </tr>\n  </table>\n  <!--[if gte mso 9]>\n    </v:textbox>\n  </v:rect>\n  <![endif]-->`\n}\n\n// Funci칩n para renderizar estad칤sticas\nfunction renderStats(vulnerabilidadesPorCriticidad) {\n  const contadores = {\n    'ALTA': vulnerabilidadesPorCriticidad['ALTA'].length,\n    'MEDIA': vulnerabilidadesPorCriticidad['MEDIA'].length,\n    'BAJA': vulnerabilidadesPorCriticidad['BAJA'].length\n  };\n  \n  const totalVulnerabilidades = contadores.ALTA + contadores.MEDIA + contadores.BAJA;\n  \n  return `\n  <table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n    <tr>\n      <td style=\"padding: 5px;\">\n        <table width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"5\" style=\"background-color: #f8f9fa; border-radius: 5px;\">\n          <tr>\n            <td align=\"center\" valign=\"top\" style=\"width: 25%;\">\n              <div style=\"font-size: 24px; font-weight: bold; color: #dc3545; margin-bottom: 5px;\">${contadores.ALTA}</div>\n              <div style=\"font-size: 12px; color: #666;\">Vulnerabilidades de Alta Criticidad</div>\n            </td>\n            <td align=\"center\" valign=\"top\" style=\"width: 25%;\">\n              <div style=\"font-size: 24px; font-weight: bold; color: #ff9933; margin-bottom: 5px;\">${contadores.MEDIA}</div>\n              <div style=\"font-size: 12px; color: #666;\">Vulnerabilidades de Media Criticidad</div>\n            </td>\n            <td align=\"center\" valign=\"top\" style=\"width: 25%;\">\n              <div style=\"font-size: 24px; font-weight: bold; color: #28a745; margin-bottom: 5px;\">${contadores.BAJA}</div>\n              <div style=\"font-size: 12px; color: #666;\">Vulnerabilidades de Baja Criticidad</div>\n            </td>\n            <td align=\"center\" valign=\"top\" style=\"width: 25%;\">\n              <div style=\"font-size: 24px; font-weight: bold; color: #2c67b2; margin-bottom: 5px;\">${totalVulnerabilidades}</div>\n              <div style=\"font-size: 12px; color: #666;\">Total de Vulnerabilidades</div>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>`;\n}\n\nfunction generarHTMLVulnerabilidad(vuln) {\n  let cvssColor;\n  let cvssBackColor;\n  let cvssValue;\n  \n  // Manejar el caso especial de CVSS \"TBD\"\n  if (vuln.cvss === \"TBD\" || vuln.cvss === null || vuln.cvss === undefined) {\n    cvssColor = '#ff9933'; // Naranja\n    cvssBackColor = '#fff5e6';\n    cvssValue = \"Pendiente\";\n  } else {\n    // Manejar valores num칠ricos normales\n    if (vuln.cvss >= 7) {\n      cvssColor = '#dc3545';\n      cvssBackColor = '#ffeaea';\n    } else if (vuln.cvss >= 4) {\n      cvssColor = '#ff9933';\n      cvssBackColor = '#fff5e6';\n    } else {\n      cvssColor = '#28a745';\n      cvssBackColor = '#e6f5e6';\n    }\n    cvssValue = vuln.cvss;\n  }\n  \n  // Generar HTML para acciones recomendadas\n  let accionesHTML = '';\n  if (vuln.acciones_recomendadas && vuln.acciones_recomendadas.length > 0) {\n    accionesHTML = vuln.acciones_recomendadas.map(accion => \n      `<li style=\"margin-bottom: 5px;\">${accion}</li>`\n    ).join('');\n  }\n  \n  // Generar HTML para referencias\n  let referenciasHTML = '';\n  if (vuln.referencias && vuln.referencias.length > 0) {\n    referenciasHTML = vuln.referencias.map(ref => \n      `<a href=\"${ref}\" style=\"color: #2c67b2; font-size: 13px; word-break: break-all; display: block; margin-bottom: 5px;\">${ref}</a>`\n    ).join('');\n  }\n  \n  return `\n  <table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin-bottom: 20px; border: 1px solid #eaeaea; border-radius: 5px;\">\n    <tr>\n      <td style=\"padding: 15px 20px;\">\n        <table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n          <tr>\n            <td>\n              <div style=\"font-weight: bold; font-size: 18px; color: #2c67b2; margin-bottom: 8px;\">${vuln.fabricante || 'Fabricante no especificado'}</div>\n              <div style=\"font-size: 14px; color: #666; margin-top: 5px;\">\n                <span><strong>CVE:</strong> ${vuln.cve}</span><br>\n                <span><strong>Fecha del Reporte:</strong> ${vuln.fecha_reporte}</span><br>\n                <span><strong>Producto Afectado:</strong> ${vuln.producto}</span><br>\n                <span style=\"display: inline-block; padding: 3px 8px; border-radius: 3px; font-weight: bold; font-size: 12px; margin-top: 5px; background-color: ${cvssBackColor}; color: ${cvssColor};\">CVSS: ${cvssValue}</span>\n              </div>\n            </td>\n          </tr>\n          <tr>\n            <td style=\"padding-top: 15px;\">\n              <table width=\"100%\" border=\"0\" cellpadding=\"12\" cellspacing=\"0\" style=\"background-color: #f8f9fa; border-radius: 5px; margin: 10px 0;\">\n                <tr>\n                  <td>\n                    <div style=\"font-weight: bold; margin-bottom: 5px; color: #555;\">Descripci칩n T칠cnica</div>\n                    <p>${vuln.descripcion}</p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n          <tr>\n            <td style=\"padding-top: 15px;\">\n              <div style=\"font-weight: bold; margin-bottom: 5px; color: #555;\">Acciones Recomendadas</div>\n              <ul style=\"padding-left: 25px; margin-bottom: 15px;\">\n                ${accionesHTML}\n              </ul>\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <div style=\"font-weight: bold; margin-bottom: 5px; color: #555;\">Referencias</div>\n              ${referenciasHTML}\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>`;\n}\n\nreturn returnItems;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[680,-20],"id":"aeff6df0-3e8f-48e9-abdb-30cd30ed9c03","name":"Code"},{"parameters":{"rule":{"interval":[{"triggerAtHour":4,"triggerAtMinute":5}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-220,-20],"id":"27aaef1f-b0ae-48c3-b402-4bcd672144f3","name":"Schedule Trigger"},{"parameters":{"model":{"__rl":true,"value":"llama-4-Scout","mode":"list","cachedResultName":"llama-4-Scout"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[340,180],"id":"b1a7105b-f515-449f-8a6e-84960929e913","name":"Llama 4 Scout","credentials":{"openAiApi":{"id":"3ksygUY2AafRzzfk","name":"Proxy LiteLLM"}}},{"parameters":{"toRecipients":"jaimep@ifxcorp.com","subject":"Boletin de Vulnerabilidades - Vulners.com","bodyContent":"={{ $json.htmlEmail }}","additionalFields":{"bodyContentType":"html"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[900,160],"id":"0e06cedd-1a9d-4713-854e-42511f7349e6","name":"Test Mail jaimep@ifxcorp.com","webhookId":"2452f9ee-6f32-4158-a3f7-17ae677a68a8","credentials":{"microsoftOutlookOAuth2Api":{"id":"xSTIlfhp3ac7TN3h","name":"Mail ai@ifxcorp.com"}},"disabled":true},{"parameters":{"toRecipients":"ai@ifxcorp.com","subject":"Boletin de Vulnerabilidades - Vulners.com","bodyContent":"={{ $json.htmlEmail }}","additionalFields":{"bccRecipients":"soc-cl@ifxcorp.com,care_interno@ifxcorp.com,seguridadinformacion@ifxcorp.com,jaimep@ifxcorp.com","bodyContentType":"html"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[900,-20],"id":"8e1fc0cf-7a35-4311-b65b-3246f2332bf8","name":"Mail ai@ifxcorp.com","webhookId":"2452f9ee-6f32-4158-a3f7-17ae677a68a8","credentials":{"microsoftOutlookOAuth2Api":{"id":"xSTIlfhp3ac7TN3h","name":"Mail ai@ifxcorp.com"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"dc412ed1-9438-48a4-aa0d-3faa56c9b145","leftValue":"={{ $json.data.error }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[180,-20],"id":"08011d78-cefa-4339-9f4a-b5bbdff69bbf","name":"If"},{"parameters":{"toRecipients":"jaimep@ifxcorp.com","subject":"游뚿 Error en Vulners.com","bodyContent":"=游뚿 {{ $json.data.error }}\n\n____","additionalFields":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[380,-200],"id":"ad738db2-c1fb-4675-b398-8d0802b579e1","name":"Send Error","webhookId":"817ac8cc-5e26-4316-9fbb-bd49e890c68e","credentials":{"microsoftOutlookOAuth2Api":{"id":"xSTIlfhp3ac7TN3h","name":"Mail ai@ifxcorp.com"}}},{"parameters":{"resource":"messages-api","instanceName":"whisper_aifx","remoteJid":"573165278069","messageText":"=游뚿 {{ $json.data.error }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[380,-380],"id":"93365126-357b-4ea0-b99c-f62aeeae25ca","name":"Send Error Wapp","credentials":{"evolutionApi":{"id":"SbXTefcOFzNTLZjt","name":"Evolution API 3171057858"}}}],"connections":{"HTTP Request":{"main":[[{"node":"If","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Mail ai@ifxcorp.com","type":"main","index":0},{"node":"Test Mail jaimep@ifxcorp.com","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Llama 4 Scout":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"If":{"main":[[{"node":"Send Error","type":"main","index":0},{"node":"Send Error Wapp","type":"main","index":0}],[{"node":"AI Agent","type":"main","index":0}]]},"Send Error":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"Txht1wrdLAI370JY","timezone":"America/Bogota"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"1aabf616-75d6-46e8-9440-6cb375e4fef3","triggerCount":1,"tags":[]}