{"createdAt":"2025-06-20T14:49:10.139Z","updatedAt":"2025-06-20T15:19:23.000Z","id":"A3y0rJeqBP0bWJXq","name":"Whisper Wapp Remote Hands","active":false,"isArchived":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"031aa247-f4ae-45a2-af21-427ffe5cbb22","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-1200,410.5],"id":"5a90ea8a-d4d3-4386-9122-f3f4d39f806d","name":"Webhook","webhookId":"031aa247-f4ae-45a2-af21-427ffe5cbb22"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Webhook').item.json.body.data.message.audioMessage.url }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true},"id":"7af2e709-1c9a-4e1f-813f-608529052060"}],"combinator":"and"},"renameOutput":true,"outputKey":"audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"be5d6d05-28de-446d-b86b-9c588a7bedd7","leftValue":"={{ $('Webhook').item.json.body.data.message.imageMessage.url }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"image"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7b5492b7-3dc9-4b9f-8f9e-44e57eeaa22f","leftValue":"={{ $('Webhook').item.json.body.data.message.videoMessage.url }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"video"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"58b2de1c-a353-48b3-9391-72d8211c788c","leftValue":"={{ $json.conversation }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[120,179],"id":"2e513a03-9152-46bc-90e7-f67ff19ed6be","name":"Switch"},{"parameters":{"resource":"chat-api","operation":"get-media-base64","instanceName":"whisper_aifx","messageId":"={{ $('Webhook').item.json.body.data.key.id }}","convertToMp4":true},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[340,-189.5],"id":"cd6a5c20-5a89-4709-9f38-61e4ebaf68af","name":"Get Audio WApp","credentials":{"evolutionApi":{"id":"9k6KTcMvpINN4jXM","name":"Evolution aifx 3171057858"}}},{"parameters":{"resource":"chat-api","operation":"get-media-base64","instanceName":"whisper_aifx","messageId":"={{ $('Webhook').item.json.body.data.key.id }}"},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[340,10.5],"id":"939ed705-262e-427f-aaa7-53be7ea2cd21","name":"Get Image WApp","credentials":{"evolutionApi":{"id":"9k6KTcMvpINN4jXM","name":"Evolution aifx 3171057858"}}},{"parameters":{"assignments":{"assignments":[{"id":"92096346-a6ee-4a28-b6cb-0efdac946206","name":"conversation","value":"={{ $('Webhook').item.json.body.data.message.videoMessage.caption }}\n**Este mensaje viene acompa√±ado de un video que no puede ser interpretado, por favor visite el chat para tener contexto**\nMensaje enviado por: {{ $('Webhook').item.json.body.data.pushName }} - \nFecha y Hora del Video: {{ $('Webhook').item.json.body.date_time.toDateTime().format('dd/MM/yyyy HH:MM') }}\n{{ $('Webhook').item.json.body.data.message.reactionMessage.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[340,210.5],"id":"73cae7c5-737f-41ed-9304-54673842c22d","name":"Set Fields Video"},{"parameters":{"operation":"toBinary","sourceProperty":"data.base64","options":{"mimeType":"={{ $json.data.mimetype }}"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[560,-189.5],"id":"205806a9-70b9-4f21-b53e-9f808fa2696c","name":"Convert Audio"},{"parameters":{"operation":"toBinary","sourceProperty":"data.base64","options":{"mimeType":"={{ $json.data.mimetype }}"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[560,10.5],"id":"9194aa31-9006-4e5f-aca2-586cda6f37a4","name":"Convert Image"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[780,-189.5],"id":"555a9a24-5c88-4c69-8629-d091e6deb949","name":"Transcibre Audio","credentials":{"openAiApi":{"id":"w75RuNSCJjKqeuAT","name":"OpenAi JPG"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini-2024-07-18","mode":"list","cachedResultName":"GPT-4O-MINI-2024-07-18"},"text":"Describe detalladamente la imagen, extrae el texto que alli se pueda encontrar","inputType":"base64","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[780,10.5],"id":"00006706-a85e-4a13-96bd-130dc073f96f","name":"Transcribe Image","credentials":{"openAiApi":{"id":"w75RuNSCJjKqeuAT","name":"OpenAi JPG"}}},{"parameters":{"assignments":{"assignments":[{"id":"9aed5369-214a-44ff-a2da-a584ac66b6ca","name":"text","value":"=<audio>\n{{ $json.text }}\n</audio>","type":"string"},{"id":"2fea67b6-eb69-47fd-bb52-94bf6bf0a4f3","name":"body.data.key.id","value":"={{ $('Webhook').item.json.body.data.key.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1000,-189.5],"id":"2cbb0bd7-2856-45f9-a6c7-556fae14b927","name":"Set Fields Audio"},{"parameters":{"assignments":{"assignments":[{"id":"9aed5369-214a-44ff-a2da-a584ac66b6ca","name":"text","value":"={{ $('Webhook').item.json.body.data.message.imageMessage.caption }}\n{{ $('Webhook').item.json.body.data.message.reactionMessage.text }}\n<image>\n{{ $json.content }}\n</image>","type":"string"},{"id":"2fea67b6-eb69-47fd-bb52-94bf6bf0a4f3","name":"body.data.key.id","value":"={{ $('Webhook').item.json.body.data.key.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1000,10.5],"id":"83ba2c82-24fd-40ca-8e4c-61d42fcb9827","name":"Set Fields Image"},{"parameters":{"schema":{"__rl":true,"value":"public","mode":"list","cachedResultName":"public"},"table":{"__rl":true,"value":"messages","mode":"list","cachedResultName":"messages"},"columns":{"mappingMode":"defineBelow","value":{"url_video":"={{ $('Webhook').item.json.body.data.message.videoMessage.url }}","participant":"={{ $('Webhook').item.json.body.data.key.participant }}","pushName":"={{ $('Webhook').item.json.body.data.pushName }}","conversation":"={{ $('Webhook').item.json.body.data.message.conversation }}\n{{ $('Webhook').item.json.body.data.message.imageMessage.caption }}\n{{ $('Webhook').item.json.body.data.message.reactionMessage.text }}","instanceId":"={{ $('Webhook').item.json.body.data.instanceId }}","dateTime":"={{ $('Webhook').item.json.body.date_time.toDateTime().toISO() }}","sender":"={{ $('Webhook').item.json.body.sender }}","url_image":"={{ $('Webhook').item.json.body.data.message.imageMessage.url }}","url_audio":"={{ $('Webhook').item.json.body.data.message.audioMessage.url }}","remoteJid":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","nombrechat":"={{ $('Get Group Name').item.json.data.subject }}","id_chat":"={{ $('Webhook').item.json.body.data.key.id }}"},"matchingColumns":["id"],"schema":[{"id":"id_chat","displayName":"id_chat","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"remoteJid","displayName":"remoteJid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"participant","displayName":"participant","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"pushName","displayName":"pushName","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"conversation","displayName":"conversation","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"instanceId","displayName":"instanceId","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"dateTime","displayName":"dateTime","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"sender","displayName":"sender","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"url_image","displayName":"url_image","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"url_audio","displayName":"url_audio","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"url_video","displayName":"url_video","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nombrechat","displayName":"nombrechat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"nombrecliente","displayName":"nombrecliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"real_name_user","displayName":"real_name_user","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-100,310.5],"id":"3e0de1b2-546b-4fcd-a1ca-d6fc5d0d7bf9","name":"Add Row Text","credentials":{"postgres":{"id":"8GkMmZaSPz5j95ME","name":"Postgres DB Whisper"}}},{"parameters":{"operation":"update","schema":{"__rl":true,"value":"public","mode":"list","cachedResultName":"public"},"table":{"__rl":true,"value":"messages","mode":"list","cachedResultName":"messages"},"columns":{"mappingMode":"defineBelow","value":{"conversation":"={{ $json.text }}","id_chat":"={{ $json.body.data.key.id }}"},"matchingColumns":["id_chat"],"schema":[{"id":"id_chat","displayName":"id_chat","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"remoteJid","displayName":"remoteJid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"participant","displayName":"participant","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"pushName","displayName":"pushName","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"conversation","displayName":"conversation","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"instanceId","displayName":"instanceId","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"dateTime","displayName":"dateTime","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"sender","displayName":"sender","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_image","displayName":"url_image","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_audio","displayName":"url_audio","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_video","displayName":"url_video","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"nombrechat","displayName":"nombrechat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1220,-89.5],"id":"0a2c0d05-92be-414d-9af9-20ab0f656da9","name":"Update Row Audio Image","credentials":{"postgres":{"id":"8GkMmZaSPz5j95ME","name":"Postgres DB Whisper"}}},{"parameters":{"operation":"update","schema":{"__rl":true,"value":"public","mode":"list","cachedResultName":"public"},"table":{"__rl":true,"value":"messages","mode":"list","cachedResultName":"messages"},"columns":{"mappingMode":"defineBelow","value":{"conversation":"={{ $json.text }}","id_chat":"={{ $('Webhook').item.json.body.data.key.id }}"},"matchingColumns":["id_chat"],"schema":[{"id":"id_chat","displayName":"id_chat","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"remoteJid","displayName":"remoteJid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"participant","displayName":"participant","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"pushName","displayName":"pushName","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"conversation","displayName":"conversation","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"instanceId","displayName":"instanceId","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"dateTime","displayName":"dateTime","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"sender","displayName":"sender","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_image","displayName":"url_image","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_audio","displayName":"url_audio","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_video","displayName":"url_video","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"nombrechat","displayName":"nombrechat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"nombrecliente","displayName":"nombrecliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"real_name_user","displayName":"real_name_user","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[560,210.5],"id":"28598d4b-72d0-48b5-8d1c-13a39d1f4b00","name":"Update Row Video","credentials":{"postgres":{"id":"8GkMmZaSPz5j95ME","name":"Postgres DB Whisper"}}},{"parameters":{"resource":"groups-api","operation":"fetch-groups","instanceName":"whisper_aifx","searchMethod":"groupJid","groupJid":"={{ $('Webhook').item.json.body.data.key.remoteJid }}"},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-320,310.5],"id":"6aa4e966-2e1c-4a41-a35f-9b82f293b4ec","name":"Get Group Name","alwaysOutputData":true,"credentials":{"evolutionApi":{"id":"9k6KTcMvpINN4jXM","name":"Evolution aifx 3171057858"}}},{"parameters":{"toRecipients":"jaimep@ifxcorp.com","subject":"üì¢ ¬°Notificaci√≥n de Grupo Nuevo!","bodyContent":"=üéâ Has sido agregado a un nuevo grupo de WhatsApp:\n\nüë• Grupo: {{ $('IF New Group').item.json.body.data[0].subject }}\nüîó Generado por: AIFX\n\n---","additionalFields":{},"path":"e461a718-357b-40ac-acc7-fe5c8801c6ed"},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-320,100],"id":"16b6a1d9-ca1a-487b-9b0d-c940df108bac","name":"Mail New Group","webhookId":"e461a718-357b-40ac-acc7-fe5c8801c6ed","credentials":{"microsoftOutlookOAuth2Api":{"id":"xSTIlfhp3ac7TN3h","name":"Mail ai@ifxcorp.com"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e0f6c15b-ac47-4d89-8eb6-65c7b509bb07","leftValue":"={{ $('Webhook').item.json.body.event }}","rightValue":"groups.upsert","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-540,0],"id":"1efa28f6-b3dd-4527-b093-6a11011e55e5","name":"IF New Group"},{"parameters":{"resource":"messages-api","instanceName":"whisper_aifx","remoteJid":"573165278069","messageText":"=üì¢ ¬°Notificaci√≥n de Grupo Nuevo!\n\nüéâ Has sido agregado a un nuevo grupo de WhatsApp:\nüë• Grupo: {{ $('IF New Group').item.json.body.data[0].subject }}\nüîó Generado por: AIFX","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-320,-100],"id":"e4485ed3-fdb4-44db-8ebf-2cded4ceb8f2","name":"WAP New Group","alwaysOutputData":true,"credentials":{"evolutionApi":{"id":"9k6KTcMvpINN4jXM","name":"Evolution aifx 3171057858"}}},{"parameters":{"operation":"executeQuery","query":"SELECT DISTINCT \"remoteJid\", nombre_del_chat\nFROM equivalencia_chats \nWHERE \"remoteJid\" = '{{ $('Webhook').first().json.body.data[0].id }}'\n   OR nombre_del_chat = '{{ $('Webhook').first().json.body.data[0].subject }}'","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-320,-300],"id":"5efdd5d0-9cb0-4f89-8f3f-46192c3f5f56","name":"Search RemoteJid","alwaysOutputData":true,"executeOnce":true,"credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"equivalencia_chats","mode":"list","cachedResultName":"equivalencia_chats"},"columns":{"mappingMode":"defineBelow","value":{"nombre_del_chat":"={{ $('Webhook').first().json.body.data[0].subject }}","nombre_cliente":"={{ $('Webhook').first().json.body.data[0].subject }}","cid":"11111","experience_name":"No Aplica","segment":"IFX","remoteJid":"={{ $('Webhook').first().json.body.data[0].id }}"},"matchingColumns":["id"],"schema":[{"id":"nombre_del_chat","displayName":"nombre_del_chat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nombre_cliente","displayName":"nombre_cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"cid","displayName":"cid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"experience_name","displayName":"experience_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"segment","displayName":"segment","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"remoteJid","displayName":"remoteJid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[120,-400],"id":"ffbe7bb7-f393-4ef3-96ff-142bb60b5057","name":"Set RemoteJid","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"da08ad56-d336-4e84-a024-7ff7b903c4ab","leftValue":"={{ Object.keys($json).length === 0 }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-100,-300],"id":"90b6573b-fbf0-4653-8584-664faebdc64a","name":"RemoteJid Empty"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"77616b3d-eaad-44eb-8621-bc1df2d29c3d","leftValue":"={{ $json.exist }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[340,610.5],"id":"98385fe1-cd5e-4e74-94e2-ac1adc7cb02a","name":"Exist User IFX?"},{"parameters":{"operation":"executeQuery","query":"SELECT CASE \n    WHEN COUNT(*) > 0 THEN true \n    ELSE false \nEND AS exist\nFROM numbers_ifx \nWHERE celular = SPLIT_PART('{{ $('Webhook').item.json.body.data.key.participant }}', '@', 1);","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[120,610.5],"id":"0d3ff680-5533-481c-90a9-b3f6931eb4e7","name":"Check Real Name","alwaysOutputData":true,"credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"operation":"executeQuery","query":"SELECT \n   CASE \n       WHEN COUNT(*) > 0 THEN true \n       ELSE false \n   END AS encontrado,\n   CASE \n       WHEN COUNT(*) > 0 THEN UPPER(MAX(nombre))\n       ELSE NULL\n   END AS real_name\nFROM numbers_ifx \nWHERE celular = SPLIT_PART('{{ $('Add Row Text').item.json.participant }}', '@', 1);","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[560,510.5],"id":"6c43e222-87e3-435c-94dc-273f29b65b98","name":"Search Real Name}","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"operation":"update","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"messages","mode":"list","cachedResultName":"messages"},"columns":{"mappingMode":"defineBelow","value":{"id_chat":"={{ $('Webhook').item.json.body.data.key.id }}","real_name_user":"={{ $json.real_name }}"},"matchingColumns":["id_chat"],"schema":[{"id":"id_chat","displayName":"id_chat","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"remoteJid","displayName":"remoteJid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"participant","displayName":"participant","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"pushName","displayName":"pushName","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"conversation","displayName":"conversation","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"instanceId","displayName":"instanceId","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"dateTime","displayName":"dateTime","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"sender","displayName":"sender","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_image","displayName":"url_image","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_audio","displayName":"url_audio","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_video","displayName":"url_video","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"nombrechat","displayName":"nombrechat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"nombrecliente","displayName":"nombrecliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"real_name_user","displayName":"real_name_user","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[780,510.5],"id":"69f6a9e1-ae55-495d-a6c0-878d4a4785fb","name":"Set Real Name","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[560,710.5],"id":"c951bd86-31da-456e-b9fb-8bf7e7d34822","name":"No User IFX"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[340,410.5],"id":"f61e2ed8-bab5-4277-b97f-ad82b773675f","name":"Has Text"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[120,-100],"id":"0e63d9d9-f126-44a7-83c7-e3ff720bb4b7","name":"New remoteJid"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"14924783-1701-4268-96e7-5d521021930b","leftValue":"={{ $json.exists }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-760,410.5],"id":"71ee4b7a-b61e-4b27-a16f-d735d49b020c","name":"Is Care"},{"parameters":{"operation":"executeQuery","query":"SELECT EXISTS(\n   SELECT 1 \n   FROM equivalencia_chats\n   WHERE \"remoteJid\" = '{{ $('Webhook').item.json.body.data.key.remoteJid }}'\n);","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-980,410.5],"id":"d23bb4d1-689a-4d93-aaa5-a960f400b0e4","name":"Search ID Whisper","credentials":{"postgres":{"id":"8GkMmZaSPz5j95ME","name":"Postgres DB Whisper"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-100,1210.5],"id":"4b6931b4-76ec-41f0-a51f-cff61e2a515a","name":"Do Nothing"},{"parameters":{"operation":"executeQuery","query":"SELECT EXISTS(\n   SELECT 1 \n   FROM groups_remote_hands\n   WHERE \"nombregrupo\" = '{{ $('RemoteJid Exist?').item.json.data.subject }}'\n);","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-100,1010.5],"id":"2e5027a4-5573-4a3a-a47e-a0ba33f81cf1","name":"Query Name Chat","credentials":{"postgres":{"id":"brzMaPB6iJB9Pcyc","name":"Postgres DB Operaciones"}}},{"parameters":{"resource":"groups-api","operation":"fetch-groups","instanceName":"whisper_aifx","searchMethod":"groupJid","groupJid":"={{ $('Webhook').item.json.body.data.key.remoteJid }}"},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-540,1110.5],"id":"23b3d89c-f46f-4371-a141-f78d73762d1d","name":"Check remoteJid","credentials":{"evolutionApi":{"id":"9k6KTcMvpINN4jXM","name":"Evolution aifx 3171057858"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"573db405-af49-4df3-b50a-7620ce2956bc","leftValue":"={{ $('Check remoteJid').item.json.success }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-320,1110.5],"id":"0efc6427-c353-4ff9-b74f-2e258de5448d","name":"RemoteJid Exist?"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"eb8411b8-10c0-4906-b105-4dce0cfa0e59","leftValue":"={{ $('Query Name Chat').item.json.exists }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[120,1010.5],"id":"87b23de5-5f4c-4918-bbc0-a5c391f3274b","name":"Exist Name Chat"},{"parameters":{"assignments":{"assignments":[{"id":"d4b910e5-7ddc-4372-962f-cbe51d8b629a","name":"body","value":"={{ $('Webhook').item.json.body }}","type":"object"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[340,910.5],"id":"17ef1137-b5f2-4a21-a4d5-e8d987919374","name":"Get All Data","alwaysOutputData":true},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[340,1110.5],"id":"cd22c534-1d83-4c74-97af-277e6e59a558","name":"Final"},{"parameters":{"workflowId":{"__rl":true,"value":"EqwGgiPgMP5zpDaW","mode":"list","cachedResultName":"Remote Hands Whisper"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"mode":"each","options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[560,910.5],"id":"cdbc00c9-980b-46aa-8ffa-87f5aebdb593","name":"Exit To Workflow Remote Hands","alwaysOutputData":true}],"connections":{"Webhook":{"main":[[{"node":"Search ID Whisper","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Get Audio WApp","type":"main","index":0}],[{"node":"Get Image WApp","type":"main","index":0}],[{"node":"Set Fields Video","type":"main","index":0}],[{"node":"Has Text","type":"main","index":0}]]},"Get Audio WApp":{"main":[[{"node":"Convert Audio","type":"main","index":0}]]},"Get Image WApp":{"main":[[{"node":"Convert Image","type":"main","index":0}]]},"Set Fields Video":{"main":[[{"node":"Update Row Video","type":"main","index":0}]]},"Convert Audio":{"main":[[{"node":"Transcibre Audio","type":"main","index":0}]]},"Convert Image":{"main":[[{"node":"Transcribe Image","type":"main","index":0}]]},"Transcibre Audio":{"main":[[{"node":"Set Fields Audio","type":"main","index":0}]]},"Transcribe Image":{"main":[[{"node":"Set Fields Image","type":"main","index":0}]]},"Set Fields Audio":{"main":[[{"node":"Update Row Audio Image","type":"main","index":0}]]},"Set Fields Image":{"main":[[{"node":"Update Row Audio Image","type":"main","index":0}]]},"Add Row Text":{"main":[[{"node":"Switch","type":"main","index":0},{"node":"Check Real Name","type":"main","index":0}]]},"Get Group Name":{"main":[[{"node":"Add Row Text","type":"main","index":0}]]},"IF New Group":{"main":[[{"node":"Mail New Group","type":"main","index":0},{"node":"WAP New Group","type":"main","index":0},{"node":"Search RemoteJid","type":"main","index":0}],[{"node":"Get Group Name","type":"main","index":0}]]},"Search RemoteJid":{"main":[[{"node":"RemoteJid Empty","type":"main","index":0}]]},"RemoteJid Empty":{"main":[[{"node":"Set RemoteJid","type":"main","index":0}],[{"node":"New remoteJid","type":"main","index":0}]]},"Set RemoteJid":{"main":[[]]},"Exist User IFX?":{"main":[[{"node":"Search Real Name}","type":"main","index":0}],[{"node":"No User IFX","type":"main","index":0}]]},"Check Real Name":{"main":[[{"node":"Exist User IFX?","type":"main","index":0}]]},"Search Real Name}":{"main":[[{"node":"Set Real Name","type":"main","index":0}]]},"Is Care":{"main":[[{"node":"IF New Group","type":"main","index":0}],[{"node":"Check remoteJid","type":"main","index":0}]]},"Search ID Whisper":{"main":[[{"node":"Is Care","type":"main","index":0}]]},"Query Name Chat":{"main":[[{"node":"Exist Name Chat","type":"main","index":0}]]},"Check remoteJid":{"main":[[{"node":"RemoteJid Exist?","type":"main","index":0}]]},"RemoteJid Exist?":{"main":[[{"node":"Query Name Chat","type":"main","index":0}],[{"node":"Do Nothing","type":"main","index":0}]]},"Exist Name Chat":{"main":[[{"node":"Get All Data","type":"main","index":0}],[{"node":"Final","type":"main","index":0}]]},"Get All Data":{"main":[[{"node":"Exit To Workflow Remote Hands","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"America/Bogota","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"Txht1wrdLAI370JY","timeSavedPerExecution":5,"executionTimeout":600,"saveDataSuccessExecution":"all","saveExecutionProgress":true,"saveManualExecutions":true},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"66fe09cb-4364-455f-adcb-75c5e54c65c5","triggerCount":1,"tags":[]}