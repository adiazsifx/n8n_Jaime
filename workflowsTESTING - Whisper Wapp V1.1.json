{"createdAt":"2025-06-14T15:23:20.886Z","updatedAt":"2025-06-14T15:25:36.000Z","id":"Wovd8vv8ctUnF9fP","name":"TESTING - Whisper Wapp V1.1","active":true,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"b5e2a28a-0a0d-4ee3-a1c6-c564e1cc09be","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-760,0],"id":"019bc7e7-2e75-4e6f-a626-2da0d7b36f50","name":"Webhook","webhookId":"b5e2a28a-0a0d-4ee3-a1c6-c564e1cc09be"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Webhook').item.json.body.data.message.audioMessage.url }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true},"id":"7af2e709-1c9a-4e1f-813f-608529052060"}],"combinator":"and"},"renameOutput":true,"outputKey":"audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"be5d6d05-28de-446d-b86b-9c588a7bedd7","leftValue":"={{ $('Webhook').item.json.body.data.message.imageMessage.url }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"image"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7b5492b7-3dc9-4b9f-8f9e-44e57eeaa22f","leftValue":"={{ $('Webhook').item.json.body.data.message.videoMessage.url }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"video"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"58b2de1c-a353-48b3-9391-72d8211c788c","leftValue":"={{ $json.conversation }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[120,179],"id":"2fec1e08-b571-4f12-82a6-ffa0c4bbeca4","name":"Switch"},{"parameters":{"resource":"chat-api","operation":"get-media-base64","instanceName":"whisper_aifx","messageId":"={{ $('Webhook').item.json.body.data.key.id }}","convertToMp4":true},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[340,-189.5],"id":"3cb6f96e-da4f-44ee-9ea2-410ebae30535","name":"Get Audio WApp","credentials":{"evolutionApi":{"id":"9k6KTcMvpINN4jXM","name":"Evolution aifx 3171057858"}}},{"parameters":{"resource":"chat-api","operation":"get-media-base64","instanceName":"whisper_aifx","messageId":"={{ $('Webhook').item.json.body.data.key.id }}"},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[340,10.5],"id":"c728d9d4-6b4c-4e25-a116-08d65449eda7","name":"Get Image WApp","credentials":{"evolutionApi":{"id":"9k6KTcMvpINN4jXM","name":"Evolution aifx 3171057858"}}},{"parameters":{"assignments":{"assignments":[{"id":"92096346-a6ee-4a28-b6cb-0efdac946206","name":"conversation","value":"={{ $('Webhook').item.json.body.data.message.videoMessage.caption }}\n**Este mensaje viene acompa√±ado de un video que no puede ser interpretado, por favor visite el chat para tener contexto**\nMensaje enviado por: {{ $('Webhook').item.json.body.data.pushName }} - \nFecha y Hora del Video: {{ $('Webhook').item.json.body.date_time.toDateTime().format('dd/MM/yyyy HH:MM') }}\n{{ $('Webhook').item.json.body.data.message.reactionMessage.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[340,210.5],"id":"5b4e2ef0-0239-408d-990c-5903a53137f1","name":"Set Fields Video"},{"parameters":{"operation":"toBinary","sourceProperty":"data.base64","options":{"mimeType":"={{ $json.data.mimetype }}"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[560,-189.5],"id":"70bcc137-5e0b-40cf-9ad6-8d5fb0ca0cab","name":"Convert Audio"},{"parameters":{"operation":"toBinary","sourceProperty":"data.base64","options":{"mimeType":"={{ $json.data.mimetype }}"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[560,10.5],"id":"8127f1e3-0c9d-4816-929e-fecca98398ba","name":"Convert Image"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[780,-189.5],"id":"78e809c7-62c7-44d3-a288-a2614c6530d0","name":"Transcibre Audio","credentials":{"openAiApi":{"id":"w75RuNSCJjKqeuAT","name":"OpenAi JPG"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini-2024-07-18","mode":"list","cachedResultName":"GPT-4O-MINI-2024-07-18"},"text":"Describe detalladamente la imagen, extrae el texto que alli se pueda encontrar","inputType":"base64","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[780,10.5],"id":"e0901275-fe90-42a5-9b95-2c55472b0777","name":"Transcribe Image","credentials":{"openAiApi":{"id":"w75RuNSCJjKqeuAT","name":"OpenAi JPG"}}},{"parameters":{"assignments":{"assignments":[{"id":"9aed5369-214a-44ff-a2da-a584ac66b6ca","name":"text","value":"=<audio>\n{{ $json.text }}\n</audio>","type":"string"},{"id":"2fea67b6-eb69-47fd-bb52-94bf6bf0a4f3","name":"body.data.key.id","value":"={{ $('Webhook').item.json.body.data.key.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1000,-189.5],"id":"2ef626b0-1efa-4612-b86f-62d07ba44b53","name":"Set Fields Audio"},{"parameters":{"assignments":{"assignments":[{"id":"9aed5369-214a-44ff-a2da-a584ac66b6ca","name":"text","value":"={{ $('Webhook').item.json.body.data.message.imageMessage.caption }}\n{{ $('Webhook').item.json.body.data.message.reactionMessage.text }}\n<image>\n{{ $json.content }}\n</image>","type":"string"},{"id":"2fea67b6-eb69-47fd-bb52-94bf6bf0a4f3","name":"body.data.key.id","value":"={{ $('Webhook').item.json.body.data.key.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1000,10.5],"id":"d2b93e62-024c-4abd-9ef0-265558941a07","name":"Set Fields Image"},{"parameters":{"schema":{"__rl":true,"value":"public","mode":"list","cachedResultName":"public"},"table":{"__rl":true,"value":"messages","mode":"list","cachedResultName":"messages"},"columns":{"mappingMode":"defineBelow","value":{"url_video":"={{ $('Webhook').item.json.body.data.message.videoMessage.url }}","participant":"={{ $('Webhook').item.json.body.data.key.participant }}","pushName":"={{ $('Webhook').item.json.body.data.pushName }}","conversation":"={{ $('Webhook').item.json.body.data.message.conversation }}\n{{ $('Webhook').item.json.body.data.message.imageMessage.caption }}\n{{ $('Webhook').item.json.body.data.message.reactionMessage.text }}","instanceId":"={{ $('Webhook').item.json.body.data.instanceId }}","dateTime":"={{ $('Webhook').item.json.body.date_time.toDateTime().toISO() }}","sender":"={{ $('Webhook').item.json.body.sender }}","url_image":"={{ $('Webhook').item.json.body.data.message.imageMessage.url }}","url_audio":"={{ $('Webhook').item.json.body.data.message.audioMessage.url }}","remoteJid":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","nombrechat":"={{ $('Get Group Name').item.json.data.subject }}","id_chat":"={{ $('Webhook').item.json.body.data.key.id }}"},"matchingColumns":["id"],"schema":[{"id":"id_chat","displayName":"id_chat","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"remoteJid","displayName":"remoteJid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"participant","displayName":"participant","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"pushName","displayName":"pushName","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"conversation","displayName":"conversation","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"instanceId","displayName":"instanceId","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"dateTime","displayName":"dateTime","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"sender","displayName":"sender","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"url_image","displayName":"url_image","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"url_audio","displayName":"url_audio","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"url_video","displayName":"url_video","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nombrechat","displayName":"nombrechat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"nombrecliente","displayName":"nombrecliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"real_name_user","displayName":"real_name_user","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-100,310.5],"id":"90cfcb81-e6ff-46b2-8143-9fedd2be97af","name":"Add Row Text","credentials":{"postgres":{"id":"8GkMmZaSPz5j95ME","name":"Postgres DB Whisper"}},"disabled":true},{"parameters":{"operation":"update","schema":{"__rl":true,"value":"public","mode":"list","cachedResultName":"public"},"table":{"__rl":true,"value":"messages","mode":"list","cachedResultName":"messages"},"columns":{"mappingMode":"defineBelow","value":{"conversation":"={{ $json.text }}","id_chat":"={{ $json.body.data.key.id }}"},"matchingColumns":["id_chat"],"schema":[{"id":"id_chat","displayName":"id_chat","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"remoteJid","displayName":"remoteJid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"participant","displayName":"participant","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"pushName","displayName":"pushName","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"conversation","displayName":"conversation","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"instanceId","displayName":"instanceId","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"dateTime","displayName":"dateTime","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"sender","displayName":"sender","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_image","displayName":"url_image","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_audio","displayName":"url_audio","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_video","displayName":"url_video","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"nombrechat","displayName":"nombrechat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1220,-89.5],"id":"2358bbf1-8f35-4b68-92a1-2daca34e4e19","name":"Update Row Audio Image","credentials":{"postgres":{"id":"8GkMmZaSPz5j95ME","name":"Postgres DB Whisper"}},"disabled":true},{"parameters":{"operation":"update","schema":{"__rl":true,"value":"public","mode":"list","cachedResultName":"public"},"table":{"__rl":true,"value":"messages","mode":"list","cachedResultName":"messages"},"columns":{"mappingMode":"defineBelow","value":{"conversation":"={{ $json.text }}","id_chat":"={{ $('Webhook').item.json.body.data.key.id }}"},"matchingColumns":["id_chat"],"schema":[{"id":"id_chat","displayName":"id_chat","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"remoteJid","displayName":"remoteJid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"participant","displayName":"participant","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"pushName","displayName":"pushName","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"conversation","displayName":"conversation","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"instanceId","displayName":"instanceId","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"dateTime","displayName":"dateTime","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"sender","displayName":"sender","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_image","displayName":"url_image","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_audio","displayName":"url_audio","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_video","displayName":"url_video","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"nombrechat","displayName":"nombrechat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"nombrecliente","displayName":"nombrecliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"real_name_user","displayName":"real_name_user","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[560,210.5],"id":"c21b7ff5-1c8b-4f53-8c6b-08a496e7e98e","name":"Update Row Video","credentials":{"postgres":{"id":"8GkMmZaSPz5j95ME","name":"Postgres DB Whisper"}},"disabled":true},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[340,410.5],"id":"6beb6560-2170-4048-8547-e19feef841e9","name":"No Operation, do nothing"},{"parameters":{"resource":"groups-api","operation":"fetch-groups","instanceName":"whisper_aifx","searchMethod":"groupJid","groupJid":"={{ $json.body.data.key.remoteJid }}"},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-320,310.5],"id":"0c2c06d3-011f-496c-81aa-e5a9e6bd1171","name":"Get Group Name","alwaysOutputData":true,"credentials":{"evolutionApi":{"id":"9k6KTcMvpINN4jXM","name":"Evolution aifx 3171057858"}}},{"parameters":{"toRecipients":"jaimep@ifxcorp.com","subject":"üì¢ ¬°Notificaci√≥n de Grupo Nuevo!","bodyContent":"=üéâ Has sido agregado a un nuevo grupo de WhatsApp:\n\nüë• Grupo: {{ $('IF New Group').item.json.body.data[0].subject }}\nüîó Generado por: AIFX\n\n---","additionalFields":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-320,100],"id":"8a0b896e-e7d1-4af1-b259-d984897f216a","name":"Mail New Group","webhookId":"98236c47-9908-4ab2-a762-61540d615561","credentials":{"microsoftOutlookOAuth2Api":{"id":"xSTIlfhp3ac7TN3h","name":"Mail ai@ifxcorp.com"}},"disabled":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e0f6c15b-ac47-4d89-8eb6-65c7b509bb07","leftValue":"={{ $json.body.event }}","rightValue":"groups.upsert","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-540,0],"id":"0c65d523-3987-4105-a12c-458fee7240e8","name":"IF New Group"},{"parameters":{"resource":"messages-api","instanceName":"whisper_aifx","remoteJid":"573165278069","messageText":"=üì¢ ¬°Notificaci√≥n de Grupo Nuevo!\n\nüéâ Has sido agregado a un nuevo grupo de WhatsApp:\nüë• Grupo: {{ $('IF New Group').item.json.body.data[0].subject }}\nüîó Generado por: AIFX","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-320,-100],"id":"13ae493c-68ec-4a26-a8de-ef68488c56d0","name":"WAP New Group","alwaysOutputData":true,"credentials":{"evolutionApi":{"id":"9k6KTcMvpINN4jXM","name":"Evolution aifx 3171057858"}}},{"parameters":{"operation":"executeQuery","query":"SELECT DISTINCT \"remoteJid\", nombre_del_chat\nFROM equivalencia_chats \nWHERE \"remoteJid\" = '{{ $('Webhook').first().json.body.data[0].id }}'\n   OR nombre_del_chat = '{{ $('Webhook').first().json.body.data[0].subject }}'","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-320,-300],"id":"c6bafd3e-62d1-4850-8b3a-07d5b992df76","name":"Search RemoteJid","alwaysOutputData":true,"executeOnce":true,"credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"equivalencia_chats","mode":"list","cachedResultName":"equivalencia_chats"},"columns":{"mappingMode":"defineBelow","value":{"nombre_del_chat":"={{ $('Webhook').first().json.body.data[0].subject }}","nombre_cliente":"={{ $('Webhook').first().json.body.data[0].subject }}","cid":"11111","experience_name":"No Aplica","segment":"IFX","remoteJid":"={{ $('Webhook').first().json.body.data[0].id }}"},"matchingColumns":["id"],"schema":[{"id":"nombre_del_chat","displayName":"nombre_del_chat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nombre_cliente","displayName":"nombre_cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"cid","displayName":"cid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"experience_name","displayName":"experience_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"segment","displayName":"segment","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"remoteJid","displayName":"remoteJid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[120,-400],"id":"d0f71368-b5e9-4adb-bc11-1143ccb56ea1","name":"Set RemoteJid","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}},"disabled":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"da08ad56-d336-4e84-a024-7ff7b903c4ab","leftValue":"={{ Object.keys($json).length === 0 }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}},{"id":"ca8e0e2a-af4f-49e5-8965-1eec540086c7","leftValue":"","rightValue":"","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-100,-300],"id":"ee8bf197-ed95-49f1-b771-cef9a3aac908","name":"RemoteJid Empty"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[100,-100],"id":"bb2c8cb5-d7d7-4c6c-b4cc-5608723b30e1","name":"do nothing new remoteJid"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"77616b3d-eaad-44eb-8621-bc1df2d29c3d","leftValue":"={{ $json.exist }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[340,610.5],"id":"a99f6c39-9a58-4a42-805b-20393e89031d","name":"Exist User IFX?"},{"parameters":{"operation":"executeQuery","query":"SELECT CASE \n    WHEN COUNT(*) > 0 THEN true \n    ELSE false \nEND AS exist\nFROM numbers_ifx \nWHERE celular = SPLIT_PART('{{ $('Webhook').item.json.body.data.key.participant }}', '@', 1);","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[120,610.5],"id":"24c3541f-095d-4568-8408-fa918c8f689a","name":"Check Real Name","alwaysOutputData":true,"credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"operation":"executeQuery","query":"SELECT \n   CASE \n       WHEN COUNT(*) > 0 THEN true \n       ELSE false \n   END AS encontrado,\n   CASE \n       WHEN COUNT(*) > 0 THEN UPPER(MAX(nombre))\n       ELSE NULL\n   END AS real_name\nFROM numbers_ifx \nWHERE celular = SPLIT_PART('{{ $('Add Row Text').item.json.participant }}', '@', 1);","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[560,610.5],"id":"00e836a6-949b-45ca-9ab2-95ed377ccc60","name":"Search Real Name}","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"operation":"update","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"messages","mode":"list","cachedResultName":"messages"},"columns":{"mappingMode":"defineBelow","value":{"id_chat":"={{ $('Webhook').item.json.body.data.key.id }}","real_name_user":"={{ $json.real_name }}"},"matchingColumns":["id_chat"],"schema":[{"id":"id_chat","displayName":"id_chat","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"remoteJid","displayName":"remoteJid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"participant","displayName":"participant","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"pushName","displayName":"pushName","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"conversation","displayName":"conversation","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"instanceId","displayName":"instanceId","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"dateTime","displayName":"dateTime","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"sender","displayName":"sender","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_image","displayName":"url_image","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_audio","displayName":"url_audio","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"url_video","displayName":"url_video","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"nombrechat","displayName":"nombrechat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"nombrecliente","displayName":"nombrecliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"real_name_user","displayName":"real_name_user","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[780,610.5],"id":"261067f5-1bf3-46d9-9d41-b405c33d53f8","name":"Set Real Name","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}},"disabled":true}],"connections":{"Webhook":{"main":[[{"node":"IF New Group","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Get Audio WApp","type":"main","index":0}],[{"node":"Get Image WApp","type":"main","index":0}],[{"node":"Set Fields Video","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}]]},"Get Audio WApp":{"main":[[{"node":"Convert Audio","type":"main","index":0}]]},"Get Image WApp":{"main":[[{"node":"Convert Image","type":"main","index":0}]]},"Set Fields Video":{"main":[[{"node":"Update Row Video","type":"main","index":0}]]},"Convert Audio":{"main":[[{"node":"Transcibre Audio","type":"main","index":0}]]},"Convert Image":{"main":[[{"node":"Transcribe Image","type":"main","index":0}]]},"Transcibre Audio":{"main":[[{"node":"Set Fields Audio","type":"main","index":0}]]},"Transcribe Image":{"main":[[{"node":"Set Fields Image","type":"main","index":0}]]},"Set Fields Audio":{"main":[[{"node":"Update Row Audio Image","type":"main","index":0}]]},"Set Fields Image":{"main":[[{"node":"Update Row Audio Image","type":"main","index":0}]]},"Add Row Text":{"main":[[{"node":"Switch","type":"main","index":0},{"node":"Check Real Name","type":"main","index":0}]]},"Get Group Name":{"main":[[{"node":"Add Row Text","type":"main","index":0}]]},"IF New Group":{"main":[[{"node":"Mail New Group","type":"main","index":0},{"node":"WAP New Group","type":"main","index":0},{"node":"Search RemoteJid","type":"main","index":0}],[{"node":"Get Group Name","type":"main","index":0}]]},"Search RemoteJid":{"main":[[{"node":"RemoteJid Empty","type":"main","index":0}]]},"RemoteJid Empty":{"main":[[{"node":"Set RemoteJid","type":"main","index":0}],[{"node":"do nothing new remoteJid","type":"main","index":0}]]},"Set RemoteJid":{"main":[[]]},"Exist User IFX?":{"main":[[{"node":"Search Real Name}","type":"main","index":0}]]},"Check Real Name":{"main":[[{"node":"Exist User IFX?","type":"main","index":0}]]},"Search Real Name}":{"main":[[{"node":"Set Real Name","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"America/Bogota","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"Txht1wrdLAI370JY","timeSavedPerExecution":5,"executionTimeout":600,"saveDataSuccessExecution":"all","saveExecutionProgress":true,"saveManualExecutions":true},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"2cb5c574-0607-4382-a61a-a98f1707b046","triggerCount":1,"tags":[]}