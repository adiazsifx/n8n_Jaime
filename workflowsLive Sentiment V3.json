{"createdAt":"2025-06-13T14:23:59.934Z","updatedAt":"2025-06-13T16:15:41.000Z","id":"TzNjjOOGA1KWGhbn","name":"Live Sentiment V3","active":false,"isArchived":false,"nodes":[{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"tableName":{"__rl":true,"value":"messages","mode":"list","cachedResultName":"messages"},"additionalFields":{},"options":{}},"type":"n8n-nodes-base.postgresTrigger","typeVersion":1,"position":[-1080,-740],"id":"5191c992-f66a-446c-975a-bd62e3e12e33","name":"Postgres Trigger","credentials":{"postgres":{"id":"8GkMmZaSPz5j95ME","name":"Postgres DB Whisper"}}},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"es\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Alerta de Sentimiento Negativo</title>\n  <style>\n    /* Estilos generales - con mayor compatibilidad para clientes de correo */\n    body {\n      font-family: Arial, Helvetica, sans-serif;\n      margin: 0;\n      padding: 0;\n      background-color: #F5F5F5;\n      color: #333333;\n    }\n  </style>\n</head>\n\n<body style=\"margin: 0; padding: 0; background-color: #F5F5F5; font-family: Arial, Helvetica, sans-serif;\">\n  <!-- Wrapper para mayor compatibilidad con clientes de correo -->\n  <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\" style=\"background-color: #F5F5F5;\">\n    <tr>\n      <td align=\"center\" valign=\"top\" style=\"padding: 20px 0;\">\n        <!-- Contenedor principal -->\n        <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"680\" class=\"container\"\n          style=\"background-color: #FFFFFF; border: 1px solid #E0E0E0; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\">\n          <!-- Encabezado -->\n          <tr>\n            <td align=\"center\" valign=\"top\"\n              style=\"background-color: #ff8a64; color: #FFFFFF; padding: 10px; border-top-left-radius: 8px; border-top-right-radius: 8px;\">\n              <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\">\n                <tr>\n                  <td align=\"left\" valign=\"middle\" width=\"80\" style=\"color: white;\">\n                    <span\n                      style=\"font-size: 68px; font-style: italic; font-family: serif; padding-left: 12px;\">ifx</span>\n                  </td>\n                  <td align=\"center\" valign=\"middle\" style=\"color: white\">\n                    <h1 style=\"margin: 0; font-size: 24px; font-weight: 600; \">Situaci贸n Cr铆tica en Proceso</h1>\n                    <h2 style=\"margin: 0; font-size: 18px; font-weight: 400;\">WhatsApp</h2>\n                    <p style=\"margin: 5px 0 0; font-size: 14px; align-items: end;\">Generated by <span\n                        style=\"font-style: italic; font-family: serif; font-size: 16px;\">aifx</span></p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n\n          <!-- NUEVA SECCIN: An谩lisis de Sentimiento -->\n          <tr>\n            <td style=\"padding: 25px 0 0 25px;\">\n              <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\" class=\"section\">\n                <tr>\n                  <td>\n                    <!-- T铆tulo de secci贸n con icono alineado -->\n                    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\" class=\"section-title\"\n                      style=\"border-bottom: 2px solid #FF8A65; margin-bottom: 8px; padding-bottom: 8px; border-radius: 8px;\">\n                      <tr>\n                        <td>\n                          <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" class=\"icon-title-wrapper\">\n                            <tr>\n                              <td valign=\"middle\" class=\"icon-wrapper\" style=\"padding-right: 8px;\">\n                                <icon></icon>\n                              </td>\n                              <td valign=\"middle\" class=\"title-text\"\n                                style=\"font-size: 20px; font-weight: bold; color: #FF8A65;\">\n                                An谩lisis de Sentimiento\n                              </td>\n                            </tr>\n                          </table>\n                        </td>\n                      </tr>\n                    </table>\n\n                    <!-- Categor铆a de sentimiento -->\n                    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\"\n                      style=\"margin-bottom: 8px; mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\n                      <tr>\n                        <td align=\"center\" style=\"mso-line-height-rule: exactly;\">\n                          <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\"\n                            style=\"display: inline-block; mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\n                            <tr>\n                              <td\n                                style=\"font-size: 16px; font-weight: bold; color: #FFFFFF; background-color: #FF5252; border-radius: 4px; padding: 4px 12px; text-align: center; mso-line-height-rule: exactly;\">\n                               {{ $('Edit Fields').first().json.sentimiento }}\n                              </td>\n                            </tr>\n                          </table>\n                        </td>\n                      </tr>\n                    </table>\n\n                    <!-- M茅tricas en formato tabla para mayor compatibilidad con clientes de correo -->\n                    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\"\n                      style=\"margin-bottom: 8px; mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\n                      <tr>\n                        <td width=\"20%\" style=\"mso-line-height-rule: exactly;\">&nbsp;</td>\n                        <td width=\"20%\"\n                          style=\"background-color: #FFF3E0; border-radius: 8px; border: 1px solid #FFCC80; padding: 12px; text-align: center; mso-line-height-rule: exactly;\">\n                          <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\"\n                            style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\n                            <tr>\n                              <td style=\"text-align: center; padding: 0;\">\n                                <div style=\"font-size: 12px; color: #666666; mso-line-height-rule: exactly;\">Intensidad\n                                </div>\n                                <div id=\"strength\"\n                                  style=\"font-size: 18px; font-weight: bold; color: #FF8A65; margin: 5px 0; mso-line-height-rule: exactly;\">\n                                   {{ $('Edit Fields').first().json.intensidad }}</div>\n                              </td>\n                            </tr>\n                          </table>\n                        </td>\n                        <td width=\"20%\" style=\"mso-line-height-rule: exactly;\">&nbsp;</td>\n                        <td width=\"20%\"\n                          style=\"background-color: #FFF3E0; border-radius: 8px; border: 1px solid #FFCC80; padding: 12px; text-align: center; mso-line-height-rule: exactly;\">\n                          <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\"\n                            style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\n                            <tr>\n                              <td style=\"text-align: center; padding: 0;\">\n                                <div style=\"font-size: 12px; color: #666666; mso-line-height-rule: exactly;\">Certeza\n                                </div>\n                                <div id=\"confidence\"\n                                  style=\"font-size: 18px; font-weight: bold; color: #FF8A65; margin: 5px 0; mso-line-height-rule: exactly;\">\n                                  {{ $('Edit Fields').first().json.confianza }}</div>\n                              </td>\n                            </tr>\n                          </table>\n                        </td>\n                        <td width=\"20%\" style=\"mso-line-height-rule: exactly;\">&nbsp;</td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n\n          <!-- Secci贸n de Informaci贸n del Chat -->\n          <tr>\n            <td style=\"padding: 25px 25px 0 25px;\">\n              <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\" class=\"section\">\n                <tr>\n                  <td>\n                    <!-- T铆tulo de secci贸n con icono alineado -->\n                    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\" class=\"section-title\"\n                      style=\"border-bottom: 2px solid #64B5F6; margin-bottom: 15px; padding-bottom: 8px; border-radius: 8px;\">\n                      <tr>\n                        <td>\n                          <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" class=\"icon-title-wrapper\">\n                            <tr>\n                              <td valign=\"middle\" class=\"icon-wrapper\" style=\"padding-right: 8px;\">\n                                <icon></icon>\n                              </td>\n                              <td valign=\"middle\" class=\"title-text\"\n                                style=\"font-size: 20px; font-weight: bold; color: #64B5F6;\">\n                                Informaci贸n del Chat\n                              </td>\n                            </tr>\n                          </table>\n                        </td>\n                      </tr>\n                    </table>\n\n                    <!-- Informaci贸n del chat -->\n                    <div class=\"info-item\" style=\"margin-bottom: 10px; font-size: 16px; line-height: 1.6;\">\n                      <span class=\"info-label\" style=\"font-weight: bold; color: #555555;\">Chat:</span> {{ $('Edit Fields').first().json.chat }}\n                    </div>\n                    <div class=\"info-item\" style=\"margin-bottom: 10px; font-size: 16px; line-height: 1.6;\">\n                      <span class=\"info-label\" style=\"font-weight: bold; color: #555555;\">Cliente:</span> {{ $('Edit Fields').first().json.cliente }}\n                    </div>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n\n          <!-- Secci贸n de Mensajes Clave -->\n          <tr>\n            <td style=\"padding: 0 25px;\">\n              <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\" class=\"section\">\n                <tr>\n                  <td>\n                    <!-- T铆tulo de secci贸n con icono alineado -->\n                    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\" class=\"section-title\"\n                      style=\"border-bottom: 2px solid #64B5F6; margin-bottom: 15px; padding-bottom: 8px; border-radius: 8px;\">\n                      <tr>\n                        <td>\n                          <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" class=\"icon-title-wrapper\">\n                            <tr>\n                              <td valign=\"middle\" class=\"icon-wrapper\" style=\"padding-right: 8px;\">\n                                <icon></icon>\n                              </td>\n                              <td valign=\"middle\" class=\"title-text\"\n                                style=\"font-size: 20px; font-weight: bold; color: #64B5F6;\">\n                                Mensajes Clave\n                              </td>\n                            </tr>\n                          </table>\n                        </td>\n                      </tr>\n                    </table>\n                  {{ $('Table Messages').item.json.html_mensajes }}\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n\n          <!-- Secci贸n de Resumen IA del Origen del Sentimiento -->\n          <tr>\n            <td style=\"padding: 0 25px;\">\n              <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\" class=\"section\">\n                <tr>\n                  <td>\n                    <!-- T铆tulo de secci贸n con icono alineado -->\n                    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\" class=\"section-title\"\n                      style=\"border-bottom: 2px solid #FF8A65; margin-bottom: 15px; padding-bottom: 8px; border-radius: 8px;\">\n                      <tr>\n                        <td>\n                          <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" class=\"icon-title-wrapper\">\n                            <tr>\n                              <td valign=\"middle\" class=\"icon-wrapper\" style=\"padding-right: 8px;\">\n                                <icon></icon>\n                              </td>\n                              <td valign=\"middle\" class=\"title-text\"\n                                style=\"font-size: 20px; font-weight: bold; color: #FF8A65;\">\n                                Origen Detallado del Sentimiento Negativo\n                              </td>\n                            </tr>\n                          </table>\n                        </td>\n                      </tr>\n                    </table>\n\n                    <!-- Caja de resumen IA -->\n                    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\"\n                      style=\"background-color: #FFF3E0; border: 1px solid #FFCC80; border-left: 5px solid #FF8A65; margin-bottom: 15px; border-radius: 8px;\">\n                      <tr>\n                        <td style=\"padding: 15px;\">\n                          <p id=\"resumen\" class=\"summary-text\" style=\"margin: 0; line-height: 1.7; font-size: 15px;\">\n                            {{ $('Code').item.json.analisis_sentimiento.origen }}\n                          </p>\n                        </td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n\n          <!-- NUEVA SECCIN: Recomendaciones -->\n          <tr>\n            <td style=\"padding: 0 25px;\">\n              <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\" class=\"section\">\n                <tr>\n                  <td>\n                    <!-- T铆tulo de secci贸n con icono alineado -->\n                    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\" class=\"section-title\"\n                      style=\"border-bottom: 2px solid #4CAF50; margin-bottom: 15px; padding-bottom: 8px; border-radius: 8px;\">\n                      <tr>\n                        <td>\n                          <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" class=\"icon-title-wrapper\">\n                            <tr>\n                              <td valign=\"middle\" class=\"icon-wrapper\" style=\"padding-right: 8px;\">\n                                <icon></icon>\n                              </td>\n                              <td valign=\"middle\" class=\"title-text\"\n                                style=\"font-size: 20px; font-weight: bold; color: #4CAF50;\">\n                                Recomendaciones\n                              </td>\n                            </tr>\n                          </table>\n                        </td>\n                      </tr>\n                    </table>\n\n                    <!-- Caja de recomendaciones -->\n                    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\"\n                      style=\"background-color: #E8F5E9; border: 1px solid #A5D6A7; border-left: 5px solid #4CAF50; margin-bottom: 15px; border-radius: 8px; mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\n                      <tr>\n                        <td style=\"padding: 15px;\">\n                          <p id=\"recomendaciones\" class=\"summary-text\"\n                            style=\"margin: 0; line-height: 1.7; font-size: 15px; mso-line-height-rule: exactly;\">\n                             {{ $('Edit Fields').first().json.recomendacion }}\n                          </p>\n                        </td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n\n          <!-- Pie de p谩gina -->\n          <tr>\n            <td style=\"padding: 15px 25px; text-align: center; border-top: 1px solid #EEEEEE;\">\n              <p style=\"margin: 0; font-size: 14px; color: #888888;\"> Este contenido fue generado autom谩ticamente el {{ $now.toLocal().format('dd-MMM-yyyy') }} a las\n                {{ $now.toLocal().format('HH:MM') }}</p>\n              <p style=\"margin: 0; font-size: 12px; color: #888888;\">IFX Networks 漏 {{ $now.format('yyyy') }}</p>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>\n</body>\n\n</html>\n"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[2156,-40],"id":"14579c05-02cc-4f22-9fbd-cf25e9765f07","name":"HTML","disabled":true},{"parameters":{"assignments":{"assignments":[{"id":"6860e2d3-4d4d-4f26-a2eb-2989de32d2de","name":"sentimiento","value":"={{ $('Sentiment Analysis').item.json.sentimentAnalysis.category }}","type":"object"},{"id":"18d305b3-76d0-454f-ab50-e7143b1ba23e","name":"confianza","value":"={{ $('Sentiment Analysis').item.json.sentimentAnalysis.confidence * 100 }}%","type":"number"},{"id":"a4685efa-e3ef-4767-932c-03601e4d5134","name":"intensidad","value":"={{ $('Sentiment Analysis').item.json.sentimentAnalysis.strength * 100  }}%","type":"number"},{"id":"98f89597-97c1-4195-8a13-0b726062a764","name":"chat","value":"={{ $('Query Back Chat').first().json.nombrechat.toUpperCase() }}","type":"string"},{"id":"24d83b52-2de3-44e1-8110-9387f1d003db","name":"cliente","value":"={{ ($('Postgres Trigger').first().json.payload.nombrecliente?.trim() || $('Postgres Trigger').first().json.payload.nombrechat?.trim() || '').toUpperCase() }}","type":"string"},{"id":"9291f0f7-86d3-4057-bebe-5e6d267e58f4","name":"mensajes_negativos","value":"={{ $json.mensajes }}","type":"string"},{"id":"382f4d98-3ab0-486c-89cd-46a228f7d4d0","name":"recomendacion","value":"={{ $json.recomendaciones_preventivas.texto }}","type":"string"},{"id":"164de25b-1aa8-4e3f-a42e-e0fdeff54e3e","name":"origen","value":"={{ $json.analisis_sentimiento.origen }}","type":"string"}]},"options":{"ignoreConversionErrors":true}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1496,-240],"id":"2310e68b-01e6-49d6-8490-4e6adeff6953","name":"Edit Fields","disabled":true},{"parameters":{"operation":"executeQuery","query":"SELECT * FROM (\n    SELECT      \n        \"remoteJid\",\n        participant,\n        \"pushName\",\n        conversation,\n        \"dateTime\",\n        sender,\n        nombrechat,\n        nombrecliente\n    FROM \n        public.messages\n    WHERE \n        \"remoteJid\" = '{{ $('Postgres Trigger').item.json.payload.remoteJid}}'\n        AND \"dateTime\" >= NOW() - INTERVAL '8 hours'\n    ORDER BY \n        \"dateTime\" DESC\n) AS subquery\nORDER BY \"dateTime\" ASC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-860,-740],"id":"6b973229-11d0-4a9d-89cf-b79ecb5ae978","name":"Query Back Chat","alwaysOutputData":true,"credentials":{"postgres":{"id":"8GkMmZaSPz5j95ME","name":"Postgres DB Whisper"}}},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-420,-740],"id":"656036af-98f7-470b-acf8-3759eaf3660b","name":"Merge Data Chat"},{"parameters":{"jsCode":"// Obtener los datos de entrada y parsear si es string\nlet mensajes = $input.first().json.mensajes_negativos || [];\n\n// Parsear el JSON si viene como string\nif (typeof mensajes === 'string') {\n  try {\n    mensajes = JSON.parse(mensajes);\n  } catch (e) {\n    console.log('Error parseando JSON:', e);\n    mensajes = [];\n  }\n}\n\n// Verificar que sea un array\nif (!Array.isArray(mensajes)) {\n  mensajes = [];\n}\n\n// Funci贸n para limpiar mensaje (remover an谩lisis y recomendaciones)\nfunction limpiarMensaje(mensaje) {\n  if (!mensaje) return '';\n  \n  // Remover todo despu茅s de \"## Origen del Sentimiento Negativo\"\n  let mensajeLimpio = mensaje.split('## Origen del Sentimiento Negativo')[0];\n  \n  // Remover todo despu茅s de \"## Recomendaci贸n Preventiva\"\n  mensajeLimpio = mensajeLimpio.split('## Recomendaci贸n Preventiva')[0];\n  \n  return mensajeLimpio.trim();\n}\n\n// Funci贸n para convertir markdown a HTML (simplificada para mensajes)\nfunction convertirMarkdownAHTML(texto) {\n  if (!texto) return '';\n  \n  // Limpiar el mensaje primero\n  texto = limpiarMensaje(texto);\n  \n  let html = texto;\n  \n  // Convertir texto en negrita (**texto**)\n  html = html.replace(/\\*\\*(.+?)\\*\\*/g, '<strong style=\"font-weight: bold; color: #333333;\">$1</strong>');\n  \n  // Convertir texto en cursiva (*texto*)\n  html = html.replace(/\\*(.+?)\\*/g, '<em style=\"font-style: italic;\">$1</em>');\n  \n  // Convertir saltos de l铆nea\n  html = html.replace(/\\n\\n/g, '</p><p style=\"margin: 10px 0; color: #333333; line-height: 1.5;\">');\n  html = html.replace(/\\n/g, '<br>');\n  \n  // Envolver en p谩rrafos\n  html = '<p style=\"margin: 10px 0; color: #333333; line-height: 1.5;\">' + html + '</p>';\n  \n  return html;\n}\n\n// Funci贸n para generar el HTML de cada mensaje\nfunction generarHTMLMensaje(chat) {\n  // Convertir el mensaje de markdown a HTML\n  const mensajeHTML = convertirMarkdownAHTML(chat.mensaje);\n  \n  return `<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\"\n style=\"border: 1px solid #DDDDDD; border-radius: 8px; margin-bottom: 10px; background-color: #FAFAFA;\">\n <tr>\n <td style=\"padding: 10px;\">\n <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\">\n <tr>\n <td class=\"message-header\">\n <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n <tr>\n <td valign=\"middle\" style=\"padding-right: 5px;\">\n <icon></icon>\n </td>\n <td valign=\"middle\">\n <span class=\"message-sender\"\n style=\"font-weight: bold; color: #333333;\">${chat.pushname}</span>\n <span class=\"message-time\"\n style=\"font-size: 0.85em; color: #777777; margin-left: 10px;\">${chat.hora}</span>\n </td>\n </tr>\n </table>\n </td>\n </tr>\n <tr>\n <td class=\"message-content\" style=\"padding-top: 5px; color: #333333;\">\n ${mensajeHTML}\n </td>\n </tr>\n </table>\n </td>\n </tr>\n </table>`;\n}\n\n// Generar HTML solo para los mensajes extra铆dos\nconst htmlCompleto = mensajes.map(chat => generarHTMLMensaje(chat)).join('\\n');\n\n// Retornar el resultado\nreturn {\n  json: {\n    html_mensajes: htmlCompleto,\n    total_mensajes: mensajes.length\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1716,-140],"id":"55d8710a-bc6d-401e-85a5-4aa65b7fa844","name":"Table Messages","disabled":true},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"summary_sentimientos","mode":"list","cachedResultName":"summary_sentimientos"},"columns":{"mappingMode":"defineBelow","value":{"sentimiento":"={{ $json.sentimiento.toUpperCase() }}","confianza":"={{ parseFloat($json.confianza.replace('%', '')) / 100 }}","intensidad":"={{ parseFloat($json.intensidad.replace('%', '')) / 100 }}","chat":"={{ $json.chat }}","cliente":"={{ $json.cliente.toUpperCase() }}","mensajes_negativos":"={{ $json.mensajes_negativos }}","origen_negativo":"={{ $json.origen_negativo }}","recomendacion":"={{ $json.recomendacion }}","remote_jid":"={{ $('Query Back Chat').first().json.remoteJid }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"sentimiento","displayName":"sentimiento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"confianza","displayName":"confianza","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"intensidad","displayName":"intensidad","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"chat","displayName":"chat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"cliente","displayName":"cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"mensajes_negativos","displayName":"mensajes_negativos","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"origen_negativo","displayName":"origen_negativo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"recomendacion","displayName":"recomendacion","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"remote_jid","displayName":"remote_jid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"standby","displayName":"standby","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1716,-340],"id":"7d74f2ab-3c6e-4b2a-af88-4599964973b8","name":"Save Negative","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}},"disabled":true},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"summary_sentimientos","mode":"list","cachedResultName":"summary_sentimientos"},"columns":{"mappingMode":"defineBelow","value":{"sentimiento":"={{ $('Sentiment Analysis').item.json.sentimentAnalysis.category.toUpperCase() }}","confianza":"={{ $json.sentimentAnalysis.confidence }}","intensidad":"={{ $json.sentimentAnalysis.strength }}","chat":"={{ $('Query Back Chat').first().json.nombrechat.toUpperCase() }}","remote_jid":"={{ $('Query Back Chat').first().json.remoteJid }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"sentimiento","displayName":"sentimiento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"confianza","displayName":"confianza","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"intensidad","displayName":"intensidad","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"chat","displayName":"chat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"cliente","displayName":"cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"mensajes_negativos","displayName":"mensajes_negativos","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"origen_negativo","displayName":"origen_negativo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"recomendacion","displayName":"recomendacion","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"remote_jid","displayName":"remote_jid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"standby","displayName":"standby","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[758,-640],"id":"c67a880f-5001-4ac2-90d0-641093db482f","name":"Save Neutral","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}},"disabled":true},{"parameters":{"toRecipients":"ai@ifxcorp.com","subject":"= Situacion Critica en Chat {{ $('Edit Fields').first().json.chat.toUpperCase() }}","bodyContent":"={{ $('HTML').item.json.html }}","additionalFields":{"bccRecipients":"atellez@ifxcorp.com, wrivera@ifxcorp.com, dcubides@ifxcorp.com, cnospina@ifxcorp.com, badevia@ifxcorp.com, aperez@ifxcorp.com, aguevara@ifxcorp.com, lheredia@ifxcorp.com","bodyContentType":"html"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[2816,-140],"id":"1f0aee58-7c27-4092-a49e-d4d4272461b1","name":"Send Alert","webhookId":"30c4955b-9c6f-4ba2-88ea-e08cff57c04f","credentials":{"microsoftOutlookOAuth2Api":{"id":"xSTIlfhp3ac7TN3h","name":"Mail ai@ifxcorp.com"}},"disabled":true},{"parameters":{"operation":"executeQuery","query":"SELECT \n    \"remoteJid\",\n    standby\nFROM \n    public.standby\nWHERE \n    \"remoteJid\" = '{{ $('Query Back Chat').first().json.remoteJid }}';","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2376,-40],"id":"7a1c5f17-171b-4ead-89b2-4a0fadac4d12","name":"Check Standby","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}},"disabled":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ba0e0909-f9aa-4372-be69-fc52474a58f8","leftValue":"={{ $json.standby }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2596,-40],"id":"0878faf1-793f-46ba-b4d8-2328eec0b101","name":"Standby?","disabled":true},{"parameters":{"operation":"update","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"standby","mode":"list","cachedResultName":"standby"},"columns":{"mappingMode":"defineBelow","value":{"standby":true,"remoteJid":"={{ $('Query Back Chat').first().json.remoteJid }}"},"matchingColumns":["remoteJid"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"remoteJid","displayName":"remoteJid","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"standby","displayName":"standby","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[3036,-140],"id":"c89b46f4-da15-4ccd-a43f-fe2155be0447","name":"Set StandBy","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}},"disabled":true},{"parameters":{"operation":"executeQuery","query":"SELECT \n    \"remoteJid\",\n    standby,\n    \"updated_at\"\nFROM \n    public.standby\nWHERE \n    \"remoteJid\" = '{{ $json.payload.remoteJid }}';","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-860,-1040],"id":"e35c7a4a-29b6-493a-9014-0e732bda0b3c","name":"Query Standby Time","alwaysOutputData":true,"credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}},"disabled":true},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2816,-340],"id":"ed30a276-5f00-46ca-925c-868703ddbd72","name":"Do nothing","disabled":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"81ea6566-446c-4d7b-83b9-64a762e23a92","leftValue":"={{ $json.standby }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}},{"id":"896b6eea-de78-4de6-903f-6203c2144b54","leftValue":"={{ (Date.now() - new Date($json.updated_at).getTime()) < (4 * 60 * 60 * 1000) }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-640,-1040],"id":"cad8d16b-e4fa-4d06-a449-a5ea8c5904ed","name":"Time Off","disabled":true},{"parameters":{"operation":"executeQuery","query":"UPDATE public.standby \nSET \n    standby = false,\n    \"updated_at\" = NOW()\nWHERE \n    \"remoteJid\" = '{{ $('Time Off').item.json.remoteJid }}';","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-420,-1140],"id":"10aa5aae-7b68-4861-895e-a42c0ee25794","name":"Set False Standby","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}},"disabled":true},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-420,-940],"id":"e5c04889-02cd-45fb-a5b6-3c883a33792f","name":"Do nothing Time Off","disabled":true},{"parameters":{"toRecipients":"jaimep@ifxcorp.com","subject":"=Testing **  Situacion Critica en Chat {{ $('Edit Fields').first().json.chat.toUpperCase() }}","bodyContent":"={{ $('HTML').item.json.html }}","additionalFields":{"bodyContentType":"html"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[2816,60],"id":"a61c1c07-d0c4-4588-a317-3195528e447d","name":"Send Testing","webhookId":"a5f689a1-aadf-4fa6-9aba-680502dab9bf","credentials":{"microsoftOutlookOAuth2Api":{"id":"xSTIlfhp3ac7TN3h","name":"Mail ai@ifxcorp.com"}},"disabled":true},{"parameters":{"assignments":{"assignments":[{"id":"dcdb679a-21e0-4a37-a0de-1772232036fd","name":"remoteJid","value":"={{ $json.remoteJid }}","type":"string"},{"id":"b4e25dc6-d7ea-4316-8c3c-9ad78c5990cb","name":"participant","value":"={{ $json.participant }}","type":"string"},{"id":"77b5d2a4-c678-47a2-b97a-4a07f07c7d20","name":"pushName","value":"={{ $json.pushName }}","type":"string"},{"id":"143584e3-ce47-40ec-95ca-a49266dcc0e6","name":"conversation","value":"={{ $json.conversation }}","type":"string"},{"id":"18d0ea61-8b0a-4409-9f50-f72480a2cd2b","name":"dateTime","value":"={{ $json.dateTime }}","type":"string"},{"id":"1bc1fb11-7e8f-47cc-883b-72b16214e881","name":"sender","value":"={{ $json.sender }}","type":"string"},{"id":"e04e4148-e574-4a31-b0e0-1218e4158ba9","name":"nombrechat","value":"={{ $json.nombrechat }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-640,-740],"id":"14f5e6c4-7453-4b56-85b8-dc979c094a97","name":"Edit Fields1"},{"parameters":{"jsCode":"const rawText = $input.first().json.output || '';\nconst cleanText = rawText.replace(/\\\\n/g, '\\n').replace(/\\\\t/g, '\\t');\n\nfunction extractMessages(text) {\n  const messages = [];\n  \n  // Regex para formato - **Pushname**: valor\n  const messageRegex = /- \\*\\*Pushname\\*\\*:\\s*([^\\n]+)\\n\\s*- \\*\\*Hora\\*\\*:\\s*`?([^`\\n]+)`?\\n\\s*- \\*\\*Mensaje\\*\\*:\\s*([^-]*?)(?=\\n- \\*\\*Pushname\\*\\*|$)/g;\n  \n  let match;\n  while ((match = messageRegex.exec(text)) !== null) {\n    messages.push({\n      pushname: match[1].trim(),\n      hora: match[2].trim(),\n      mensaje: match[3].trim()\n    });\n  }\n  \n  return messages;\n}\n\nfunction extractAnalysis(text) {\n  const match = text.match(/## Origen del Sentimiento Negativo\\n([\\s\\S]*?)(?=\\n### Recomendaci贸n Preventiva|\\n## Recomendaci贸n Preventiva|$)/);\n  let analysis = match ? match[1].trim() : '';\n  \n  // Limpiar markdown del an谩lisis\n  analysis = analysis.replace(/\\\\n/g, '\\n'); // Convertir \\\\n a \\n\n  analysis = analysis.replace(/\\*\\*/g, ''); // Remover **\n  analysis = analysis.replace(/^#+\\s*/gm, ''); // Remover # al inicio de l铆neas\n  \n  return analysis;\n}\n\nfunction extractRecommendations(text) {\n  const match = text.match(/(?:###|##)\\s*Recomendaci贸n Preventiva\\n([\\s\\S]*?)$/);\n  let recommendations = match ? match[1].trim() : '';\n  \n  // Limpiar markdown de las recomendaciones\n  recommendations = recommendations.replace(/\\\\n/g, '\\n'); // Convertir \\\\n a \\n\n  recommendations = recommendations.replace(/\\*\\*/g, ''); // Remover **\n  recommendations = recommendations.replace(/^#+\\s*/gm, ''); // Remover # al inicio de l铆neas\n  \n  return recommendations;\n}\n\nconst messages = extractMessages(cleanText);\nconst analysis = extractAnalysis(cleanText);\nconst recommendations = extractRecommendations(cleanText);\n\n// Verificar falso positivo\nconst isFalsePositive = (\n  analysis.toLowerCase().includes('no se detecta') && \n  (analysis.toLowerCase().includes('sentimiento negativo') || analysis.toLowerCase().includes('conflicto'))\n) || recommendations.toLowerCase().includes('no se requiere recomendaci贸n');\n\nif (isFalsePositive) {\n  return [{\n    json: {\n      resultado: 'falso_positivo',\n      mensaje: 'No se detect贸 sentimiento negativo real en el contenido',\n      metadata: {\n        procesado_en: new Date().toISOString(),\n        version_parser: '1.7_js_fixed'\n      }\n    }\n  }];\n}\n\nconst output = {\n  resumen: {\n    total_mensajes: messages.length,\n    usuarios_involucrados: [...new Set(messages.map(m => m.pushname))],\n    rango_temporal: {\n      primer_mensaje: messages.length > 0 ? messages[0].hora : null,\n      ultimo_mensaje: messages.length > 0 ? messages[messages.length - 1].hora : null\n    }\n  },\n  mensajes: messages,\n  analisis_sentimiento: {\n    origen: analysis,\n    texto_completo: analysis\n  },\n  recomendaciones_preventivas: {\n    texto: recommendations\n  },\n  metadata: {\n    procesado_en: new Date().toISOString(),\n    version_parser: '1.7_js_fixed'\n  }\n};\n\nreturn [{ json: output }];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1276,-240],"id":"675cbbf0-e792-4bd6-9eba-6e87d442be56","name":"Code","disabled":true},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"summary_sentimientos","mode":"list","cachedResultName":"summary_sentimientos"},"columns":{"mappingMode":"defineBelow","value":{"sentimiento":"={{ $('Sentiment Analysis').item.json.sentimentAnalysis.category.toUpperCase() }}","confianza":"={{ $json.sentimentAnalysis.confidence }}","intensidad":"={{ $json.sentimentAnalysis.strength }}","chat":"={{ $('Query Back Chat').first().json.nombrechat.toUpperCase() }}","remote_jid":"={{ $('Query Back Chat').first().json.remoteJid }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"sentimiento","displayName":"sentimiento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"confianza","displayName":"confianza","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"intensidad","displayName":"intensidad","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"chat","displayName":"chat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"cliente","displayName":"cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"mensajes_negativos","displayName":"mensajes_negativos","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"origen_negativo","displayName":"origen_negativo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"recomendacion","displayName":"recomendacion","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"remote_jid","displayName":"remote_jid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"standby","displayName":"standby","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[758,-840],"id":"ae72af24-c014-4776-8601-8ecc5adb8c2a","name":"Save Positive","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}},"disabled":true},{"parameters":{"model":{"__rl":true,"value":"llama-3.3-70B-Instruct","mode":"list","cachedResultName":"llama-3.3-70B-Instruct"},"options":{"temperature":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-992,1360],"id":"1a3babd1-d463-4160-89b0-9ccf3bcdba23","name":"Llama Negativo","credentials":{"openAiApi":{"id":"3ksygUY2AafRzzfk","name":"Proxy LiteLLM"}},"disabled":true},{"parameters":{"model":{"__rl":true,"value":"llama-8B-Instruct","mode":"list","cachedResultName":"llama-8B-Instruct"},"options":{"temperature":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[640,-220],"id":"7acc8272-1a91-43bf-ad32-770db29539ad","name":"Llama 3.1 8B","credentials":{"openAiApi":{"id":"3ksygUY2AafRzzfk","name":"Proxy LiteLLM"}},"disabled":true},{"parameters":{"jsCode":"// N8N Function Node - Convierte markdown de sentimientos negativos a JSON\n// Obtener el texto de entrada\nconst inputText = $input.first().json.output || '';\n\n// Funci贸n para extraer mensajes\nfunction extractMessages(text) {\n  const messages = [];\n  \n  // Primero extraer solo la secci贸n de mensajes\n  const mensajesSection = extractSection(text, 'Mensajes Origen del Sentimiento Negativo');\n  \n  if (!mensajesSection) return messages;\n  \n  // Regex mejorada para capturar los mensajes correctamente\n  const messageRegex = /- \\*\\*Pushname\\*\\*:\\s*(.+?)\\n\\s*- \\*\\*Hora\\*\\*:\\s*(.+?)\\n\\s*- \\*\\*Mensaje\\*\\*:\\s*(.+?)(?=\\n- \\*\\*Pushname\\*\\*|$)/gs;\n  \n  let match;\n  while ((match = messageRegex.exec(mensajesSection)) !== null) {\n    messages.push({\n      pushname: match[1].trim(),\n      hora: match[2].trim(),\n      mensaje: match[3].trim()\n    });\n  }\n  \n  return messages;\n}\n\n// Funci贸n para extraer secci贸n por t铆tulo\nfunction extractSection(text, title) {\n  const regex = new RegExp(`## ${title}\\\\n([\\\\s\\\\S]*?)(?=\\\\n## |$)`, 'i');\n  const match = text.match(regex);\n  return match ? match[1].trim() : '';\n}\n\n// Extraer todas las secciones\nconst messages = extractMessages(inputText);\nconst origenSentimiento = extractSection(inputText, 'Origen del Sentimiento Negativo');\nconst recomendacionPreventiva = extractSection(inputText, 'Recomendaci贸n Preventiva');\n\n// Procesar recomendaciones (convertir lista markdown a array)\nfunction processRecommendations(text) {\n  const recommendations = [];\n  const lines = text.split('\\n');\n  \n  for (const line of lines) {\n    const trimmedLine = line.trim();\n    if (trimmedLine.startsWith('- ')) {\n      recommendations.push(trimmedLine.substring(2).trim());\n    }\n  }\n  \n  return recommendations;\n}\n\nconst recomendaciones = processRecommendations(recomendacionPreventiva);\n\n// Crear objeto de salida estructurado\nconst output = {\n  resumen: {\n    total_mensajes: messages.length,\n    usuarios_involucrados: [...new Set(messages.map(m => m.pushname))],\n    rango_temporal: {\n      primer_mensaje: messages.length > 0 ? messages[0].hora : null,\n      ultimo_mensaje: messages.length > 0 ? messages[messages.length - 1].hora : null\n    }\n  },\n  mensajes: messages,\n  analisis_sentimiento: {\n    origen: origenSentimiento,\n    texto_completo: origenSentimiento\n  },\n  recomendaciones_preventivas: {\n    lista: recomendaciones,\n    total: recomendaciones.length,\n    texto_completo: recomendacionPreventiva\n  },\n  metadata: {\n    procesado_en: new Date().toISOString(),\n    tipo_contenido: \"analisis_sentimiento_negativo\",\n    version_parser: \"1.0\"\n  }\n};\n\n// Crear salidas m煤ltiples para n8n\nreturn [\n  // Salida 1: Datos completos\n  {\n    json: output\n  },\n  // Salida 2: Solo mensajes\n  {\n    json: {\n      mensajes: messages,\n      total_mensajes: messages.length\n    }\n  },\n  // Salida 3: Solo an谩lisis de sentimiento\n  {\n    json: {\n      origen_sentimiento: origenSentimiento,\n      usuarios_involucrados: [...new Set(messages.map(m => m.pushname))]\n    }\n  },\n  // Salida 4: Solo recomendaciones\n  {\n    json: {\n      recomendaciones: recomendaciones,\n      total_recomendaciones: recomendaciones.length\n    }\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1080,780],"id":"fb631808-66d5-4858-b89f-f3782e5b6d91","name":"Code Llama 3.3","disabled":true},{"parameters":{"content":"## Reserve\nModelo Llama 3.3 70B en caso que 3.1 empiece a fallar","height":480,"width":620},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1262,1020],"id":"7bd22e07-b1b3-4031-a837-0cceb8756f82","name":"Sticky Note"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"5ff0d28e-7fca-4fdc-a072-0a89779ff15b","leftValue":"={{ $json.output }}","rightValue":"={{ $json.output.includes(\"No hay informaci贸n suficiente para analizar el conflicto\") || $json.output.includes(\"No hay mensajes relevantes para detectar sentimientos negativos\") || $json.output.includes(\"sin informacion\") }}","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1056,-340],"id":"41d9b1ab-0554-43d8-985b-2a80ec2a7781","name":"If1","alwaysOutputData":true,"disabled":true},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"summary_sentimientos","mode":"list","cachedResultName":"summary_sentimientos"},"columns":{"mappingMode":"defineBelow","value":{"sentimiento":"NEUTRAL","confianza":"={{ $('Sentiment Analysis').item.json.sentimentAnalysis.confidence }}","intensidad":"={{ $('Sentiment Analysis').item.json.sentimentAnalysis.strength }}","chat":"={{ $('Query Back Chat').first().json.nombrechat.toUpperCase() }}","remote_jid":"={{ $('Query Back Chat').first().json.remoteJid }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"sentimiento","displayName":"sentimiento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"confianza","displayName":"confianza","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"intensidad","displayName":"intensidad","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"chat","displayName":"chat","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"cliente","displayName":"cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"mensajes_negativos","displayName":"mensajes_negativos","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"origen_negativo","displayName":"origen_negativo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"recomendacion","displayName":"recomendacion","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"remote_jid","displayName":"remote_jid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"standby","displayName":"standby","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1276,-440],"id":"d091cf9f-4580-4b19-abaa-be9de8df6c36","name":"Save Fake Negative","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}},"disabled":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0738c036-19e8-4e92-9360-4ed76697a929","leftValue":"={{ $json.html_mensajes }}","rightValue":1,"operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1936,-140],"id":"d26d6b0a-87ab-45fa-9542-7e7470ded3bd","name":"If2","disabled":true},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2156,-240],"id":"5ed6e743-0a37-45c7-8b65-64cb8d5da2e6","name":"No Operation, do nothing","disabled":true},{"parameters":{"method":"POST","url":"https://api-inference.huggingface.co/models/cardiffnlp/twitter-xlm-roberta-base-sentiment","authentication":"predefinedCredentialType","nodeCredentialType":"huggingFaceApi","sendBody":true,"bodyParameters":{"parameters":[{"name":"inputs","value":"={{ $json.text }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[20,-740],"id":"10d4d8fd-4f5a-4cea-a6ac-c7069eaa9fb3","name":"HTTP Request","credentials":{"huggingFaceApi":{"id":"xUypY4YXN6zGpZ3S","name":"HuggingFaceApi JPG"}}},{"parameters":{"jsCode":"const response = $input.first().json;\n\n// Encontrar la categor铆a con mayor score\nconst highestScore = response.reduce((prev, current) => \n  current.score > prev.score ? current : prev\n);\n\nconst sentiment = highestScore.label.toUpperCase();\nconst confidence = highestScore.score;\n\n// Strength = diferencia entre el m谩s alto y el promedio\nconst avgScore = response.reduce((sum, item) => sum + item.score, 0) / 3;\nconst strength = confidence - avgScore;\n\nreturn {\n  json: {\n    sentimentAnalysis: {\n      category: sentiment,\n      confidence: confidence,\n      strength: Math.max(strength, 0.1), // M铆nimo 0.1\n      all_scores: response\n    }\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[240,-740],"id":"455ea945-4fbf-4fde-a4fd-4283d1c5d87a","name":"Code1"},{"parameters":{"jsCode":"const messages = $input.first().json.data;\n\n// Solo campos relevantes\nlet fullText = messages\n  .map(msg => `${msg.pushName}: ${msg.conversation.replace(/\\\\n/g, ' ').trim()}`)\n  .filter(text => text.length > 5) // Filtrar mensajes vac铆os\n  .join(' ');\n\n// ltimos 512 tokens\nconst words = fullText.split(' ');\nif (words.length > 250) {\n  fullText = words.slice(-250).join(' ');\n}\n\nreturn {\n  json: {\n    text: fullText\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-200,-740],"id":"ac0b93b1-ae6b-4097-881e-a30a7b2e33a1","name":"Code2"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.sentimentAnalysis.category }}","rightValue":"POSITIVE","operator":{"type":"string","operation":"equals"},"id":"2b565810-3aa4-43a3-8410-f7000b557011"}],"combinator":"and"},"renameOutput":true,"outputKey":"POSITIVE"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d8358c56-6c8a-4d26-9fc6-3c00d97af0b9","leftValue":"={{ $json.sentimentAnalysis.category }}","rightValue":"NEUTRAL","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"NEUTRAL"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"93c1e1e6-c1b9-44e8-acf3-4788c902510e","leftValue":"={{ $json.sentimentAnalysis.category }}","rightValue":"NEGATIVE","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"NEGATIVE"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[460,-740],"id":"73d0b462-2de7-4cdc-bbb6-0ca1e559fafc","name":"Switch"},{"parameters":{"promptType":"define","text":"={{ $('Merge Data Chat').item.json.data }}","options":{"systemMessage":"ERES UN AGENTE EXPERTO EN DETECCIN DE SENTIMIENTO NEGATIVO Y CONFLICTOS EN CONVERSACIONES DE WHATSAPP EMPRESARIALES. TU TAREA ES IDENTIFICAR QUEJAS, TONO IRNICO, MOLESTIA O ESCALADAS, Y RESPONDER CON ANLISIS Y RECOMENDACIN EN FORMATO MARKDOWN ESTRICTO Y FIJO.\n\n---\n\n###  INSTRUCCIONES\n\n1. ANALIZA LOS LTIMOS 30 MENSAJES + EL MS RECIENTE\n2. DETECTA INDICIOS DE:\n\n   * QUEJA, SARCASMO, FRUSTRACIN, DESCONFIANZA, PRESIN\n3. SI ENCUENTRAS CONFLICTO, DEVUELVE EL SIGUIENTE FORMATO **SIN MODIFICACIONES**\n4. SI NO HAY CONFLICTO, DEVUELVE NICAMENTE EL BLOQUE EXACTO DE `## An谩lisis`  **NO AADAS NINGUNA EXPLICACIN**\n\n---\n\n###  FORMATO DE SALIDA (MXIMA PRECISIN OBLIGATORIA)\n\n **USA ESTE FORMATO EXACTO. NO LO ALTERES. NO CAMBIES NIVELES DE ENCABEZADO. COPIA LA ESTRUCTURA TAL COMO EST.**\n\n\n## Mensajes Origen del Sentimiento Negativo\n- **Pushname**: <nombre del participante>\n  - **Hora**: `05 may 2025 - 13:45`\n  - **Mensaje**: <mensaje relevante>\n- **Pushname**: <nombre del participante>\n  - **Hora**: `05 may 2025 - 13:50`\n  - **Mensaje**: <otro mensaje relacionado>\n\n## Origen del Sentimiento Negativo\n<An谩lisis completo del conflicto, evoluci贸n del tono, causas t茅cnicas y emocionales, y actores involucrados.>\n\n## Recomendaci贸n Preventiva\n<Recomendaci贸n t谩ctica: qu茅 se debi贸 hacer, qu茅 hacer ahora, c贸mo evitar una escalada mayor. Con tono profesional, claro y diplom谩tico.>\n\n\n---\n\n###  SI NO DETECTAS CONFLICTO O SENTIMIENTO NEGATIVO\n\n **DEVUELVE NICAMENTE EL BLOQUE EXACTO QUE SIGUE  NUNCA AGREGUES JUSTIFICACIONES, ANLISIS NI COMENTARIOS EXPLICATIVOS. NO USES OTROS ENCABEZADOS, NO CAMBIES EL FORMATO.**\n\n\n## An谩lisis\nsin informacion\n\n\nESTA ES LA NICA RESPUESTA PERMITIDA EN CASOS SIN CONFLICTO.\n\n---\n\n###  QU NO HACER\n\n* **NO CAMBIAR LOS ENCABEZADOS NI USAR OTROS NIVELES DE MARKDOWN**\n* **NO USAR `#Pushname` NI `###` NI OTROS FORMATOS**\n* **NO OMITIR EL BLOQUE DE `## Recomendaci贸n Preventiva` SI HAY CONFLICTO**\n* **NO ENTREGAR RESPUESTAS FUERA DEL FORMATO MOSTRADO**\n* **NO USAR MESES EN INGLS NI FORMATO DE FECHA ANGLOSAJN**\n* **NO MENCIONAR EL NOMBRE DEL CLIENTE NI EL NOMBRE DEL CHAT**\n* **NO GENERAR BLOQUES VACOS SI DETECTASTE CONFLICTO**\n* **NO GENERES ANLISIS EXPLICATIVOS SI NO HAY CONFLICTO**\n* **NO ESCRIBAS FRASES COMO El mensaje es informativo, No se detecta conflicto u otras justificaciones**\n* **NO INCLUYAS Recomendaci贸n Preventiva NI CUALQUIER SECCIN ADICIONAL SI NO HAY CONFLICTO**\n* **NO DEVUELVAS OTRO ENCABEZADO QUE NO SEA `## An谩lisis`**\n* **NO CAMBIES sin informacion  DEBE IR TAL CUAL EN MINSCULA**\n\n---\n\n TU OBJETIVO ES PRODUCIR UN BLOQUE MARKDOWN FIJO, SIN VARIACIONES, CON CONTENIDO CLARO, TCTICO Y PROFESIONAL.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[700,-420],"id":"911fa2e3-392c-4acc-b4ab-465914915b79","name":"AI Analist Negative1","alwaysOutputData":true,"retryOnFail":true,"maxTries":5,"executeOnce":false},{"parameters":{"promptType":"define","text":"={{ $json.data.toJsonString() }}","options":{"systemMessage":"ERES UN AGENTE EXPERTO EN ANLISIS DE SENTIMIENTO NEGATIVO EN CONVERSACIONES DE WHATSAPP EMPRESARIALES.\n\nTU MISIN ES DETECTAR CONFLICTOS O EXPRESIONES DE MALESTAR, EXTRAER LOS MENSAJES RELEVANTES Y ENTREGAR UNA RESPUESTA EN **FORMATO MARKDOWN ESTRUCTURADO**, CON SECCIONES CLARAS Y SIN USAR JSON. DEBES ANALIZAR LOS LTIMOS **30 MENSAJES PREVIOS** JUNTO CON EL MENSAJE MS RECIENTE.\n\nEJECUTA LOS SIGUIENTES PASOS PARA TU ANLISIS:\n\n1. **LEER** TODOS LOS MENSAJES Y DETECTAR CUALQUIER SIGNO DE SENTIMIENTO NEGATIVO.\n2. **IDENTIFICAR** MENSAJES CON:\n   - Quejas o reclamos directos\n   - Molestia, sarcasmo, presi贸n, frustraci贸n o desconfianza\n3. **EXTRAER SOLO LOS MENSAJES MS RELEVANTES** (origen del conflicto y escaladas), CON:\n   - `pushname`\n   - `hora` (formato: `DD mon AAAA - HH:MM`, mes en **espa帽ol, tres letras, min煤sculas**)\n   - `mensaje`\n4. **ANALIZAR** EL ORIGEN DEL CONFLICTO:\n   - 驴Qu茅 lo causa?\n   - 驴Escala el tono? 驴C贸mo y por qu茅?\n   - 驴Qu茅 hechos lo sustentan?\n5. **REDACTAR UNA RECOMENDACIN TCTICA Y PROFESIONAL**:\n   - Qu茅 se debi贸 hacer\n   - Qu茅 hacer ahora\n   - C贸mo evitar una escalada mayor\n\n **NO INCLUYAS EL NOMBRE DEL CHAT NI EL NOMBRE DEL CLIENTE EN LA SALIDA**\n\n **SI NO HAY CONFLICTO**, DEVUELVE NICAMENTE ESTA RESPUESTA:\n```\n## An谩lisis\nsin informacion\n```\n\n---\n\n OBJETIVOS PRINCIPALES:\n\n- DETECTAR mensajes con carga emocional negativa\n- EXTRAER CONTEXTO Y PRUEBAS del malestar\n- ANALIZAR LA EVOLUCIN emocional y la interacci贸n\n- EMITIR UNA RECOMENDACIN CON CONTENCIN, LIDERAZGO Y CLARIDAD TCNICA\n\n---\n\n FORMATO DE SALIDA REQUERIDO (EN MARKDOWN ESTRUCTURADO):\n\n```\n## Mensajes Origen del Sentimiento Negativo\n- **Pushname**: <nombre del participante>\n  - **Hora**: `05 may 2025 - 13:45`\n  - **Mensaje**: <mensaje relevante>\n- **Pushname**: <nombre del participante>\n  - **Hora**: `05 may 2025 - 13:50`\n  - **Mensaje**: <otro mensaje relacionado>\n...\n\n## Origen del Sentimiento Negativo\n<An谩lisis completo del conflicto, evoluci贸n del tono, causas t茅cnicas y emocionales, y actores involucrados.>\n\n## Recomendaci贸n Preventiva\n<Recomendaci贸n t谩ctica: qu茅 se debi贸 hacer, qu茅 se debe hacer ahora, c贸mo contener y evitar mayor impacto. Con tono diplom谩tico, profesional y t茅cnico.>\n```\n\n---\n\n **QU NO HACER (NEGATIVE PROMPTING)**\n\n-  **NO INCLUIR EL NOMBRE DEL CLIENTE NI DEL CHAT**\n-  **NO ENTREGAR BLOQUES VACOS**\n-  **NO OMITIR EL ANLISIS NI LA RECOMENDACIN SI HAY CONFLICTO**\n-  **NO USAR FRASES VAGAS O GENRICAS COMO SE RECOMIENDA ESCUCHAR AL CLIENTE**\n-  **NO SUPONER QUE IFX ES UN CLIENTE  IFX ES PARTE INTERNA**\n-  **NO CAMBIAR EL FORMATO DE LA FECHA NI USAR MESES EN INGLS**\n\n---\n\n USA ANLISIS CONTEXTUAL Y TCNICO.  \nREFLEJA LIDERAZGO, CLARIDAD TCTICA Y CONTENCIN EMOCIONAL.  \nSI LO CONSIDERAS NECESARIO, PUEDES USAR `tool` think COMO APOYO INTERNO DE RAZONAMIENTO.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-1080,1140],"id":"98a50e31-8ce0-469b-b66e-f7305a847360","name":"AI Analist Negative BACKUP","alwaysOutputData":true,"retryOnFail":true,"maxTries":5,"executeOnce":true,"disabled":true}],"connections":{"Postgres Trigger":{"main":[[{"node":"Query Back Chat","type":"main","index":0},{"node":"Query Standby Time","type":"main","index":0}]]},"HTML":{"main":[[{"node":"Check Standby","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Table Messages","type":"main","index":0},{"node":"Save Negative","type":"main","index":0}]]},"Query Back Chat":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Merge Data Chat":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Table Messages":{"main":[[{"node":"If2","type":"main","index":0}]]},"Save Negative":{"main":[[]]},"Send Alert":{"main":[[{"node":"Set StandBy","type":"main","index":0}]]},"Check Standby":{"main":[[{"node":"Standby?","type":"main","index":0}]]},"Standby?":{"main":[[{"node":"Do nothing","type":"main","index":0}],[{"node":"Send Testing","type":"main","index":0},{"node":"Send Alert","type":"main","index":0}]]},"Query Standby Time":{"main":[[{"node":"Time Off","type":"main","index":0}]]},"Time Off":{"main":[[{"node":"Set False Standby","type":"main","index":0}],[{"node":"Do nothing Time Off","type":"main","index":0}]]},"Send Testing":{"main":[[]]},"Edit Fields1":{"main":[[{"node":"Merge Data Chat","type":"main","index":0}]]},"Code":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Llama Negativo":{"ai_languageModel":[[{"node":"AI Analist Negative BACKUP","type":"ai_languageModel","index":0}]]},"Llama 3.1 8B":{"ai_languageModel":[[{"node":"AI Analist Negative1","type":"ai_languageModel","index":0}]]},"If1":{"main":[[{"node":"Save Fake Negative","type":"main","index":0}],[{"node":"Code","type":"main","index":0}]]},"If2":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0}],[{"node":"HTML","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code2":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Save Positive","type":"main","index":0}],[{"node":"Save Neutral","type":"main","index":0}],[{"node":"AI Analist Negative1","type":"main","index":0}]]},"AI Analist Negative1":{"main":[[{"node":"If1","type":"main","index":0}]]},"AI Analist Negative BACKUP":{"main":[[],[]]}},"settings":{"executionOrder":"v1","timezone":"America/Bogota","callerPolicy":"workflowsFromSameOwner","saveExecutionProgress":true,"saveDataSuccessExecution":"all","saveManualExecutions":true,"executionTimeout":300},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Postgres Trigger":[{"json":{"length":525,"processId":63413,"channel":"n8n_channel_5191c992_f66a_446c_975a_bd62e3e12e33","payload":{"id_chat":"3EB0034F58DD4DC94369FF","remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"enviado\n\n","instanceId":"475354d6-f13f-47b0-af80-5c7e2fa3e433","dateTime":"2025-06-13T04:50:21.736-05:00","sender":"573171057858@s.whatsapp.net","url_image":null,"url_audio":null,"url_video":null,"nombrechat":"Bancolombia Versat-IFX ","id":15322,"nombrecliente":null,"real_name_user":null},"name":"notification"}}],"Merge Data Chat":[{"json":{"data":[{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"Tenico 8812 ya se encuentra presente junto al cajero a la espera\n\n","dateTime":"2025-06-13T07:39:21.580Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"Ya lo estamos preparando para enviarlo junto a las citas que nos asignado para la semana del 24\n\n","dateTime":"2025-06-13T07:41:16.462Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"\n\n","dateTime":"2025-06-13T07:44:23.784Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"Ya llego el personal de apertura\n\n","dateTime":"2025-06-13T08:08:56.498Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573007393317@s.whatsapp.net","pushName":"Salinas..","conversation":"buen ida ingenieros\n\nSID_2320984_CAJERO PAMPLONA CENTRO 1 _5939\n\neste es apertura por la tarde??\n\n","dateTime":"2025-06-13T08:57:34.596Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"No ese es ahora a las 9:30\n\n","dateTime":"2025-06-13T08:58:05.072Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"el t茅cnico ya va en camino\n\n","dateTime":"2025-06-13T08:58:16.705Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573007393317@s.whatsapp.net","pushName":"Salinas..","conversation":"a listo ingeniero\n\n","dateTime":"2025-06-13T08:59:05.784Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573007393317@s.whatsapp.net","pushName":"Salinas..","conversation":"muchas gracias\n\n","dateTime":"2025-06-13T08:59:09.450Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"t茅cnico de Torre oriente ya esta ingresando en la gerencia\n\n","dateTime":"2025-06-13T09:14:03.058Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"para validar el ingreso\n\n","dateTime":"2025-06-13T09:14:11.745Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"\n\n","dateTime":"2025-06-13T09:14:12.397Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"t茅cnico 831 ya se encuentra en la sucursal validando ingreso pero tienen informaci贸n de la visita\n\n","dateTime":"2025-06-13T09:18:36.512Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"que les han dicho?\n\n","dateTime":"2025-06-13T09:20:37.421Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"ya te confirmo\n\n","dateTime":"2025-06-13T09:20:55.832Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"le indican en la recepci贸n que tiene que dar el nombre de quien lo va a recibir y el piso\n\n","dateTime":"2025-06-13T09:22:45.148Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"Esteban Rivera\n\n","dateTime":"2025-06-13T09:23:10.732Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"el ya esta alla, esperandolos\n\n","dateTime":"2025-06-13T09:23:21.570Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"Me indica el t茅cnico si se pueden comunicar con el y darle indicaciones, porque le dicen que cual Esteban Rivera de cual piso, de cual de las torres, tiene que ser mas especifico\n\n","dateTime":"2025-06-13T09:26:12.416Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"si el lo pude llamar para indicarle\n\n","dateTime":"2025-06-13T09:26:20.125Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"si, dame el numero\n\n","dateTime":"2025-06-13T09:26:29.896Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"313 7246067\n\n","dateTime":"2025-06-13T09:26:42.783Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"@573165277914  y @573115054546 el equipo en Torre Orietne  se debe instalar en el Rack 8 unidad16\n\n","dateTime":"2025-06-13T09:27:08.649Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"entendido\n\n","dateTime":"2025-06-13T09:27:20.859Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"Tecnico de 5939 ya se encuentra presente junto al cajero\n\n","dateTime":"2025-06-13T09:27:42.857Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"listo, ya le digo a esteban\n\n","dateTime":"2025-06-13T09:27:45.315Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"[9:28 a.m., 13/6/2025] Esteban Rivera Bancolombia : Estoy en desplazamiento\n[9:28 a.m., 13/6/2025] Esteban Rivera Bancolombia : Ya lo llamo\n\n","dateTime":"2025-06-13T09:28:53.666Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"Estoy terminando de concretar el ingreso al nodo porque c贸mo debimos actualizar el parafiscsal\n\n","dateTime":"2025-06-13T09:33:49.093Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"cajero 5939?\n\n","dateTime":"2025-06-13T09:35:25.574Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"@573115054546 estan en sitio?\n\n","dateTime":"2025-06-13T09:36:51.068Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"ya valido\n\n","dateTime":"2025-06-13T09:36:51.685Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"si llego el de apertura\n\n","dateTime":"2025-06-13T09:36:55.331Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"si ya esta esperando al personal\n\n","dateTime":"2025-06-13T09:37:09.504Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"\n\n","dateTime":"2025-06-13T09:37:24.454Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"Tecnico de 40013 ya se encuentra realizando validaci贸n de ingreso\n\n","dateTime":"2025-06-13T09:38:14.141Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"5939 acaba de llegar el personal de apertura\n\n","dateTime":"2025-06-13T09:39:03.235Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"Carepa 831 ya le hab铆an dado ingreso al t茅cnico pero se fue la luz en la sucursal y se activaron todas las alarmas estan apagando todo para poder empezar\n\n","dateTime":"2025-06-13T09:42:09.023Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"En 40013 no encuentran la informaci贸n de la visita piden volver a enviar todo\n\n","dateTime":"2025-06-13T09:44:40.645Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"Miromero@bancolombia.com.co\n\n","dateTime":"2025-06-13T09:44:47.108Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"a ese correo\n\n","dateTime":"2025-06-13T09:44:50.245Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"voy\n\n","dateTime":"2025-06-13T09:44:54.796Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"torre oriente ya el t茅cnico se comunico y esta esperando para encontrarse con el personal que le dar谩 ingreso y lo llevara hasta donde tienen que realizar labores\n\n","dateTime":"2025-06-13T09:45:52.688Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"me regalas los parafiscales por fa\n\n","dateTime":"2025-06-13T09:48:52.020Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"\n\n","dateTime":"2025-06-13T09:48:58.330Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573115054546@s.whatsapp.net","pushName":"Seb","conversation":"\n\n","dateTime":"2025-06-13T09:49:28.770Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"enviado\n\n","dateTime":"2025-06-13T09:50:21.736Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "},{"remoteJid":"120363406598066040@g.us","participant":"573185327947@s.whatsapp.net","pushName":"Ifx Corp-Yennifer Gomez Caro","conversation":"\n\n","dateTime":"2025-06-13T09:50:23.028Z","sender":"573171057858@s.whatsapp.net","nombrechat":"Bancolombia Versat-IFX "}]}}]},"versionId":"61c4e4a4-56b7-4892-86ae-4b5f533ee215","triggerCount":1,"tags":[]}