{"createdAt":"2025-05-27T23:00:28.456Z","updatedAt":"2025-05-27T23:00:28.456Z","id":"ueqYqgyyMj2wQ6ef","name":"My workflow 10","active":false,"isArchived":false,"nodes":[{"parameters":{"formTitle":"Analisis de RFP - RFC","formDescription":"Upload your Document","formFields":{"values":[{"fieldLabel":"Document","fieldType":"file","multipleFiles":false},{"fieldLabel":"Email","fieldType":"email","placeholder":"Escriba el mail a donde enviar el analisis","requiredField":true},{"fieldLabel":"Nombre del Cliente","placeholder":"Escriba el nombre del cliente que envio el RFP","requiredField":true}]},"options":{"appendAttribution":false}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-2080,120],"id":"19b1f575-bd9d-4fdf-bafe-03eaebb4d6a9","name":"On form submission","webhookId":"5125085d-62fd-44cc-81cc-02d25e34efc3","disabled":true},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"leftValue":"={{ $json.Document }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true},"id":"b7f674dc-b0b2-46ef-a708-f2cd1bc8116e"}],"combinator":"and"},"renameOutput":true,"outputKey":"Document"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"c299e7f1-81fa-4a03-aa67-91b8ed421b02","leftValue":"={{ $json.message.text }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"c2cfac87-d08b-431a-b252-5148c7a944f3","leftValue":"={{ $binary.Document0.mimeType.startsWith('image/') }}","rightValue":"image/","operator":{"type":"string","operation":"startsWith"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Image"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"5b390ef4-81dd-4521-8441-93047d436432","leftValue":"={{ $binary.Document0.mimeType }}","rightValue":"application/pdf","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Document-Webhook"}]},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-1840,400],"id":"4dec483c-170f-4df4-a00d-591e01383fff","name":"Switch"},{"parameters":{"jsCode":"// Función para convertir markdown a HTML\nfunction formatMarkdownToHtml(markdown) {\n  if (!markdown) return '';\n  \n  // Obtener el nombre del cliente del campo específico de n8n\n  let clientName = $input.first().json['Nombre del Cliente'] || \"Cliente\";\n  \n  // Si el campo de formulario no existe o está vacío, intentar extraerlo del markdown\n  if (!clientName || clientName === \"Cliente\") {\n    const clientMatch = markdown.match(/\\*\\*\\s*Solicitante:\\s*(.*?)\\s*\\*\\*/);\n    if (clientMatch && clientMatch[1]) {\n      // Eliminar texto adicional después del nombre del cliente si existe\n      let extractedName = clientMatch[1].split(/\\s+Este nombre/)[0];\n      extractedName = extractedName.split(/\\s+este nombre/)[0];\n      clientName = extractedName.trim();\n    }\n  }\n\n  // Formatear títulos principales\n  let html = markdown.replace(/^# (.*?)$/gm, '<h1 style=\"font-size: 24px; color: #0071ce; border-bottom: 2px solid #0071ce; padding-bottom: 10px; margin-top: 25px; margin-bottom: 15px;\">$1</h1>');\n  \n  // Formatear subtítulos\n  html = html.replace(/^## (.*?)$/gm, '<h2 style=\"font-size: 18px; color: #041e42; margin-top: 20px; margin-bottom: 10px; border-left: 4px solid #0071ce; padding-left: 10px;\">$1</h2>');\n  \n  // Formatear negritas\n  html = html.replace(/\\*\\*(.*?)\\*\\*/g, '<strong style=\"font-weight: bold; color: #041e42;\">$1</strong>');\n  \n  // Formatear listas con viñetas\n  html = html.replace(/^- (.*?)$/gm, '<li style=\"margin-bottom: 5px; font-size: 16px;\">$1</li>');\n  \n  // Detectar y agrupar elementos de lista en forma segura\n  const lines = html.split('\\n');\n  let result = [];\n  let currentList = [];\n  \n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    if (line.startsWith('<li')) {\n      currentList.push(line);\n    } else {\n      if (currentList.length > 0) {\n        result.push('<ul style=\"margin-left: 10px; padding-left: 20px; margin-bottom: 10px;\">');\n        result = result.concat(currentList);\n        result.push('</ul>');\n        currentList = [];\n      }\n      result.push(line);\n    }\n  }\n  \n  // Si quedó alguna lista sin cerrar\n  if (currentList.length > 0) {\n    result.push('<ul style=\"margin-left: 10px; padding-left: 20px; margin-bottom: 10px;\">');\n    result = result.concat(currentList);\n    result.push('</ul>');\n  }\n  \n  html = result.join('\\n');\n  \n  // Reemplazar saltos de línea con etiquetas <br/>\n  html = html.replace(/\\n/g, '<br/>');\n  \n  // Limpiar <br/> dobles después de etiquetas de cierre\n  html = html.replace(/<\\/h1><br\\/>/g, '</h1>');\n  html = html.replace(/<\\/h2><br\\/>/g, '</h2>');\n  html = html.replace(/<\\/ul><br\\/>/g, '</ul>');\n  \n  // Agregar disclaimer al final\n  const disclaimer = `\n  <div style=\"margin-top: 40px; padding: 15px; background-color: #f5f5f5; border-left: 4px solid #0071ce; font-size: 24px;\">\n    <p><strong>Aviso Importante:</strong> Este es un resumen general destinado a proporcionar un contexto inicial sobre el RFP. Para una comprensión completa y detallada, se recomienda revisar el documento RFP original en su totalidad. Este análisis no sustituye la revisión técnica y legal exhaustiva del documento completo.</p>\n  </div>\n  `;\n  \n  // Crear contenedor principal con encabezado de IFX NETWORKS\n  const formattedHTML = `\n  <!DOCTYPE html>\n  <html>\n  <head>\n    <meta charset=\"UTF-8\">\n    <title>Análisis RFP</title>\n    <style>\n      body {\n        font-family: Arial, sans-serif;\n        line-height: 1.6;\n        color: #333;\n        max-width: 800px;\n        margin: 0 auto;\n        padding: 20px;\n      }\n      .header {\n        background-color: #041e42;\n        color: white;\n        padding: 30px;\n        text-align: center;\n        margin-bottom: 5px;\n        border-radius: 8px;\n        box-shadow: 0 4px 8px rgba(0,0,0,0.2);\n      }\n      .header h1 {\n        font-size: 32px !important;\n        margin: 0 !important;\n        padding: 0 !important;\n        color: white !important;\n        border: none !important;\n      }\n      .header p {\n        font-size: 22px;\n        margin-top: 10px;\n        margin-bottom: 0;\n        color: #78d64b;\n      }\n      .powered-by {\n        text-align: center;\n        margin: 5px 0 15px 0;\n        padding: 8px;\n        font-size: 14px;\n      }\n      .powered-by strong em {\n        font-weight: bold;\n        font-style: italic;\n        font-family: Arial, Helvetica, sans-serif;\n        color: #cc00cc;\n      }\n      h1 {\n        font-size: 24px;\n        color: #0071ce;\n        border-bottom: 2px solid #0071ce;\n        padding-bottom: 10px;\n        margin-top: 25px;\n        margin-bottom: 15px;\n      }\n      h2 {\n        font-size: 18px;\n        color: #041e42;\n        margin-top: 20px;\n        margin-bottom: 10px;\n        border-left: 4px solid #0071ce;\n        padding-left: 10px;\n      }\n      ul {\n        margin-left: 10px;\n        padding-left: 20px;\n        margin-bottom: 8px;\n      }\n      li {\n        margin-bottom: 5px;\n        font-size: 16px;\n      }\n      /* Para listas anidadas */\n      li li {\n        font-size: 15px;\n        margin-bottom: 3px;\n      }\n      strong {\n        font-weight: bold;\n        color: #041e42;\n      }\n      .section {\n        background-color: #f9f9f9;\n        padding: 15px;\n        border-radius: 5px;\n        margin-bottom: 20px;\n      }\n      .recommendations {\n        background-color: #f0fff0;\n      }\n      .risks {\n        background-color: #fff0f0;\n      }\n    </style>\n  </head>\n  <body>\n    <div class=\"container\">\n      <div class=\"header\">\n        <h1>IFX NETWORKS</h1>\n        <p>Análisis de RFP para ${clientName}</p>\n      </div>\n      \n      <div class=\"powered-by\">\n        Generated by <strong><em>aifx</em></strong>\n      </div>\n      \n      ${html}\n      \n      ${disclaimer}\n    </div>\n  </body>\n  </html>`;\n  \n  return formattedHTML;\n}\n\n// Obtener el texto markdown de la entrada\nconst markdownText = $input.first().json.markdown;\n\n// Convertir markdown a HTML\nconst formattedHtml = formatMarkdownToHtml(markdownText);\n\n// Devolver los resultados como un array de objetos\nreturn [\n  {\n    json: {\n      markdownText: markdownText,\n      formattedHtml: formattedHtml,\n      plainText: \"Este correo contiene HTML formateado. Si no puede verlo correctamente, utilice un cliente de correo que soporte HTML.\"\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-240,120],"id":"3fd57221-beeb-451b-9460-9431266c9f50","name":"Convert to HTML"},{"parameters":{"errorMessage":"Error Processing Document"},"type":"n8n-nodes-base.stopAndError","typeVersion":1,"position":[-780,220],"id":"e042ea7c-5ee5-4dd1-b16a-73a2263ffb9e","name":"Error PDF"},{"parameters":{"toRecipients":"={{ $('On form submission').item.json.Email }}","subject":"=Resumen RFP Cliente {{ $('On form submission').item.json['Nombre del Cliente'] }}","bodyContent":"={{ $json.formattedHtml }}","additionalFields":{"bodyContentType":"html"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[0,0],"id":"e08298a2-bc50-41cf-bdb0-44ae5c26e8b0","name":"Send Mail","webhookId":"4d4b099c-c77e-49cd-924d-254b0d51e936","credentials":{"microsoftOutlookOAuth2Api":{"id":"zrNdsL9SZMvBfPt3","name":"Microsoft Outlook cbautista"}},"disabled":true},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6b32d09d-aca1-4ac2-add0-08fddb408eef","leftValue":"={{ $json.status }}","rightValue":"ERROR","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"ERROR"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"728cff21-b861-4c35-a66f-1159958560fb","leftValue":"={{ $json.status }}","rightValue":"CANCELED","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"CANCELED"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.status }}","rightValue":"SUCCESS","operator":{"type":"string","operation":"equals"},"id":"1ca170e5-f79b-45d0-bf06-8817aaa91020"}],"combinator":"and"},"renameOutput":true,"outputKey":"SUCCESS"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8ed9a7f3-a77b-4541-a2c5-1ec659349c4c","leftValue":"={{ $json.status }}","rightValue":"PENDING","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PENDING"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-1180,400],"id":"c0d6cd21-48e5-48da-9e6f-c78fe339d73b","name":"Status Process"},{"parameters":{"promptType":"define","text":"={{ $json.markdown }}","messages":{"messageValues":[{"message":"Me puedes hacer que se extraiga el nombre del solicitante o cliente encontrando la informacion en el texto y que lo llama como \"solicitante: cliente XYZ\"\n\nEste es el prompt actual\nEres un analista experto en contratación de servicios de telecomunicaciones. Recibirás el contenido completo de un documento tipo RFP (Request for Proposal).\n\n🎯 TU TAREA ES LEER Y ANALIZAR el documento COMPLETO y entregar una respuesta organizada en FORMATO MARKDOWN, bien estructurada y detallada, con secciones y subtítulos.\n💡 DEBES EXTRAER Y EXPLICAR la información más relevante posible, agrupada en las siguientes secciones:\n## 🔐 Información Legal y Contractual\nExpón con claridad las condiciones legales clave: duración del contrato, causales de terminación, condiciones de renovación, garantías requeridas, cláusulas de confidencialidad, penalizaciones y cualquier término jurídico relevante. Si hay ambigüedades o riesgos, coméntalos brevemente.\n## 💼 Aspectos Administrativos y Económicos\nDetalla fechas importantes (límite de entrega, vigencia de oferta), plazos de pago, condiciones económicas (moneda, forma de pago, intereses, anticipos), así como montos, promedios o unidades de cobro mencionadas. Añade cualquier instrucción relacionada con facturación, penalidades económicas o restricciones.\n## 📑 Requisitos Documentales\nLista y explica los documentos requeridos: referencias, certificaciones, declaraciones juradas, anexos técnicos, formularios, etc. Aclara condiciones como: cantidad, antigüedad, formato, requisitos de firma o certificación, si deben presentarse en físico o digital.\n## 🛠️ Requerimiento Técnico (Resumen Detallado)\nHaz un resumen técnico exhaustivo. Incluye tecnologías específicas (SD-WAN, plataformas, software), infraestructura mínima, disponibilidad exigida, condiciones de escalabilidad, redundancias, niveles de servicio (SLA), seguridad física y lógica, cantidad de sitios, equipos o instalaciones.\n🔎 ADEMÁS, para cada sección debes:\n- Citar cifras exactas, porcentajes, valores técnicos o económicos que aparezcan  \n- Incluir aclaraciones sobre el contexto si hay ambigüedad o términos no definidos  \n- Mencionar si hay inconsistencias, ambigüedades o puntos críticos  \n- Usar listas ordenadas o viñetas cuando sea necesario para mayor claridad\n\n🚫 IMPORTANTE:  \nNO entregues respuesta en JSON  \nNO utilices etiquetas de código  \nNO incluyas texto fuera del formato Markdown estructurado\n📌 OBJETIVO FINAL: Producir un INFORME CLARO, COMPLETO Y ANALÍTICO en Markdown, con subtítulos, íconos y explicaciones precisas por sección.\n\n📘 FORMATO DE RESPUESTA ESPERADO EN MARKDOWN OBLIGATORIO MANTENER LA ESTRUCTURA\n## 🔐 Información Legal y Contractual\n- Extraer el nombre del solicitante del RFP, regularmente es el nombre de alguna empresa, entidad o compañia\n- El contrato tendrá una duración de 60 meses, con posibilidad de renovación automática si ninguna de las partes manifiesta lo contrario con al menos 90 días de anticipación.\n- Se exige una garantía de cumplimiento equivalente al 15% del valor anual del contrato, renovable cada año antes del aniversario del contrato.\n- El proveedor debe firmar un acuerdo de confidencialidad (NDA) previo a la ejecución del contrato.\n- Se establecen penalidades por incumplimiento que podrán alcanzar hasta el 10% del monto mensual facturado, dependiendo de la gravedad del incidente.\n## 💼 Aspectos Administrativos y Económicos\n- La propuesta debe entregarse antes del **24 de enero de 2025 a las 13:00 (UTC-6)**.\n- La oferta deberá tener una vigencia mínima de **180 días** a partir de la fecha de apertura de propuestas.\n- Los pagos se realizarán en **USD**, con un plazo máximo de **60 días calendario** tras la aceptación del servicio.\n- No se permiten pagos anticipados, intereses moratorios ni ajustes por inflación.\n- Costo estimado mensual por sitio: **$2,500 USD** promedio.\n- No se contempla la entrega parcial del servicio; el contrato será adjudicado en una sola partida.\n## 📑 Requisitos Documentales\n- Se deben presentar al menos **3 cartas de referencia** de clientes actuales o anteriores, emitidas en los últimos **2 años**.\n- Certificaciones obligatorias: **ISO 27001**, **PCI-DSS**, y **Uptime Institute TIER III (Design y Facility)**.\n- Documentos requeridos: memoria técnica, plan de trabajo detallado, declaración jurada firmada por el representante legal.\n- Todos los documentos deben entregarse en formato digital firmado electrónicamente, además de una copia impresa legalizada.\n- Se solicita presentar un organigrama técnico del equipo propuesto, con CVs del personal clave.\n## 🛠️ Requerimiento Técnico (Resumen Detallado)\n- La solución deberá operar sobre una plataforma **SD-WAN basada en VMware VeloCloud**, con enlaces de comunicación redundantes en cada sitio.\n- Se exige una **disponibilidad mínima de 99.982%**, respaldada por monitoreo y soporte **24x7x365**.\n- Capacidad inicial de instalación: **20 racks**, con posibilidad de expansión a **30 racks** dentro de un periodo de **3 años**.\n- Redundancia requerida: **N+1** en energía, climatización y enlaces.\n- Seguridad física: acceso biométrico, cámaras CCTV, jaulas Faraday y zonas de cuarentena.\n- Todos los sitios deberán contar con doble acometida de fibra óptica y equipos con soporte para IPv6.\n## ✅  Observaciones y Recomendaciones\n- Se recomienda verificar que la vigencia de las certificaciones solicitadas coincida con la duración total del contrato.\n- Ideal contar con experiencia comprobable en implementación de soluciones SD-WAN en al menos **10 sitios simultáneamente**.\n- Se sugiere solicitar aclaración sobre el término “expansión futura” para establecer límites de alcance o costos adicionales.\n- Sería útil definir explícitamente los criterios de evaluación técnica y económica dentro del documento para mayor transparencia.\n## ⚠️ Riesgos Identificados\n- Ambigüedad en la cláusula de renovación automática: no se especifican condiciones de renegociación tarifaria.\n- Posible sobrecosto si no se delimitan las condiciones bajo las cuales se puede activar la expansión a 30 racks.\n- No se detalla el mecanismo de validación de la disponibilidad mínima exigida (99.982%), lo que podría generar disputas contractuales.\n- Falta claridad sobre si el incumplimiento técnico parcial implica rescisión total del contrato o aplicación de penalidades proporcionales."}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.6,"position":[-800,420],"id":"08fbb991-413b-4909-9370-0dd27a7d0b1c","name":"Analizando Documento","disabled":true},{"parameters":{"operation":"completion","completionTitle":"Error en el Analisis","completionMessage":"=el Analisis del documento ** {{ $('On form submission').item.json.Document.filename }} **\nPresento un error en su procesamiento, por favor intente de nuevo el proceso.","limitWaitTime":true,"resumeUnit":"minutes","options":{}},"type":"n8n-nodes-base.form","typeVersion":1,"position":[-980,220],"id":"e596b9c1-dd65-4841-b9ab-cf06cfb671ad","name":"Form Error","webhookId":"672dd2c6-3c4d-472e-a14e-ea16a65e965b"},{"parameters":{"method":"POST","url":"https://api.cloud.llamaindex.ai/api/parsing/upload","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"Document0"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1560,420],"id":"5ffd28cb-61bf-44fb-a43b-887e44c301a4","name":"Parser Documento","credentials":{"httpHeaderAuth":{"id":"T8quSeWOL90AppRG","name":"Header Auth account 2"}}},{"parameters":{"url":"=https://api.cloud.llamaindex.ai/api/v1/parsing/job/{{ $json.id }}/result/markdown","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-980,420],"id":"caa3230e-b0f2-4f01-96a2-b354c9e76f6b","name":"Success Document","credentials":{"httpHeaderAuth":{"id":"T8quSeWOL90AppRG","name":"Header Auth account 2"}}},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1000,640],"id":"ce9f5559-ac97-4e67-86cb-d84f73c24c99","name":"Wait Process Document","webhookId":"f2ebea6a-82b1-44b0-88ea-6f80826d99f9"},{"parameters":{"url":"=https://api.cloud.llamaindex.ai/api/v1/parsing/job/{{ $json.id }}","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1340,420],"id":"e7570f72-5fa1-483f-906c-425192a2f650","name":"GET Parser Document","credentials":{"httpHeaderAuth":{"id":"T8quSeWOL90AppRG","name":"Header Auth account 2"}}},{"parameters":{"operation":"completion","completionTitle":"Analisis Finalizado","completionMessage":"=El Analisis del documento\n** {{ $('On form submission').item.json.Document.filename }} **\na finalizado y el resultado fue enviado a\n{{ $('On form submission').item.json.Email }}","limitWaitTime":true,"resumeUnit":"minutes","options":{}},"type":"n8n-nodes-base.form","typeVersion":1,"position":[220,0],"id":"edbb7161-d2f6-4b88-a22f-75911f64997b","name":"Finish Success","webhookId":"672dd2c6-3c4d-472e-a14e-ea16a65e965b","disabled":true},{"parameters":{"model":{"__rl":true,"value":"openai-mini","mode":"list","cachedResultName":"openai-mini"},"options":{"temperature":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-740,640],"id":"18aa2079-bb45-4aee-b6f9-48df9adcab2a","name":"GPT-4.1-Nano","credentials":{"openAiApi":{"id":"S46eGA7oXnm2SZCZ","name":"OpenAi account 2"}}},{"parameters":{"httpMethod":"POST","path":"parse-rfp","options":{"binaryPropertyName":"Document"}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-2060,700],"id":"7d2b14b8-df47-48ea-96a7-138d871c0ee4","name":"Webhook","webhookId":"90fd164e-74ce-4bc0-a8e2-6a3f3d3f1ec9"},{"parameters":{"operation":"insert","collection":"analyses","options":{}},"type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[-240,660],"id":"125ee584-9413-48e7-9dea-59b7da903d98","name":"MongoDB","credentials":{"mongoDb":{"id":"anxhbPr54h2LJLDB","name":"MongoDB Devcloud"}},"disabled":true},{"parameters":{"collection":"analyses","options":{},"query":"{ \"_id\":\"680aba2baf724207a4adc9bc\" }"},"type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[0,720],"id":"8ee5e2e0-df72-42ab-b6a4-5786e0bd1238","name":"MongoDB1","credentials":{"mongoDb":{"id":"anxhbPr54h2LJLDB","name":"MongoDB Devcloud"}},"disabled":true},{"parameters":{"assignments":{"assignments":[{"id":"0604c76f-f9c6-493d-aaf6-b09bc7d2a7ac","name":"formattedHtml","value":"={{ $json[\"formattedHtml\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[20,360],"id":"43cbb0b3-c2e0-4159-887b-a51fcb548ca8","name":"Edit Fields"},{"parameters":{"jsCode":"// Función para convertir markdown a HTML\nfunction formatMarkdownToHtml(markdown) {\n  if (!markdown) return '';\n  \n  // Obtener el nombre del cliente de n8n si está disponible, de lo contrario, usar \"Cliente\"\n  let clientName = $input.first().json['Nombre del Cliente'] || \"Cliente\";\n  \n  // Si no se encuentra en n8n, intentar extraerlo del texto markdown\n  if (clientName === \"Cliente\") {\n    const clientMatch = markdown.match(/\\*\\*\\s*Solicitante:\\s*(.*?)\\s*\\*\\*/);\n    if (clientMatch && clientMatch[1]) {\n      // Eliminar texto adicional después del nombre del cliente si existe\n      let extractedName = clientMatch[1].split(/\\s+Este nombre/)[0];\n      extractedName = extractedName.split(/\\s+este nombre/)[0];\n      clientName = extractedName.trim();\n    }\n  }\n\n  // Convertir markdown a HTML (este ejemplo puede ser más complejo si necesitas hacer más ajustes)\n  let html = markdown.replace(/^# (.*?)$/gm, '<h1 style=\"font-size: 20px; color: #0033cc; border-bottom: 2px solid #0033cc; padding-bottom: 10px; margin-top: 15px; margin-bottom: 10px; text-align: center;\">📌 $1</h1>');\n  html = html.replace(/^## (.*?)$/gm, '<h2 style=\"font-size: 18px; color: #0d207f; margin-top: 15px; margin-bottom: 8px; border-left: 4px solid #0033cc; padding-left: 10px; font-weight: bold;\">🔑 $1</h2>');\n  html = html.replace(/\\*\\*(.*?)\\*\\*/g, '<strong style=\"font-weight: bold; color: #041e42;\">$1</strong>');\n  html = html.replace(/^- (.*?)$/gm, '<li style=\"margin-bottom: 5px; font-size: 16px;\">📍 $1</li>');\n\n  // Detectar y convertir tablas Markdown a HTML\nhtml = html.replace(/\\|(.+?)\\|/g, function(match, p1) {\n  // Limpiar cualquier símbolo de barra (|) sobrante\n  let cleanRows = p1.trim().split('\\n').map(row => {\n    // Eliminar las barras verticales y convertir la fila en celdas de tabla <td>\n    let tableData = row.split('|').map(cell => {\n      // Eliminar espacios adicionales y formatear correctamente las celdas\n      return `<td style=\"padding: 8px; border: 1px solid #ddd; text-align: left; font-size: 14px; color: #333;\">${cell.trim()}</td>`;\n    }).join('');\n    return `<tr>${tableData}</tr>`;\n  }).join('');\n\n  // Devolver la tabla formateada sin los símbolos | innecesarios\n  return `<table style=\"width: 100%; border-collapse: collapse; margin: 20px 0; background-color: #fafafa;\">${cleanRows}</table>`;\n});\n\n  \n  // Reemplazar saltos de línea con <br/>\n  html = html.replace(/\\n/g, '<br/>');\n  \n  return html;\n}\n\n// Obtener el texto markdown de la entrada\nconst markdownText = $input.first().json.markdown;\n\n// Convertir markdown a HTML\nconst formattedHtml = formatMarkdownToHtml(markdownText);\n\n// Insertar en el HTML base\nconst htmlOutput = `\n<html lang=\"es\">\n<head>\n  <style>\n    body {\n      font-family: 'Arial', sans-serif;\n      background-color: #f4f6f8;\n      margin: 0;\n      padding: 10px 20px;\n      color: #2c3e50;\n      max-width: 800px;\n      margin: 0 auto;\n    }\n    .container {\n      background: #fff;\n      border-radius: 8px;\n      box-shadow: 0 2px 8px rgba(44,62,80,0.07);\n      padding: 20px;\n    }\n    .header {\n      padding: 30px;\n      text-align: center;\n      background: #232a34;\n      color: white;\n      border-radius: 8px 8px 0 0;\n    }\n    .header h1 {\n      font-size: 28px;\n      margin: 0;\n    }\n    .header p {\n      font-size: 18px;\n      margin-top: 10px;\n      color: #78d64b;\n    }\n    .powered-by {\n      text-align: center;\n      margin-top: 15px;\n      font-size: 14px;\n      color: #ccc;\n    }\n    .powered-by strong em {\n      font-weight: bold;\n      font-style: italic;\n      font-family: Arial, Helvetica, sans-serif;\n      color: #cc00cc;\n    }\n    h1 {\n      font-size: 20px;\n      color: #0033cc;\n      border-bottom: 2px solid #0033cc;\n      padding-bottom: 10px;\n      margin-top: 15px;\n      margin-bottom: 10px;\n      text-align: center;\n    }\n    h2 {\n      font-size: 18px;\n      color: #0d207f;\n      margin-top: 15px;\n      margin-bottom: 10px;\n      border-left: 4px solid #0033cc;\n      padding-left: 10px;\n    }\n    ul {\n      margin-left: 10px;\n      padding-left: 20px;\n      margin-bottom: 8px;\n    }\n    li {\n      margin-bottom: 5px;\n      font-size: 16px;\n    }\n    /* Para listas anidadas */\n    li li {\n      font-size: 15px;\n      margin-bottom: 3px;\n    }\n    strong {\n      font-weight: bold;\n      color: #041e42;\n    }\n    .footer {\n      background: #232a34;\n      color: #e0e0e0;\n      padding: 20px;\n      border-radius: 0 0 8px 8px;\n      font-size: 13px;\n      text-align: left;\n      margin-top: 32px;\n    }\n    .footer-logo {\n      max-width: 110px;\n      height: auto;\n      margin-bottom: 10px;\n    }\n    .footer-title {\n      font-weight: 700;\n      color: #fff;\n      margin-bottom: 4px;\n      font-size: 15px;\n    }\n    .footer-row {\n      display: flex;\n      gap: 32px;\n      margin-top: 12px;\n    }\n    .footer-info {\n      flex: 1;\n      min-width: 0;\n      line-height: 1.7;\n      margin-top: 0;\n      font-size: 13px;\n      color: #e0e0e0;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>IFX NETWORKS</h1>\n      <p>Análisis de RFP para cliente</p>\n    </div>\n\n    <div class=\"powered-by\">\n      Generated by <strong><em>aifx</em></strong>\n    </div>\n\n    <!-- Aquí se inserta el contenido dinámico formateado desde Markdown -->\n    <div class=\"section-content\">\n      ${formattedHtml}\n    </div>\n\n    <div class=\"footer\">\n      <img src=\"https://ifxnetworks.com/hubfs/IFX/logo-ifx--primary.svg\" alt=\"IFX Networks\" class=\"footer-logo\">\n      <div class=\"footer-title\">IFX Networks</div>\n      <div class=\"footer-row\">\n        <div class=\"footer-info\">\n          25 años de experiencia en el mercado de las Telecomunicaciones.\n        </div>\n        <div class=\"footer-info\">\n          Diagonal 97 No. 17 – 60 piso 4<br>\n          Edificio Centro Empresarial Corporativo<br>\n          Bogotá, Colombia\n        </div>\n        <div class=\"footer-info\">\n          +57 (601) 369 3000<br>\n          CARE: +57 (601) 369 3024\n        </div>\n      </div>\n    </div>\n  </div>\n</body>\n</html>\n`;\n\nreturn [\n  {\n    json: {\n      formattedHtml: htmlOutput\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-240,380],"id":"1edbfcb8-d7f8-43d9-b6c9-c1a2891e5ecc","name":"Code"}],"connections":{"On form submission":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Parser Documento","type":"main","index":0}],[],[{"node":"Parser Documento","type":"main","index":0}],[{"node":"Parser Documento","type":"main","index":0}]]},"Convert to HTML":{"main":[[{"node":"Send Mail","type":"main","index":0}]]},"Send Mail":{"main":[[{"node":"Finish Success","type":"main","index":0}]]},"Status Process":{"main":[[{"node":"Form Error","type":"main","index":0}],[{"node":"Form Error","type":"main","index":0}],[{"node":"Success Document","type":"main","index":0}],[{"node":"Wait Process Document","type":"main","index":0}]]},"Analizando Documento":{"main":[[{"node":"MongoDB","type":"main","index":0},{"node":"Convert to HTML","type":"main","index":0},{"node":"Code","type":"main","index":0}]]},"Form Error":{"main":[[{"node":"Error PDF","type":"main","index":0}]]},"Parser Documento":{"main":[[{"node":"GET Parser Document","type":"main","index":0}]]},"Success Document":{"main":[[{"node":"Analizando Documento","type":"main","index":0}]]},"Wait Process Document":{"main":[[{"node":"GET Parser Document","type":"main","index":0}]]},"GET Parser Document":{"main":[[{"node":"Status Process","type":"main","index":0}]]},"GPT-4.1-Nano":{"ai_languageModel":[[{"node":"Analizando Documento","type":"ai_languageModel","index":0}]]},"Webhook":{"main":[[{"node":"Switch","type":"main","index":0}]]},"MongoDB":{"main":[[{"node":"MongoDB1","type":"main","index":0}]]},"Code":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"482b3ae8-efe2-4866-aa92-4be3e1a60e40","triggerCount":0,"tags":[]}