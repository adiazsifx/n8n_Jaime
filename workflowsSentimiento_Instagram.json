{"createdAt":"2025-06-04T14:37:47.022Z","updatedAt":"2025-06-04T22:16:42.000Z","id":"U8Iz7knkVJPuUMBQ","name":"Sentimiento_Instagram","active":false,"isArchived":false,"nodes":[{"parameters":{"path":"insta","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-1940,-820],"id":"9e68f4d0-4137-45d0-91bd-05e49d0aef3f","name":"EndpointInstagram","webhookId":"ced1cb68-aaea-426c-9007-58ae7453b239","disabled":true},{"parameters":{"respondWith":"text","responseBody":"={{ $json.query['hub.challenge'] }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.3,"position":[-1720,-820],"id":"3bbfbf43-7064-49f6-afa4-9a5a0d07b021","name":"Respond to Webhook","disabled":true},{"parameters":{"httpMethod":"POST","path":"insta","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-1340,-600],"id":"238d2d90-a644-4a20-9533-0782a0370dd7","name":"EndpointInstagram_comentarios","webhookId":"ced1cb68-aaea-426c-9007-58ae7453b239"},{"parameters":{"url":"=https://graph.instagram.com/v23.0/{{ $json.body.entry[0].changes[0].value.media.id }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"fields","value":"id,caption,permalink"},{"name":"access_token","value":"IGAARnpvFSXHZABZAE1QLUs5Q2xieUtNUXlFN3JHaEdZANVpaTTdIQ2xVNDE5ak1BZAGVjX0hMcXVVSTdZAWF9UTXg0c3JQVW41bWpUVmhiTmhrLTc1WE9FSzE3YzBsVXhpUkRWNUlXRVdqazBYT1o5Y2VPSEhhWXljTTdPZAGg2YnZArRQZDZD"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1100,-600],"id":"3aafda89-fa51-4674-96da-c587b90665f6","name":"HTTP Request"},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"es\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Alerta de Sentimiento Instagram</title>\n</head>\n\n<body style=\"margin:0; padding:0; background:#f5f7fa; font-family:font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif, Helvetica, sans-serif;\">\n  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"background:#f5f7fa;\">\n    <tr>\n      <td align=\"center\" style=\"padding: 20px;\">\n        <!-- Tarjeta principal -->\n        <table width=\"80%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"background:#fff; border-radius:18px; box-shadow:0 4px 24px #0033cc22; margin:32px auto 24px auto; min-width:320px; max-width:900px;\">\n          <!-- Encabezado -->\n          <tr>\n            <td style=\"padding: 40px 40px 20px 40px;\">\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                <tr>\n                  <td valign=\"middle\" style=\"width:48px;\">\n                    <img src=\"https://img.icons8.com/color/48/000000/instagram-new.png\" width=\"48\" height=\"48\" alt=\"logo\" style=\"vertical-align:middle;\">\n                  </td>\n                  <td valign=\"middle\">\n                    <span style=\"font-size: 26px; font-weight: bold; color: #E1306C; letter-spacing: 0.5px;\">Alerta de Sentimientos Instagram</span>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n          <!-- Línea separadora -->\n          <tr>\n            <td><div style=\"border-bottom:2px solid #E1306C; width:90%; margin:0 auto 30px auto;\"></div></td>\n          </tr>\n          <!-- Información de la Publicación -->\n          <tr>\n            <td style=\"padding: 0 40px;\">\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"background:#f4f7fb; border-radius:14px; box-shadow:0 1px 4px #e3e7ee; margin-bottom:30px;\">\n                <tr>\n                  <td style=\"padding: 30px;\">\n                    <div style=\"font-size: 15px; color: #333; margin-bottom: 12px;\">\n                      <span style=\"font-weight: bold; color: #555;\">Título: </span>{{ $('Edit Fields').item.json.titulo }}\n                    </div>\n                    <div style=\"font-size: 15px; color: #333; margin-bottom: 12px;\">\n                      <span style=\"font-weight: bold; color: #555;\">Link: </span>\n                      <a href=\"{{ $('Edit Fields').item.json.link }}\" style=\"color: #E1306C; text-decoration: none;\">Ver publicación</a>\n                    </div>\n                    <div style=\"font-size: 15px; color: #333; margin-bottom: 12px;\">\n                      <span style=\"font-weight: bold; color: #555;\">Fecha: </span>{{ $now }}\n                    </div>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n          <!-- Análisis de Sentimiento -->\n          <tr>\n            <td style=\"padding: 0 40px;\">\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"background:#fff; border-radius:18px; box-shadow:0 2px 8px #FFCC8033; margin-bottom:30px;\">\n                <tr>\n                  <td align=\"center\" style=\"text-align: center; padding: 10px; width:33.3%; border-right:1px solid #F0F0F0;\">\n                    <span style=\"text-align: center; display:inline-block; background:#FF5252; color:#fff; border-radius:8px; padding:8px 22px; font-size:16px; font-weight:700; margin-bottom:12px;\">\n                      {{ $json.output.sentimiento }}\n                    </span>\n                    <div style=\"font-size: 15px; color: #222; font-weight: 600; margin-top:12px;\">Sentimiento</div>\n                  </td>\n                  <td align=\"center\" style=\"text-align: center; padding: 10px; width:33.3%; border-right:1px solid #F0F0F0;\">\n                    <span style=\"text-align: center; font-size: 36px; font-weight: bold; color: #FF8A65;\"> {{ $json.output.nivel_de_severidad }}%</span>\n                    <div style=\"text-align: center; font-size: 15px; color: #222; font-weight: 600; margin-top:12px;\">Severidad</div>\n                  </td>\n                  <td align=\"center\" style=\"text-align: center; padding: 10px; width:33.3%;\">\n                    <span style=\"text-align: center; font-size: 36px; font-weight: bold; color: #E1306C;\"> {{ $json.output.nivel_de_confianza }}%</span>\n                    <div style=\"text-align: center; font-size: 15px; color: #222; font-weight: 600; margin-top:12px;\">Confianza</div>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n          <!-- Comentario -->\n          <tr>\n            <td style=\"padding: 0 40px;\">\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"background:#fff3e0; border-radius:14px; box-shadow:0 1px 4px #ffcc8033; margin-bottom:30px;\">\n                <tr>\n\n                  <td style=\"padding: 30px;\">\n                       <div style=\"font-size: 15px; color: #333; margin-bottom: 12px;\">\n                         <span style=\"font-weight: bold; color: #555;\">Comentario: </span>\n                       </div>\n                    <div style=\"font-size: 15px; color: #333; line-height:1.7;\">\n                      {{ $('Edit Fields').item.json.comentario }}\n                    </div>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n          <!-- Pie de página -->\n          <tr>\n            <td align=\"center\" style=\"padding: 10px;\">\n              <div style=\"text-align: center; font-size: 13px; color: #888;\">Sistema de Análisis de Sentimientos | © 2025 IFX</div>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>\n</body>\n\n</html> "},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-60,-600],"id":"a81256d5-2aef-43bc-b8d9-1c2328d11060","name":"HTML"},{"parameters":{"promptType":"define","text":"=REALIZA UN ANALISIS DE SENTIMIENTO PARA EL TEXTO: {{ $json.comentario }}\n\nRESPONDE EL VALOR DEL SENTIMIENTO: Neutral, Positive, Negative\nNIVEL DE CONFIANZA DEL ANALISIS UN VALOR DEL 10 AL 100%\nNIVEL DE SERVERIDAD DEL SENTIMIENTO UN VALOR DEL 10 AL 100%\n\nResponde con formato Json: \n{ \n  \"sentimiento\": \"string\",\n  \"nivel_de_confianza\": 0,\n  \"nivel_de_severidad\": 0\n}","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-660,-600],"id":"e5604e9d-ea4a-41e9-b5bd-8dfe62eb17e6","name":"AI Agent"},{"parameters":{"assignments":{"assignments":[{"id":"2ba5bf76-23dc-48a8-8f7c-c4be2eee0e6f","name":"titulo","value":"={{ $json.caption }}","type":"string"},{"id":"c9597ebb-2737-4a5a-ab34-7be65899ef6a","name":"link","value":"={{ $json.permalink }}","type":"string"},{"id":"d328d1d2-05db-4f6d-9cc9-f4f32d627ad9","name":"comentario","value":"={{ $('EndpointInstagram_comentarios').item.json.body.entry[0].changes[0].value.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-880,-600],"id":"33a4c920-0b5c-49cc-9287-3a18ce0eb152","name":"Edit Fields"},{"parameters":{"model":{"__rl":true,"value":"llama-3.3-70B-Instruct","mode":"list","cachedResultName":"llama-3.3-70B-Instruct"},"options":{"temperature":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-760,-380],"id":"92b9dbc4-b87c-43e7-be11-3940b6fd8c82","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"lu44hoWfCkZALmQk","name":"Api Sentinel"}}},{"parameters":{"schemaType":"manual","inputSchema":"{ \n  \"sentimiento\": \"string\",\n  \"nivel_de_confianza\": 0,\n  \"nivel_de_severidad\": 0\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-500,-380],"id":"8fcc326f-0542-4f26-8033-8c10fedb8b3a","name":"Structured Output Parser"}],"connections":{"EndpointInstagram":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"EndpointInstagram_comentarios":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"HTML","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"AI Agent","type":"ai_outputParser","index":0}]]}},"settings":{"executionOrder":"v1","saveDataSuccessExecution":"all","callerPolicy":"workflowsFromSameOwner"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"EndpointInstagram_comentarios":[{"json":{"headers":{"host":"n8n.aifx.com.co","x-real-ip":"69.171.251.114","x-forwarded-for":"69.171.251.114","x-forwarded-proto":"https","connection":"upgrade","content-length":"321","x-hub-signature":"sha1=03a2b08b35667283af93dde240fc6c9e1a3ba5d2","x-hub-signature-256":"sha256=650bb56d94e4f00c2cce067ee2c53263ed2d9c07dec0b9d7ab539e2a68011516","content-type":"application/json","user-agent":"Webhooks/1.0 (https://fb.me/webhooks)","accept":"*/*"},"params":{},"query":{},"body":{"entry":[{"id":"17841470402200103","time":1749056875,"changes":[{"value":{"from":{"id":"1295320142203826","username":"sadian88"},"media":{"id":"17953621157823119","media_product_type":"FEED"},"id":"18048238478430879","text":"Hoy ha sido un día increíble. Recibí buenas noticias, logré avanzar en mis proyectos y además pude compartir tiempo con personas que valoro mucho. Me siento agradecido y motivado para seguir dando lo mejor de mí cada día."},"field":"comments"}]}],"object":"instagram"},"webhookUrl":"https://n8n.aifx.com.co/webhook/insta","executionMode":"production"}}]},"versionId":"8089142f-08fa-410e-a685-a5936252a709","triggerCount":1,"tags":[]}