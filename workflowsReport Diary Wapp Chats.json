{"createdAt":"2025-05-31T13:27:55.970Z","updatedAt":"2025-05-31T14:47:08.000Z","id":"5RHEWEypXBbulmXR","name":"Report Diary Wapp Chats","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-280,0],"id":"7a36fb3b-a6e2-41e0-bcd6-32b2aeef6067","name":"When clicking ‘Execute workflow’"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.fecha }}"}]},"data":"={{ $json.total_conversations }}","chartOptions":{"devicePixelRatio":1},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"Conversaciones por Día"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[400,0],"id":"32021963-2aa6-4dc3-8dc0-81f9676e9106","name":"QuickChart"},{"parameters":{"operation":"executeQuery","query":"SELECT \n  TO_CHAR(DATE(\"dateTime\"), 'DD-Mon') as fecha,\n  COUNT(*) as total_conversations\nFROM messages\nWHERE conversation IS NOT NULL AND conversation != ''\nGROUP BY DATE(\"dateTime\")\nORDER BY DATE(\"dateTime\") ASC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-40,0],"id":"11a80f18-cc20-481d-9857-18753c12340c","name":"Postgres","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"fecha"},{"fieldToAggregate":"total_conversations"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[180,0],"id":"af637fb4-0d40-4158-a7f8-15a540eb7100","name":"Aggregate"},{"parameters":{"operation":"executeQuery","query":"SELECT \n  DATE(\"dateTime\") as fecha,\n  nombrechat,\n  COUNT(*) as total_conversations\nFROM messages\nWHERE conversation IS NOT NULL AND conversation != ''\n  AND DATE(\"dateTime\") = CURRENT_DATE - INTERVAL '1 day'\nGROUP BY DATE(\"dateTime\"), nombrechat\nORDER BY fecha DESC, total_conversations DESC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-40,180],"id":"7b105ba7-a06d-4e48-84e5-0fccff33dadf","name":"Postgres1","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"nombrechat"},{"fieldToAggregate":"total_conversations"},{"fieldToAggregate":"fecha"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[180,180],"id":"74de9f6a-b731-4894-8700-df71a3a4a504","name":"Aggregate1"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.nombrechat }}"}]},"data":"={{ $json.total_conversations }}","chartOptions":{"devicePixelRatio":1},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"=Chats del {{ $now.minus({ days: 1 }).toFormat('dd-MMM') }}"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[400,180],"id":"f750fe4a-a1f2-48ca-92a0-aa2746d9b604","name":"QuickChart1"},{"parameters":{"operation":"executeQuery","query":"SELECT \n   sentimiento,\n   COUNT(*) as total\nFROM summary_sentimientos\nWHERE EXTRACT(MONTH FROM created_at) = {{ $now.month }} \n   AND EXTRACT(YEAR FROM created_at) = {{ $now.year }}\nGROUP BY sentimiento\nORDER BY total DESC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-40,380],"id":"7f38c86d-f066-4421-ac19-aba31c9270ad","name":"Postgres2","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"sentimiento"},{"fieldToAggregate":"total"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[180,380],"id":"43b6a3d7-b025-48b0-8802-57bc7e457895","name":"Aggregate2"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.sentimiento }}"}]},"data":"={{ $json.total }}","chartOptions":{"devicePixelRatio":1},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"=Chats de {{ $now.toFormat('MMMM', { locale: 'es' }).toUpperCase() }}"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[400,380],"id":"94106f79-95e0-4675-af5d-eab6edcedbd6","name":"QuickChart2"},{"parameters":{"operation":"executeQuery","query":"SELECT \n  sentimiento,\n  COUNT(*) as total\nFROM summary_sentimientos\nWHERE DATE(created_at) = CURRENT_DATE - INTERVAL '1 day'\nGROUP BY sentimiento\nORDER BY total DESC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-40,580],"id":"51e44c37-da76-4a67-b09a-359f0bd9417b","name":"Postgres3","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"sentimiento"},{"fieldToAggregate":"total"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[180,580],"id":"0d9a286f-5e9f-479a-a5e1-6ab33ebdf9f8","name":"Aggregate3"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.sentimiento }}"}]},"data":"={{ $json.total }}","chartOptions":{"devicePixelRatio":1},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"=Chats del {{ $now.minus({ days: 1 }).toFormat('dd-MMM') }}"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[400,580],"id":"5ffa1748-3597-4cad-ad66-2495e749c923","name":"QuickChart3"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Postgres","type":"main","index":0},{"node":"Postgres1","type":"main","index":0},{"node":"Postgres2","type":"main","index":0},{"node":"Postgres3","type":"main","index":0}]]},"Postgres":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"QuickChart","type":"main","index":0}]]},"Postgres1":{"main":[[{"node":"Aggregate1","type":"main","index":0}]]},"Aggregate1":{"main":[[{"node":"QuickChart1","type":"main","index":0}]]},"Postgres2":{"main":[[{"node":"Aggregate2","type":"main","index":0}]]},"Aggregate2":{"main":[[{"node":"QuickChart2","type":"main","index":0}]]},"Postgres3":{"main":[[{"node":"Aggregate3","type":"main","index":0}]]},"Aggregate3":{"main":[[{"node":"QuickChart3","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"a1b45f3e-28be-42fc-bb45-5dd8339aa6ae","triggerCount":0,"tags":[]}