{"createdAt":"2025-05-31T13:27:55.970Z","updatedAt":"2025-06-28T15:20:34.000Z","id":"5RHEWEypXBbulmXR","name":"Report Diary Wapp Chats","active":true,"isArchived":false,"nodes":[{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.fecha }}"}]},"data":"={{ $json.total_conversations }}","chartOptions":{"devicePixelRatio":1,"format":"png"},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"Conversaciones Diarias"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[260,140],"id":"32021963-2aa6-4dc3-8dc0-81f9676e9106","name":"QuickChart"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"fecha"},{"fieldToAggregate":"total_conversations"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[40,140],"id":"af637fb4-0d40-4158-a7f8-15a540eb7100","name":"Aggregate"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"nombrechat"},{"fieldToAggregate":"total_conversations"},{"fieldToAggregate":"fecha"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[40,340],"id":"74de9f6a-b731-4894-8700-df71a3a4a504","name":"Aggregate1"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.nombrechat }}"}]},"data":"={{ $json.total_conversations }}","chartOptions":{"devicePixelRatio":1,"format":"png"},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"=Chats del {{ $now.minus({ days: 1 }).toFormat('dd-MMM') }}"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[260,340],"id":"f750fe4a-a1f2-48ca-92a0-aa2746d9b604","name":"QuickChart1"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"sentimiento"},{"fieldToAggregate":"total"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[40,540],"id":"43b6a3d7-b025-48b0-8802-57bc7e457895","name":"Aggregate2"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.sentimiento }}"}]},"data":"={{ $json.total }}","chartOptions":{"devicePixelRatio":1,"format":"png"},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"=Sentimientos del mes de {{ $now.toFormat('MMMM', { locale: 'es' }).toUpperCase() }}"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[260,540],"id":"94106f79-95e0-4675-af5d-eab6edcedbd6","name":"QuickChart2"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"sentimiento"},{"fieldToAggregate":"total"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[40,740],"id":"0d9a286f-5e9f-479a-a5e1-6ab33ebdf9f8","name":"Aggregate3"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.sentimiento }}"}]},"data":"={{ $json.total }}","chartOptions":{"devicePixelRatio":1,"format":"png"},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"=Chats del {{ $now.minus({ days: 1 }).toFormat('dd-MMM') }}"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[260,740],"id":"5ffa1748-3597-4cad-ad66-2495e749c923","name":"QuickChart3"},{"parameters":{"operation":"executeQuery","query":"SELECT \n  TO_CHAR(DATE(\"dateTime\"), 'DD-Mon') as fecha,\n  COUNT(*) as total_conversations\nFROM messages\nWHERE conversation IS NOT NULL AND conversation != ''\nGROUP BY DATE(\"dateTime\")\nORDER BY DATE(\"dateTime\") ASC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-180,140],"id":"11a80f18-cc20-481d-9857-18753c12340c","name":"Chats Total Mes","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"operation":"executeQuery","query":"SELECT \n DATE(\"dateTime\") as fecha,\n nombrechat,\n COUNT(*) as total_conversations\nFROM messages\nWHERE conversation IS NOT NULL AND conversation != ''\n AND DATE(\"dateTime\") = CURRENT_DATE - INTERVAL '1 day'\nGROUP BY DATE(\"dateTime\"), nombrechat\nORDER BY fecha DESC, total_conversations DESC\nLIMIT 10;\n\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-180,340],"id":"7b105ba7-a06d-4e48-84e5-0fccff33dadf","name":"Chats Total Dia Anterior","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"operation":"executeQuery","query":"SELECT \n   sentimiento,\n   COUNT(*) as total\nFROM summary_sentimientos\nWHERE EXTRACT(MONTH FROM created_at) = {{ $now.month }} \n   AND EXTRACT(YEAR FROM created_at) = {{ $now.year }}\nGROUP BY sentimiento\nORDER BY total DESC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-180,540],"id":"7f38c86d-f066-4421-ac19-aba31c9270ad","name":"Sentimientos Mes Actual","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"operation":"executeQuery","query":"SELECT \n  sentimiento,\n  COUNT(*) as total\nFROM summary_sentimientos\nWHERE DATE(created_at) = CURRENT_DATE - INTERVAL '1 day'\nGROUP BY sentimiento\nORDER BY total DESC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-180,740],"id":"51e44c37-da76-4a67-b09a-359f0bd9417b","name":"Sentimientos Dia Anterior","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"chat"},{"fieldToAggregate":"total_negativos"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[40,940],"id":"7a4df4d4-539a-4f12-80c6-4db65d3461e8","name":"Aggregate4"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.chat }}"}]},"data":"={{ $json.total_negativos }}","chartOptions":{"devicePixelRatio":1,"format":"png"},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"=Chats Negativos del mes de {{ $now.toFormat('MMMM', { locale: 'es' }).toUpperCase() }}"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[260,940],"id":"09c155f4-011e-4c61-8bf9-cb403aa5dbaa","name":"QuickChart4"},{"parameters":{"operation":"executeQuery","query":"SELECT \n CASE \n    WHEN REPLACE(REPLACE(chat, CHR(10), ''), CHR(13), '') = '' OR chat IS NULL \n    THEN 'TBD' \n    ELSE REPLACE(REPLACE(chat, CHR(10), ''), CHR(13), '') \n END as chat,\n COUNT(*) as total_negativos\nFROM summary_sentimientos\nWHERE sentimiento = 'NEGATIVE'\n AND EXTRACT(MONTH FROM created_at) = EXTRACT(MONTH FROM CURRENT_DATE)\n AND EXTRACT(YEAR FROM created_at) = EXTRACT(YEAR FROM CURRENT_DATE)\nGROUP BY chat\nORDER BY total_negativos DESC\nLIMIT 10;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-180,940],"id":"3972ff7d-4dc9-4b42-a1b7-25805cb80b67","name":"Negativo Mes Anterior","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"chat"},{"fieldToAggregate":"total_negativos"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[40,1140],"id":"0658323b-4202-4b2f-993e-45ea9b358ea6","name":"Aggregate5"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.chat }}"}]},"data":"={{ $json.total_negativos }}","chartOptions":{"devicePixelRatio":1,"format":"png"},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"=Chats del {{ $now.minus({ days: 1 }).toFormat('dd-MMM') }}"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[260,1140],"id":"fe77c901-60fe-4c6b-96c2-ecb8750c9212","name":"QuickChart5"},{"parameters":{"operation":"executeQuery","query":"SELECT \n  CASE \n     WHEN REPLACE(REPLACE(chat, CHR(10), ''), CHR(13), '') = '' OR chat IS NULL \n     THEN 'TBD' \n     ELSE REPLACE(REPLACE(chat, CHR(10), ''), CHR(13), '') \n  END as chat,\n  COUNT(*) as total_negativos\nFROM summary_sentimientos\nWHERE sentimiento = 'NEGATIVE'\n  AND DATE(created_at) = CURRENT_DATE - INTERVAL '1 day'\nGROUP BY chat\nORDER BY total_negativos DESC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-180,1140],"id":"f09c6e62-ec28-4044-90d7-0bbcd8120026","name":"Negativo Dia Anterior","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"html":"<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Resumen de Sentimientos y Conversaciones</title>\n</head>\n<body style=\"margin: 0; padding: 20px; font-family: Arial, sans-serif; background-color: #f5f5f5;\">\n    <table style=\"width: 100%; max-width: 800px; margin: 0 auto; background-color: #667eea; border-radius: 8px;\">\n    <tr>\n        <td style=\"padding: 30px;\">\n            <table style=\"width: 100%; border-collapse: collapse;\">\n                <tr>\n                    <td style=\"vertical-align: middle; width: auto; padding-right: 20px;\">\n                        <span style=\"font-size: 64px; font-style: italic; font-family: serif; color: #ffffff;\">ifx</span>\n                    </td>\n                    <td style=\"vertical-align: middle; text-align: center;\">\n                        <h1 style=\"color: #ffffff; margin: 0; font-size: 24px; font-weight: bold; word-wrap: break-word;\">📊 Resumen de Sentimientos y Conversaciones</h1>\n                        <p style=\"color: #ffffff; margin: 10px 0 0 0; font-size: 14px;\">Análisis WhatsApp - Reporte Diario</p>\n                        <p style=\"color: #ffffff; margin: 10px 0 0 0; font-size: 14px;\">Generated by <span style=\"font-style: italic; font-family: serif; font-size: 16px;\">aifx</span></p>\n                    </td>\n                </tr>\n            </table>\n        </td>\n    </tr>\n</table>\n\n  <!-- Stats Summary -->\n    <table style=\"width: 100%; max-width: 800px; margin: 20px auto 0 auto; background-color: #ffffff; border-radius: 8px; border: 1px solid #e2e8f0;\">\n        <tr>\n            <td style=\"padding: 25px;\">\n                <h2 style=\"color: #333333; margin: 0 0 20px 0; font-size: 18px; border-bottom: 3px solid #8b5cf6; padding-bottom: 10px; word-wrap: break-word;\">📊 Cantidades Generales del Dia</h2>\n                \n                <table style=\"width: 100%;\">\n                    <tr>\n                        <td style=\"width: 33.33%; padding: 10px; text-align: center; background-color: #f8fafc; border-radius: 6px; border: 1px solid #e2e8f0;\">\n                            <div style=\"color: #3b82f6; font-size: 28px; font-weight: bold; margin-bottom: 5px;\">{{ $json.total_registros }}</div>\n                            <div style=\"color: #1e40af; font-size: 14px; font-weight: bold;\">Chats Totales</div>\n                            <div style=\"color: #64748b; font-size: 12px;\">Total registrado</div>\n                        </td>\n                        <td style=\"width: 33.33%; padding: 10px; text-align: center; background-color: #f0fdf4; border-radius: 6px; border: 1px solid #bbf7d0;\">\n                            <div style=\"color: #059669; font-size: 28px; font-weight: bold; margin-bottom: 5px;\">{{ $json.unique_chats }}</div>\n                            <div style=\"color: #065f46; font-size: 14px; font-weight: bold;\">Chats</div>\n                            <div style=\"color: #64748b; font-size: 12px;\">Con actividad</div>\n                        </td>\n                        <td style=\"width: 33.33%; padding: 10px; text-align: center; background-color: #fef2f2; border-radius: 6px; border: 1px solid #fecaca;\">\n                            <div style=\"color: #dc2626; font-size: 28px; font-weight: bold; margin-bottom: 5px;\">{{ $json.total_negativos }}</div>\n                            <div style=\"color: #991b1b; font-size: 14px; font-weight: bold;\">Mensajes Negativos</div>\n                            <div style=\"color: #b91c1c; font-size: 12px;\">Certeza: {{ Math.round($json.promedio_confianza * 100) }}%% | Intensidad: {{ Math.round($json.promedio_intensidad * 100) }}%</div>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    </table>\n\n    <!-- Daily Section -->\n    <table style=\"width: 100%; max-width: 800px; margin: 20px auto 0 auto; background-color: #ffffff; border-radius: 8px; border: 1px solid #e2e8f0;\">\n        <tr>\n            <td style=\"padding: 25px;\">\n                <h2 style=\"color: #333333; margin: 0 0 20px 0; font-size: 18px; border-bottom: 3px solid #3B82F6; padding-bottom: 10px; word-wrap: break-word;\">📅 Resumen del Día Anterior</h2>\n                \n                <!-- Daily Charts Row 1 -->\n                <table style=\"width: 100%; margin-bottom: 25px;\">\n                    <tr>\n                        <td style=\"width: 100%; padding-bottom: 15px; vertical-align: top;\">\n                            <table style=\"width: 100%; background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; margin-bottom: 15px;\">\n                                <tr>\n                                    <td style=\"padding: 15px; text-align: center;\">\n                                        <h3 style=\"color: #1e40af; margin: 0 0 15px 0; font-size: 14px; word-wrap: break-word;\">Conversaciones por Chat</h3>\n                                        <div style=\"background-color: #ffffff; border: 1px solid #e2e8f0; border-radius: 4px; padding: 10px; overflow: hidden;\">\n                                            <img src=\"data:image/png;base64,{{ $json.data1 }}\" style=\"max-width: 100%; height: auto; display: block; margin: 0 auto;\" alt=\"Conversaciones por Chat\">\n                                        </div>\n                                        <div style=\"background-color: #f1f5f9; border: 1px solid #cbd5e1; border-radius: 4px; padding: 10px; margin-top: 10px;\">\n                                            <h4 style=\"color: #334155; margin: 0 0 5px 0; font-size: 12px; font-weight: bold;\">📊 Analisis de los Datos</h4>\n                                            <p style=\"color: #64748b; margin: 0; font-size: 11px;\">Coming Soon</p>\n                                        </div>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"width: 100%; padding-bottom: 15px; vertical-align: top;\">\n                            <table style=\"width: 100%; background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px;\">\n                                <tr>\n                                    <td style=\"padding: 15px; text-align: center;\">\n                                        <h3 style=\"color: #1e40af; margin: 0 0 15px 0; font-size: 14px; word-wrap: break-word;\">Sentimientos del Día</h3>\n                                        <div style=\"background-color: #ffffff; border: 1px solid #e2e8f0; border-radius: 4px; padding: 10px; overflow: hidden;\">\n                                            <img src=\"data:image/png;base64,{{ $json.data3 }}\" style=\"max-width: 100%; height: auto; display: block; margin: 0 auto;\" alt=\"Sentimientos del Día\">\n                                        </div>\n                                        <div style=\"background-color: #f1f5f9; border: 1px solid #cbd5e1; border-radius: 4px; padding: 10px; margin-top: 10px;\">\n                                            <h4 style=\"color: #334155; margin: 0 0 5px 0; font-size: 12px; font-weight: bold;\">📊 Analisis de los Datos</h4>\n                                            <p style=\"color: #64748b; margin: 0; font-size: 11px;\">Coming Soon</p>\n                                        </div>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                </table>\n\n                <!-- Daily Charts Row 2 -->\n                <table style=\"width: 100%;\">\n                    <tr>\n                        <td style=\"width: 100%; padding: 0;\">\n                            <table style=\"width: 100%; background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px;\">\n                                <tr>\n                                    <td style=\"padding: 15px; text-align: center;\">\n                                        <h3 style=\"color: #dc2626; margin: 0 0 15px 0; font-size: 14px; word-wrap: break-word;\">🚨 Chats Negativos del Día</h3>\n                                        <div style=\"background-color: #ffffff; border: 1px solid #e2e8f0; border-radius: 4px; padding: 10px; overflow: hidden;\">\n                                            <img src=\"data:image/png;base64,{{ $json.data5 }}\" style=\"max-width: 100%; height: auto; display: block; margin: 0 auto;\" alt=\"Chats Negativos del Día\">\n                                        </div>\n                                        <div style=\"background-color: #fef2f2; border: 1px solid #fecaca; border-radius: 4px; padding: 10px; margin-top: 10px;\">\n                                            <h4 style=\"color: #991b1b; margin: 0 0 5px 0; font-size: 12px; font-weight: bold;\">📊 Analisis de los Datos</h4>\n                                            <p style=\"color: #b91c1c; margin: 0; font-size: 11px;\">Coming Soon</p>\n                                        </div>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    </table>\n\n    <!-- Monthly Section -->\n    <table style=\"width: 100%; max-width: 800px; margin: 20px auto 0 auto; background-color: #ffffff; border-radius: 8px; border: 1px solid #bbf7d0;\">\n        <tr>\n            <td style=\"padding: 25px;\">\n                <h2 style=\"color: #333333; margin: 0 0 20px 0; font-size: 18px; border-bottom: 3px solid #10b981; padding-bottom: 10px; word-wrap: break-word;\">📈 Acumulado del Mes</h2>\n                \n                <!-- Monthly Charts Row 1 -->\n                <table style=\"width: 100%; margin-bottom: 25px;\">\n                    <tr>\n                        <td style=\"width: 100%; padding-bottom: 15px; vertical-align: top;\">\n                            <table style=\"width: 100%; background-color: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 6px; margin-bottom: 15px;\">\n                                <tr>\n                                    <td style=\"padding: 15px; text-align: center;\">\n                                        <h3 style=\"color: #059669; margin: 0 0 15px 0; font-size: 14px; word-wrap: break-word;\">Conversaciones por Día</h3>\n                                        <div style=\"background-color: #ffffff; border: 1px solid #bbf7d0; border-radius: 4px; padding: 10px; overflow: hidden;\">\n                                            <img src=\"data:image/png;base64,{{ $json.data }}\" style=\"max-width: 100%; height: auto; display: block; margin: 0 auto;\" alt=\"Conversaciones del Mes\">\n                                        </div>\n                                        <div style=\"background-color: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 4px; padding: 10px; margin-top: 10px;\">\n                                            <h4 style=\"color: #065f46; margin: 0 0 5px 0; font-size: 12px; font-weight: bold;\">📊 Analisis de los Datos</h4>\n                                            <p style=\"color: #059669; margin: 0; font-size: 11px;\">Coming Soon</p>\n                                        </div>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"width: 100%; padding-bottom: 15px; vertical-align: top;\">\n                            <table style=\"width: 100%; background-color: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 6px;\">\n                                <tr>\n                                    <td style=\"padding: 15px; text-align: center;\">\n                                        <h3 style=\"color: #059669; margin: 0 0 15px 0; font-size: 14px; word-wrap: break-word;\">Sentimientos del Mes</h3>\n                                        <div style=\"background-color: #ffffff; border: 1px solid #bbf7d0; border-radius: 4px; padding: 10px; overflow: hidden;\">\n                                            <img src=\"data:image/png;base64,{{ $json.data2 }}\" style=\"max-width: 100%; height: auto; display: block; margin: 0 auto;\" alt=\"Sentimientos del Mes\">\n                                        </div>\n                                        <div style=\"background-color: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 4px; padding: 10px; margin-top: 10px;\">\n                                            <h4 style=\"color: #065f46; margin: 0 0 5px 0; font-size: 12px; font-weight: bold;\">📊 Resumen Visual</h4>\n                                            <p style=\"color: #059669; margin: 0; font-size: 11px;\">Coming Soon</p>\n                                        </div>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                </table>\n\n                <!-- Monthly Charts Row 2 -->\n                <table style=\"width: 100%;\">\n                    <tr>\n                        <td style=\"width: 100%; padding: 0;\">\n                            <table style=\"width: 100%; background-color: #fef2f2; border: 1px solid #fecaca; border-radius: 6px;\">\n                                <tr>\n                                    <td style=\"padding: 15px; text-align: center;\">\n                                        <h3 style=\"color: #dc2626; margin: 0 0 15px 0; font-size: 14px; word-wrap: break-word;\">⚠️ Chats Negativos del Mes</h3>\n                                        <div style=\"background-color: #ffffff; border: 1px solid #fecaca; border-radius: 4px; padding: 10px; overflow: hidden;\">\n                                            <img src=\"data:image/png;base64,{{ $json.data4 }}\" style=\"max-width: 100%; height: auto; display: block; margin: 0 auto;\" alt=\"Chats Negativos del Mes\">\n                                        </div>\n                                        <div style=\"background-color: #fef2f2; border: 1px solid #fecaca; border-radius: 4px; padding: 10px; margin-top: 10px;\">\n                                            <h4 style=\"color: #991b1b; margin: 0 0 5px 0; font-size: 12px; font-weight: bold;\">📊 Analisis de los Datos</h4>\n                                            <p style=\"color: #b91c1c; margin: 0; font-size: 11px;\">Coming Soon</p>\n                                        </div>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    </table>\n\n    <!-- Summary Stats -->\n    <table style=\"width: 100%; max-width: 800px; margin: 20px auto 0 auto; background-color: #ffffff; border-radius: 8px; border: 1px solid #e2e8f0;\">\n        <tr>\n            <td style=\"padding: 25px;\">\n                <h2 style=\"color: #333333; margin: 0 0 20px 0; font-size: 18px; border-bottom: 3px solid #f59e0b; padding-bottom: 10px; word-wrap: break-word;\">📋 Metodologia de la Analitica</h2>\n                \n                <table style=\"width: 100%;\">\n                    <tr>\n                        <td style=\"width: 33.33%; padding: 15px; text-align: center; background-color: #eff6ff; border-radius: 6px;\">\n                            <div style=\"color: #1e40af; font-size: 20px; font-weight: bold; margin-bottom: 5px;\">📊</div>\n                            <div style=\"color: #1e40af; font-size: 12px; font-weight: bold;\">Análisis Automatizado</div>\n                            <div style=\"color: #64748b; font-size: 10px;\">Generated by <span\n                        style=\"font-style: italic; font-family: serif; font-size: 12px;\">aifx</span></div>\n                        </td>\n                        <td style=\"width: 33.33%; padding: 15px; text-align: center; background-color: #f0fdf4; border-radius: 6px;\">\n                            <div style=\"color: #059669; font-size: 20px; font-weight: bold; margin-bottom: 5px;\">💬</div>\n                            <div style=\"color: #059669; font-size: 12px; font-weight: bold;\">WhatsApp Analytics</div>\n                            <div style=\"color: #64748b; font-size: 10px;\">Tiempo Real</div>\n                        </td>\n                        <td style=\"width: 33.33%; padding: 15px; text-align: center; background-color: #fef2f2; border-radius: 6px;\">\n                            <div style=\"color: #dc2626; font-size: 20px; font-weight: bold; margin-bottom: 5px;\">🎯</div>\n                            <div style=\"color: #dc2626; font-size: 12px; font-weight: bold;\">Alertas Tempranas</div>\n                            <div style=\"color: #64748b; font-size: 10px;\">Detección Proactiva</div>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    </table>\n\n    <!-- Footer -->\n    <table style=\"width: 100%; max-width: 800px; margin: 20px auto 40px auto;\">\n        <tr>\n            <td style=\"padding: 20px; text-align: center; color: #64748b; font-size: 10px;\">\n                <p style=\"margin: 0; word-wrap: break-word;\">📧 Reporte generado automáticamente • 🕒 Fecha: {{ $now.format('yyyy-MM-dd') }}</p>\n                <p style=\"margin: 5px 0 0 0; word-wrap: break-word;\">💡 Para más información, contacte con ai@ifxcorp.com</p>\n            </td>\n        </tr>\n    </table>\n</body>\n</html>"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[920,940],"id":"47e31e89-2c08-4789-9896-337f18525682","name":"HTML"},{"parameters":{"operation":"binaryToPropery","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[480,140],"id":"84a2d01c-7517-439e-90ef-baf68e4a85d3","name":"Extract from File"},{"parameters":{"operation":"binaryToPropery","destinationKey":"data1","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[480,340],"id":"e048aef1-e327-4458-9598-a0838779338d","name":"Extract from File1"},{"parameters":{"operation":"binaryToPropery","destinationKey":"data2","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[480,540],"id":"0aff4a9f-c802-4b5c-994e-94737a8084e7","name":"Extract from File2"},{"parameters":{"operation":"binaryToPropery","destinationKey":"data3","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[480,740],"id":"16426173-03d9-4f88-85d8-d1ffe1cc51c7","name":"Extract from File3"},{"parameters":{"operation":"binaryToPropery","destinationKey":"data4","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[480,940],"id":"8b1f64dc-1c1f-4f97-953e-a4105116735b","name":"Extract from File4"},{"parameters":{"operation":"binaryToPropery","destinationKey":"data5","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[480,1140],"id":"9df3b1c1-f1e2-4af6-bb6f-597834a04eb3","name":"Extract from File5"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","numberInputs":9,"options":{"includeUnpaired":true}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[700,814],"id":"af6c770a-1139-4bc6-a95e-01ff1ca03457","name":"Merge","alwaysOutputData":true},{"parameters":{"jsCode":"// Limpiar saltos de línea del HTML\nconst htmlContent = $input.first().json.html;\nconst cleanedHtml = htmlContent.replace(/\\n/g, '').replace(/\\r/g, '');\n\nreturn [{\n  json: {\n    html: cleanedHtml\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1140,940],"id":"48ec89bc-257e-4722-b655-d9b91f0a7e9d","name":"Code"},{"parameters":{"operation":"executeQuery","query":"SELECT COUNT(id) as total_registros\nFROM equivalencia_chats;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[480,1340],"id":"4f8481e7-1ab8-495f-8cec-592b4af7515b","name":"Count Chats","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"operation":"executeQuery","query":"SELECT COUNT(DISTINCT chat) as unique_chats\nFROM summary_sentimientos\nWHERE DATE(created_at) = CURRENT_DATE - INTERVAL '1 day';","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[480,1540],"id":"9d53eecd-6fc1-4c69-b49e-cbb7a191a074","name":"Count Chats1","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"operation":"executeQuery","query":"SELECT \n AVG(confianza) as promedio_confianza,\n AVG(intensidad) as promedio_intensidad,\n COUNT(*) as total_negativos\nFROM summary_sentimientos\nWHERE sentimiento = 'NEGATIVE'\n AND DATE(created_at) = CURRENT_DATE - INTERVAL '1 day';","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[480,1740],"id":"84416adf-fbf0-4b84-92df-08c80f05b2be","name":"Count Chats2","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"rule":{"interval":[{"triggerAtHour":9}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-400,940],"id":"df67058a-66da-4d87-9e79-032f1556c7c5","name":"Schedule Trigger"},{"parameters":{"toRecipients":"jaimep@ifxcorp.com","subject":"📈 Dashboard WhatsApp - Resumen Actividad Diaria y Mensual","bodyContent":"={{ $('Code').item.json.html }}","additionalFields":{"bodyContentType":"html"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[1580,1040],"id":"53a40ca7-0eb4-4e86-a0db-ff3f33e2f2e1","name":"Mail Testing","webhookId":"d216cc8d-eece-4961-beb8-27b2fdcaa15e","credentials":{"microsoftOutlookOAuth2Api":{"id":"xSTIlfhp3ac7TN3h","name":"Mail ai@ifxcorp.com"}},"disabled":true},{"parameters":{"toRecipients":"ai@ifxcorp.com","subject":"📈 Dashboard WhatsApp - Resumen Actividad Diaria y Mensual","bodyContent":"={{ $('Code').item.json.html }}","additionalFields":{"bccRecipients":"jaimep@ifxcorp.com, ezequiel@ifxcorp.com, atellez@ifxcorp.com, wrivera@ifxcorp.com, dcubides@ifxcorp.com, cnospina@ifxcorp.com, badevia@ifxcorp.com, aperez@ifxcorp.com, aguevara@ifxcorp.com, lheredia@ifxcorp.com, eronchaquira@ifxcorp.com, eronchaquira@ifxcorp.com, spduque@ifxcorp.com, lgarzon@ifxcorp.com","bodyContentType":"html"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[1800,740],"id":"e072d11a-302f-4dde-aaf9-f380ed68469e","name":"Mail Production","webhookId":"d216cc8d-eece-4961-beb8-27b2fdcaa15e","credentials":{"microsoftOutlookOAuth2Api":{"id":"xSTIlfhp3ac7TN3h","name":"Mail ai@ifxcorp.com"}}},{"parameters":{"operation":"sendAndWait","toRecipients":"jaimep@ifxcorp.com","subject":"📈  **APROBACION** Dashboard WhatsApp - Resumen Actividad","message":"={{ $json.html }}","approvalOptions":{"values":{"approvalType":"double"}},"options":{"limitWaitTime":{"values":{"resumeAmount":5}}}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[1360,940],"id":"6f26a50d-a794-4e4a-a2fa-06227fe67e31","name":"Aprobado?","webhookId":"eb3e186a-1e76-4e7a-9b35-17d80ad57e40","credentials":{"microsoftOutlookOAuth2Api":{"id":"xSTIlfhp3ac7TN3h","name":"Mail ai@ifxcorp.com"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1800,940],"id":"e3f1811b-45ab-45f6-8bb9-7dfc259ead0d","name":"No Operation, do nothing"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"de2082c7-d15c-4bed-80c1-fcc949bd525b","leftValue":"={{ $json.data.approved }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1580,840],"id":"3950c417-ba02-4bd0-9141-98f322884482","name":"If Aprove?"}],"connections":{"Aggregate":{"main":[[{"node":"QuickChart","type":"main","index":0}]]},"Aggregate1":{"main":[[{"node":"QuickChart1","type":"main","index":0}]]},"Aggregate2":{"main":[[{"node":"QuickChart2","type":"main","index":0}]]},"Aggregate3":{"main":[[{"node":"QuickChart3","type":"main","index":0}]]},"Chats Total Mes":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Chats Total Dia Anterior":{"main":[[{"node":"Aggregate1","type":"main","index":0}]]},"Sentimientos Mes Actual":{"main":[[{"node":"Aggregate2","type":"main","index":0}]]},"Sentimientos Dia Anterior":{"main":[[{"node":"Aggregate3","type":"main","index":0}]]},"Aggregate4":{"main":[[{"node":"QuickChart4","type":"main","index":0}]]},"Negativo Mes Anterior":{"main":[[{"node":"Aggregate4","type":"main","index":0}]]},"Aggregate5":{"main":[[{"node":"QuickChart5","type":"main","index":0}]]},"Negativo Dia Anterior":{"main":[[{"node":"Aggregate5","type":"main","index":0}]]},"QuickChart":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"QuickChart1":{"main":[[{"node":"Extract from File1","type":"main","index":0}]]},"QuickChart2":{"main":[[{"node":"Extract from File2","type":"main","index":0}]]},"QuickChart3":{"main":[[{"node":"Extract from File3","type":"main","index":0}]]},"QuickChart4":{"main":[[{"node":"Extract from File4","type":"main","index":0}]]},"QuickChart5":{"main":[[{"node":"Extract from File5","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Extract from File1":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Extract from File2":{"main":[[{"node":"Merge","type":"main","index":2}]]},"Extract from File3":{"main":[[{"node":"Merge","type":"main","index":3}]]},"Extract from File4":{"main":[[{"node":"Merge","type":"main","index":4}]]},"Extract from File5":{"main":[[{"node":"Merge","type":"main","index":5}]]},"HTML":{"main":[[{"node":"Code","type":"main","index":0}]]},"Merge":{"main":[[{"node":"HTML","type":"main","index":0}]]},"Code":{"main":[[{"node":"Aprobado?","type":"main","index":0}]]},"Count Chats":{"main":[[{"node":"Merge","type":"main","index":6}]]},"Count Chats2":{"main":[[{"node":"Merge","type":"main","index":8}]]},"Count Chats1":{"main":[[{"node":"Merge","type":"main","index":7}]]},"Schedule Trigger":{"main":[[{"node":"Chats Total Mes","type":"main","index":0},{"node":"Chats Total Dia Anterior","type":"main","index":0},{"node":"Sentimientos Mes Actual","type":"main","index":0},{"node":"Sentimientos Dia Anterior","type":"main","index":0},{"node":"Negativo Mes Anterior","type":"main","index":0},{"node":"Negativo Dia Anterior","type":"main","index":0},{"node":"Count Chats","type":"main","index":0},{"node":"Count Chats1","type":"main","index":0},{"node":"Count Chats2","type":"main","index":0}]]},"Mail Testing":{"main":[[]]},"Aprobado?":{"main":[[{"node":"Mail Testing","type":"main","index":0},{"node":"If Aprove?","type":"main","index":0}]]},"Mail Production":{"main":[[]]},"If Aprove?":{"main":[[{"node":"Mail Production","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"America/Bogota","saveDataSuccessExecution":"all","callerPolicy":"workflowsFromSameOwner","executionTimeout":300,"errorWorkflow":"Txht1wrdLAI370JY","timeSavedPerExecution":60},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"975d7340-8830-4f79-8644-0827754b3328","triggerCount":1,"tags":[]}