{"createdAt":"2025-05-31T13:27:55.970Z","updatedAt":"2025-05-31T16:21:56.000Z","id":"5RHEWEypXBbulmXR","name":"Report Diary Wapp Chats","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-280,460],"id":"7a36fb3b-a6e2-41e0-bcd6-32b2aeef6067","name":"When clicking ‘Execute workflow’"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.fecha }}"}]},"data":"={{ $json.total_conversations }}","chartOptions":{"devicePixelRatio":1},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"Conversaciones por Día"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[400,120],"id":"32021963-2aa6-4dc3-8dc0-81f9676e9106","name":"QuickChart"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"fecha"},{"fieldToAggregate":"total_conversations"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[180,120],"id":"af637fb4-0d40-4158-a7f8-15a540eb7100","name":"Aggregate"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"nombrechat"},{"fieldToAggregate":"total_conversations"},{"fieldToAggregate":"fecha"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[180,300],"id":"74de9f6a-b731-4894-8700-df71a3a4a504","name":"Aggregate1"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.nombrechat }}"}]},"data":"={{ $json.total_conversations }}","chartOptions":{"devicePixelRatio":1},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"=Chats del {{ $now.minus({ days: 1 }).toFormat('dd-MMM') }}"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[400,300],"id":"f750fe4a-a1f2-48ca-92a0-aa2746d9b604","name":"QuickChart1"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"sentimiento"},{"fieldToAggregate":"total"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[180,460],"id":"43b6a3d7-b025-48b0-8802-57bc7e457895","name":"Aggregate2"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.sentimiento }}"}]},"data":"={{ $json.total }}","chartOptions":{"devicePixelRatio":1},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"=Chats de {{ $now.toFormat('MMMM', { locale: 'es' }).toUpperCase() }}"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[400,460],"id":"94106f79-95e0-4675-af5d-eab6edcedbd6","name":"QuickChart2"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"sentimiento"},{"fieldToAggregate":"total"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[180,620],"id":"0d9a286f-5e9f-479a-a5e1-6ab33ebdf9f8","name":"Aggregate3"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.sentimiento }}"}]},"data":"={{ $json.total }}","chartOptions":{"devicePixelRatio":1},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"=Chats del {{ $now.minus({ days: 1 }).toFormat('dd-MMM') }}"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[400,620],"id":"5ffa1748-3597-4cad-ad66-2495e749c923","name":"QuickChart3"},{"parameters":{"operation":"executeQuery","query":"SELECT \n  TO_CHAR(DATE(\"dateTime\"), 'DD-Mon') as fecha,\n  COUNT(*) as total_conversations\nFROM messages\nWHERE conversation IS NOT NULL AND conversation != ''\nGROUP BY DATE(\"dateTime\")\nORDER BY DATE(\"dateTime\") ASC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-40,120],"id":"11a80f18-cc20-481d-9857-18753c12340c","name":"Chats Total Mes","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"operation":"executeQuery","query":"SELECT \n  DATE(\"dateTime\") as fecha,\n  nombrechat,\n  COUNT(*) as total_conversations\nFROM messages\nWHERE conversation IS NOT NULL AND conversation != ''\n  AND DATE(\"dateTime\") = CURRENT_DATE - INTERVAL '1 day'\nGROUP BY DATE(\"dateTime\"), nombrechat\nORDER BY fecha DESC, total_conversations DESC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-40,300],"id":"7b105ba7-a06d-4e48-84e5-0fccff33dadf","name":"Chats Total Dia Anterior","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"operation":"executeQuery","query":"SELECT \n   sentimiento,\n   COUNT(*) as total\nFROM summary_sentimientos\nWHERE EXTRACT(MONTH FROM created_at) = {{ $now.month }} \n   AND EXTRACT(YEAR FROM created_at) = {{ $now.year }}\nGROUP BY sentimiento\nORDER BY total DESC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-40,460],"id":"7f38c86d-f066-4421-ac19-aba31c9270ad","name":"Sentimientos Mes Actual","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"operation":"executeQuery","query":"SELECT \n  sentimiento,\n  COUNT(*) as total\nFROM summary_sentimientos\nWHERE DATE(created_at) = CURRENT_DATE - INTERVAL '1 day'\nGROUP BY sentimiento\nORDER BY total DESC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-40,620],"id":"51e44c37-da76-4a67-b09a-359f0bd9417b","name":"Sentimientos Dia Anterior","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"chat"},{"fieldToAggregate":"total_negativos"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[180,780],"id":"7a4df4d4-539a-4f12-80c6-4db65d3461e8","name":"Aggregate4"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.chat }}"}]},"data":"={{ $json.total_negativos }}","chartOptions":{"devicePixelRatio":1,"width":800},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"=Chats Negativos {{ $now.toFormat('MMMM', { locale: 'es' }).toUpperCase() }}"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[400,780],"id":"09c155f4-011e-4c61-8bf9-cb403aa5dbaa","name":"QuickChart4"},{"parameters":{"operation":"executeQuery","query":"SELECT \n  CASE \n     WHEN REPLACE(REPLACE(chat, CHR(10), ''), CHR(13), '') = '' OR chat IS NULL \n     THEN 'TBD' \n     ELSE REPLACE(REPLACE(chat, CHR(10), ''), CHR(13), '') \n  END as chat,\n  COUNT(*) as total_negativos\nFROM summary_sentimientos\nWHERE sentimiento = 'NEGATIVE'\n  AND EXTRACT(MONTH FROM created_at) = EXTRACT(MONTH FROM CURRENT_DATE)\n  AND EXTRACT(YEAR FROM created_at) = EXTRACT(YEAR FROM CURRENT_DATE)\nGROUP BY chat\nORDER BY total_negativos DESC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-40,780],"id":"3972ff7d-4dc9-4b42-a1b7-25805cb80b67","name":"Negativo Mes Anterior","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"chat"},{"fieldToAggregate":"total_negativos"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[180,940],"id":"0658323b-4202-4b2f-993e-45ea9b358ea6","name":"Aggregate5"},{"parameters":{"labelsUi":{"labelsValues":[{"label":"={{ $json.chat }}"}]},"data":"={{ $json.total_negativos }}","chartOptions":{"devicePixelRatio":1},"datasetOptions":{"backgroundColor":"#3B82F6","borderColor":"#1E40AF","label":"=Chats del {{ $now.minus({ days: 1 }).toFormat('dd-MMM') }}"}},"type":"n8n-nodes-base.quickChart","typeVersion":1,"position":[400,940],"id":"fe77c901-60fe-4c6b-96c2-ecb8750c9212","name":"QuickChart5"},{"parameters":{"operation":"executeQuery","query":"SELECT \n  CASE \n     WHEN REPLACE(REPLACE(chat, CHR(10), ''), CHR(13), '') = '' OR chat IS NULL \n     THEN 'TBD' \n     ELSE REPLACE(REPLACE(chat, CHR(10), ''), CHR(13), '') \n  END as chat,\n  COUNT(*) as total_negativos\nFROM summary_sentimientos\nWHERE sentimiento = 'NEGATIVE'\n  AND DATE(created_at) = CURRENT_DATE - INTERVAL '1 day'\nGROUP BY chat\nORDER BY total_negativos DESC;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-40,940],"id":"f09c6e62-ec28-4044-90d7-0bbcd8120026","name":"Negativo Dia Anterior","credentials":{"postgres":{"id":"i1HXN1QutN6BIHF9","name":"Postgres_whisper"}}}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Chats Total Mes","type":"main","index":0},{"node":"Chats Total Dia Anterior","type":"main","index":0},{"node":"Sentimientos Mes Actual","type":"main","index":0},{"node":"Sentimientos Dia Anterior","type":"main","index":0},{"node":"Negativo Mes Anterior","type":"main","index":0},{"node":"Negativo Dia Anterior","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"QuickChart","type":"main","index":0}]]},"Aggregate1":{"main":[[{"node":"QuickChart1","type":"main","index":0}]]},"Aggregate2":{"main":[[{"node":"QuickChart2","type":"main","index":0}]]},"Aggregate3":{"main":[[{"node":"QuickChart3","type":"main","index":0}]]},"Chats Total Mes":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Chats Total Dia Anterior":{"main":[[{"node":"Aggregate1","type":"main","index":0}]]},"Sentimientos Mes Actual":{"main":[[{"node":"Aggregate2","type":"main","index":0}]]},"Sentimientos Dia Anterior":{"main":[[{"node":"Aggregate3","type":"main","index":0}]]},"Aggregate4":{"main":[[{"node":"QuickChart4","type":"main","index":0}]]},"Negativo Mes Anterior":{"main":[[{"node":"Aggregate4","type":"main","index":0}]]},"Aggregate5":{"main":[[{"node":"QuickChart5","type":"main","index":0}]]},"Negativo Dia Anterior":{"main":[[{"node":"Aggregate5","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"a7c5c3cc-85c3-4586-a385-1b9aa8088410","triggerCount":0,"tags":[]}