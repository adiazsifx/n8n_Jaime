{"createdAt":"2025-03-29T22:16:59.746Z","updatedAt":"2025-06-24T17:19:59.000Z","id":"f7ohTdbCjtktHKzi","name":"Chat Reporte Diario NVD","active":false,"isArchived":true,"nodes":[{"parameters":{"promptType":"define","text":"={{ $json.concatenated_data }}","options":{"systemMessage":"ERES UN ANALISTA DE CIBERSEGURIDAD. TU FUNCI√ìN ES CREAR UN REPORTE DETALLADO EN FORMATO JSON A PARTIR DE LOS DATOS DE LA NVD (NATIONAL VULNERABILITY DATABASE) NIST.GOV.\n\n---\n\n### TAREA PRINCIPAL:\nDEBES INCLUIR TODAS LAS VULNERABILIDADES QUE APARECEN EN LOS DATOS. NO PUEDE HABER MENOS DE LAS QUE FUERON ENTREGADAS. SI HAY 11, DEBES DEVOLVER 11. **NO PUEDES OMITIR NINGUNA**.\n\n---\n\n### CLASIFICACI√ìN:\n- Si CVSS est√° presente:\n  - Alta: CVSS ‚â• 7.0\n  - Media: entre 4.0 y 6.9\n  - Baja: < 4.0\n- Si CVSS est√° ausente, buscar palabras en la descripci√≥n:\n  - ‚Äúcritical‚Äù, ‚Äúhigh impact‚Äù, ‚Äúremote exploit‚Äù ‚Üí Alta\n  - ‚Äúmoderate‚Äù, ‚Äúmedium impact‚Äù ‚Üí Media\n  - ‚Äúlow impact‚Äù, ‚Äúlimited risk‚Äù ‚Üí Baja\n  - Si no se puede clasificar ‚Üí OMITIR\n\n---\n\n### INSTRUCCIONES OBLIGATORIAS:\n\n1. INCLUIR TODAS las vulnerabilidades clasificadas como **Alta o Media**\n2. DE LAS BAJAS, incluir **m√°ximo 3** con mayor severidad (CVSS m√°s alto)\n3. NO OMITIR NINGUNA vulnerabilidad de criticidad Alta o Media. NUNCA.\n4. SI CVSS falta, colocar `\"cvss\": \"Sin Datos\"` y clasificar por texto\n5. CADA vulnerabilidad debe estar separada en su propio bloque JSON\n6. DEVOLVER SOLO UN JSON LIMPIO (SIN COMENTARIOS, SIN BLOQUES DE C√ìDIGO, SIN TEXTOS EXTERNOS)\n7. NO DEVUELVAS UN ‚ÄúEJEMPLO‚Äù NI MUESTRA PARCIAL. **ESTE ES EL REPORTE COMPLETO.**\n\n---\n\n### FORMATO JSON (NO CAMBIAR)\n\n{\n  \"metadata\": {\n    \"title\": \"\",\n    \"fecha\": \"\",\n    \"fuente\": \"NVD ( NATIONAL VULNERABILITY DATABASE) NIST.GOV.\"\n  },\n  \"vulnerabilidades\": [\n    {\n      \"criticidad\": \"Alta\",\n      \"cve\": \"CVE-XXXX-XXXX\",\n      \"fecha_reporte\": \"2025-03-21\",\n      \"fabricante\": \"EjemploCorp\",\n      \"producto\": \"EjemploOS 3.0\",\n      \"cvss\": \"TBD\",\n      \"descripcion\": \"Ejemplo de vulnerabilidad grave\",\n      \"acciones_recomendadas\": [\n        \"Aplicar parche oficial\",\n        \"Bloquear acceso remoto al servicio afectado\"\n      ],\n      \"referencias\": [\n        \"https://nvd.nist.gov/vuln/detail/CVE-XXXX-XXXX\"\n      ]\n    }\n    // M√ÅS BLOQUES SEG√öN TODAS LAS VULNERABILIDADES DISPONIBLES\n  ],\n  \"pautas_generales\": [\n    \"Mantener sistemas actualizados\",\n    \"Realizar escaneos de vulnerabilidades mensualmente\"\n  ],\n  \"estadisticas\": {\n    \"total_vulnerabilidades\": 11,\n    \"vulnerabilidades_altas\": 4,\n    \"vulnerabilidades_medias\": 4,\n    \"vulnerabilidades_bajas\": 3,\n    \"promedio_cvss\": 6.3\n  }\n}\n\n---\n\n### NO HACER:\n\n- ‚ùå NO ENTREGAR SOLO UNA PARTE DE LOS DATOS\n- ‚ùå NO ENTREGAR EJEMPLOS EN LUGAR DEL REPORTE COMPLETO\n- ‚ùå NO OMITIR VULNERABILIDADES ALTA O MEDIA POR NINGUNA RAZ√ìN\n- ‚ùå NO INCLUIR M√ÅS DE 3 VULNERABILIDADES DE CRITICIDAD BAJA\n- ‚ùå NO REDUCIR O RESUMIR TEXTO DE VULNERABILIDADES\n- ‚ùå NO DEVOLVER TEXTO EXTRA NI BLOQUES DE C√ìDIGO\n- ‚ùå NO DEJAR CAMPOS VAC√çOS: SI NO HAY CVSS, USA `\"Pendiente\"`\nERES UN ANALISTA DE CIBERSEGURIDAD. TU FUNCI√ìN ES CREAR UN REPORTE DETALLADO EN FORMATO JSON A PARTIR DE LOS DATOS DE LA NVD ( NATIONAL VULNERABILITY DATABASE) NIST.GOV.\n\n---\n\n### TAREA PRINCIPAL:\nDEBES INCLUIR TODAS LAS VULNERABILIDADES QUE APARECEN EN LOS DATOS. NO PUEDE HABER MENOS DE LAS QUE FUERON ENTREGADAS. SI HAY 11, DEBES DEVOLVER 11. **NO PUEDES OMITIR NINGUNA**.\n\n---\n\n### CLASIFICACI√ìN:\n- Si CVSS est√° presente:\n  - Alta: CVSS ‚â• 7.0\n  - Media: entre 4.0 y 6.9\n  - Baja: < 4.0\n- Si CVSS est√° ausente, buscar palabras en la descripci√≥n:\n  - ‚Äúcritical‚Äù, ‚Äúhigh impact‚Äù, ‚Äúremote exploit‚Äù ‚Üí Alta\n  - ‚Äúmoderate‚Äù, ‚Äúmedium impact‚Äù ‚Üí Media\n  - ‚Äúlow impact‚Äù, ‚Äúlimited risk‚Äù ‚Üí Baja\n  - Si no se puede clasificar ‚Üí OMITIR\n\n---\n\n### INSTRUCCIONES OBLIGATORIAS:\n\n1. INCLUIR TODAS las vulnerabilidades clasificadas como **Alta o Media**\n2. DE LAS BAJAS, incluir **m√°ximo 3** con mayor severidad (CVSS m√°s alto)\n3. NO OMITIR NINGUNA vulnerabilidad de criticidad Alta o Media. NUNCA.\n4. SI CVSS falta, colocar `\"cvss\": \"Pendiente\"` y clasificar por texto\n5. CADA vulnerabilidad debe estar separada en su propio bloque JSON\n6. DEVOLVER SOLO UN JSON LIMPIO (SIN COMENTARIOS, SIN BLOQUES DE C√ìDIGO, SIN TEXTOS EXTERNOS)\n7. NO DEVUELVAS UN ‚ÄúEJEMPLO‚Äù NI MUESTRA PARCIAL. **ESTE ES EL REPORTE COMPLETO.**\n\n---\n\n### FORMATO JSON (NO CAMBIAR)\n\n{\n  \"metadata\": {\n    \"title\": \"\",\n    \"fecha\": \"\",\n    \"fuente\": \"NVD ( NATIONAL VULNERABILITY DATABASE) NIST.GOV.\"\n  },\n  \"vulnerabilidades\": [\n    {\n      \"criticidad\": \"Alta\",\n      \"cve\": \"CVE-XXXX-XXXX\",\n      \"fecha_reporte\": \"2025-03-21\",\n      \"fabricante\": \"EjemploCorp\",\n      \"producto\": \"EjemploOS 3.0\",\n      \"cvss\": \"TBD\",\n      \"descripcion\": \"Ejemplo de vulnerabilidad grave\",\n      \"acciones_recomendadas\": [\n        \"Aplicar parche oficial\",\n        \"Bloquear acceso remoto al servicio afectado\"\n      ],\n      \"referencias\": [\n        \"https://nvd.nist.gov/vuln/detail/CVE-XXXX-XXXX\"\n      ]\n    }\n    // M√ÅS BLOQUES SEG√öN TODAS LAS VULNERABILIDADES DISPONIBLES\n  ],\n  \"pautas_generales\": [\n    \"Mantener sistemas actualizados\",\n    \"Realizar escaneos de vulnerabilidades mensualmente\"\n  ],\n  \"estadisticas\": {\n    \"total_vulnerabilidades\": 11,\n    \"vulnerabilidades_altas\": 4,\n    \"vulnerabilidades_medias\": 4,\n    \"vulnerabilidades_bajas\": 3,\n    \"promedio_cvss\": 6.3\n  }\n}\n\n---\n\n### NO HACER:\n\n- ‚ùå NO ENTREGAR SOLO UNA PARTE DE LOS DATOS\n- ‚ùå NO ENTREGAR EJEMPLOS EN LUGAR DEL REPORTE COMPLETO\n- ‚ùå NO OMITIR VULNERABILIDADES ALTA O MEDIA POR NINGUNA RAZ√ìN\n- ‚ùå NO INCLUIR M√ÅS DE 3 VULNERABILIDADES DE CRITICIDAD BAJA\n- ‚ùå NO REDUCIR O RESUMIR TEXTO DE VULNERABILIDADES\n- ‚ùå NO DEVOLVER TEXTO EXTRA NI BLOQUES DE C√ìDIGO\n- ‚ùå NO DEJAR CAMPOS VAC√çOS: SI NO HAY CVSS, USA `\"Sin Datos\"`\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[1620,60],"id":"b3f2975f-20f0-492a-a56b-06fdb95ef52b","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"openai-mini","mode":"list","cachedResultName":"openai-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1580,260],"id":"95b2994d-f55e-419b-9d30-eef8f611654a","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"3ksygUY2AafRzzfk","name":"Proxy LiteLLM"}}},{"parameters":{"public":true,"initialMessages":"Hi there! üëã\nNVD Report","options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-720,-20],"id":"6a6e98fd-4e8a-4bf7-997a-91fb044eaf4b","name":"When chat message received","webhookId":"6b6e9d32-015b-4433-b5a1-a36b7c14a6f7"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=VMware&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-100,-720],"id":"f1b7b8a7-2342-4510-8401-a111f8b046e2","name":"Vmware"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Sophos&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-100,-580],"id":"6b1c2c21-3572-4d2b-8552-b48006a988ff","name":"Sophos"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=HPE&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-100,-440],"id":"9f472855-d7ee-40b3-bc6f-ea7ffece5eca","name":"HPE"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Veeam&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-100,-300],"id":"6d1c58b0-f477-4a8d-867f-2e2e3b18f323","name":"Veeam"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Fortinet&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-100,-160],"id":"654682aa-c9c5-409a-a64e-420c94773cfe","name":"Fortinet"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Cisco&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-100,-20],"id":"22a45ef1-0522-4fdd-8b87-87884d456d4c","name":"Cisco"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Ansible&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-100,120],"id":"965f27d9-e1c3-452c-864b-e93ec3aa8f45","name":"Ansible"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Kubernetes&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-100,260],"id":"2a6f413e-742d-45c7-a023-19cf6a8b1279","name":"Kubernetes"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=SolarWinds&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-100,400],"id":"18b4014d-228c-40a0-995a-0af20ff69f71","name":"SolarWinds"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Acronis&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-100,540],"id":"f7472e5a-280a-424a-aea4-ecdd96d763cf","name":"Acronis"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Juniper&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[360,-720],"id":"f4614f43-e898-4bc4-b3dc-87f4a28884d4","name":"Juniper"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Huawei&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[360,-580],"id":"4b59c01a-ce14-4b05-8304-e227db2a0990","name":"Huawei"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Chrome&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[360,-440],"id":"77362f2d-d060-4d91-aec4-4596cefb56f0","name":"Chrome"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Edge&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[360,-300],"id":"88e06eef-5fd8-4206-a9f9-4b777a6b1e84","name":"Edge"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Outlook&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[360,-160],"id":"f56a8fe1-84a8-40f8-a4e6-8bc9d1994346","name":"Outlook"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Dell&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[360,-20],"id":"10b08484-4e1c-4b81-a4d9-7bb0216c202b","name":"Dell"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=IBM&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[360,120],"id":"ff2c5a36-cebc-4046-b3ec-31f80510a27d","name":"IBM"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Hitachi&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[360,260],"id":"6eab257c-1a67-4653-bee8-9d08ad0fa0ea","name":"Hitachi"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Pure&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[360,400],"id":"fd31d306-9ccb-476e-97fc-61bd415962dc","name":"Pure"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Broadcom&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[360,540],"id":"37c40fba-c51d-432d-a44a-bb1ee081f592","name":"Broadcom"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Mikrotik&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-100,680],"id":"a6ce66bb-4580-4dc0-b0eb-ad4281cf1b4d","name":"Mikrotik"},{"parameters":{"numberInputs":10},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[880,-440],"id":"f229920d-e642-4e79-9f43-4f5b76929d9c","name":"Grupo 1"},{"parameters":{"numberInputs":9},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[880,60],"id":"9ca18743-8422-4de8-aa03-5e6213f1b7a7","name":"Grupo 2"},{"parameters":{"numberInputs":3},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[880,500],"id":"9f7a52dc-cc22-44b0-bb0c-4b1fc85d649b","name":"Grupo 3"},{"parameters":{"numberInputs":3},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[1140,60],"id":"767b04a1-15a7-4354-bd85-a8b19466d2d6","name":"Merge"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[80,-720],"id":"35dee3e0-6329-4146-a1b2-01bd58a6c584","name":"If"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[80,-580],"id":"cc109b06-1dcf-4bfb-8a3b-d3f886adb9a3","name":"If1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[80,-440],"id":"dfd52789-71dd-4dd4-a1b6-c0c028d6c680","name":"If2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[80,-300],"id":"3f69a791-4285-424f-94d4-d2f44becec19","name":"If3"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[80,-160],"id":"3eb48421-a5c7-47bf-984a-ffa1b100a622","name":"If4"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[80,-20],"id":"6175b79d-d110-4f8a-a194-d6efb3ff0e25","name":"If5"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[80,120],"id":"6f4f0820-707d-4399-b819-2e0828b20701","name":"If6"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[80,260],"id":"50a56f2f-6406-4091-8cb9-3c8461d8bad1","name":"If7"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[80,400],"id":"7134d9c3-d528-4019-86ff-8dc679a70b4d","name":"If8"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[80,540],"id":"f93089dc-cd49-430b-8b42-a9dead91dfec","name":"If9"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[80,680],"id":"64e4b452-3682-407a-b24e-a87f950940b8","name":"If10"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,-720],"id":"bc3b3d5c-66f7-40a2-a3c6-f2f4776fd7f8","name":"If11"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,-580],"id":"00e5ffed-cb51-4818-b34c-e8903dc0f473","name":"If12"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,-440],"id":"6647b5d7-36b8-4cfc-87d8-308f995b7c8d","name":"If13"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,-300],"id":"0d5f2fc4-63fb-4621-a6ef-372984e92fd0","name":"If14"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,-160],"id":"6211e8f7-0d1a-40a8-99b9-ab1f78b19649","name":"If15"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,-20],"id":"0f1b506a-419a-4b82-b255-ba7e3492dd76","name":"If16"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,120],"id":"700d3485-7c9d-464e-81ff-d34605a933ab","name":"If17"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,260],"id":"ead9572c-2068-4c64-9286-c8dba4ed187a","name":"If18"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,400],"id":"fd859bde-0ccd-4286-bd15-4c4445ff2a8d","name":"If19"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,540],"id":"c9a6b377-6a5b-4e87-8d5b-3d9491fae6c2","name":"If20"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1300,60],"id":"26862759-c795-41f0-9800-fb98408f5c31","name":"Aggregate"},{"parameters":{"sendTo":"jaimeperezgonzalez@gmail.com","subject":"Boletin de Ciberseguridad - NVD NIST.ORG","message":"={{ $json.htmlEmail }}","options":{"appendAttribution":false,"bccList":"jaimep@ifxcorp.com, avargasl@ifxcorp.com"}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[2120,660],"id":"710120ee-3522-4aeb-bfb9-5efc8fd7b59e","name":"Gmail","webhookId":"52a035bd-c468-4423-a00e-98693851fc68","credentials":{"gmailOAuth2":{"id":"hnyUjIRS74ZNMIfB","name":"Gmail API FutureBit"}}},{"parameters":{"jsCode":"const now = new Date();\nconst endDate = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), 23, 59, 59));\nconst startDate = new Date(endDate);\nstartDate.setUTCDate(startDate.getUTCDate() - 7); // resta 7 d√≠as (una semana)\nstartDate.setUTCHours(0, 0, 0, 0); // establece al inicio del d√≠a\n\nconst formatISO8601 = (date) => date.toISOString().replace(/\\.\\d{3}Z$/, '.000Z');\n\nreturn {\n  startDate: formatISO8601(startDate),\n  endDate: formatISO8601(endDate)\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-960,220],"id":"7d766403-f293-4568-8ea2-859661d51df8","name":"Semanal"},{"parameters":{"jsCode":"const now = new Date();\nnow.setUTCDate(now.getUTCDate() - 1); // resta 1 d√≠a\nconst startOfDay = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), 0, 0, 0));\nconst endOfDay = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), 23, 59, 59));\nconst formatISO8601 = (date) => date.toISOString().replace(/\\.\\d{3}Z$/, '.000Z');\nreturn {\n  startDate: formatISO8601(startOfDay),\n  endDate: formatISO8601(endOfDay)\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-720,220],"id":"1778a725-1790-445d-b717-dd895ff2c0a8","name":"Diario"},{"parameters":{"fieldsToSummarize":{"values":[{"aggregation":"concatenate","field":"data","includeEmpty":true,"separateBy":", "}]},"options":{}},"type":"n8n-nodes-base.summarize","typeVersion":1.1,"position":[1460,60],"id":"abb57381-efe9-4448-97ec-0904468b8157","name":"Summarize"},{"parameters":{"jsCode":"const now = new Date();\nnow.setUTCDate(now.getUTCDate() - 1); // resta 1 d√≠a\nconst startOfDay = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), 0, 0, 0));\nconst endOfDay = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), 23, 59, 59));\nconst formatISO8601 = (date) => date.toISOString().replace(/\\.\\d{3}Z$/, '.000Z');\nreturn {\n  startDate: formatISO8601(startOfDay),\n  endDate: formatISO8601(endOfDay)\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-460,-20],"id":"e99717f2-ef38-4edc-92d1-f7e030889af8","name":"Format Date"},{"parameters":{"jsCode":"// Funci√≥n para formatear el per√≠odo de fechas\nfunction formatearPeriodo(startDate, endDate) {\n  if (!startDate || !endDate) return \"\";\n  \n  const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];\n  \n  const inicio = new Date(startDate);\n  const fin = new Date(endDate);\n  \n  // Si son el mismo d√≠a\n  if (inicio.toDateString() === fin.toDateString()) {\n    return `${inicio.getDate()} de ${meses[inicio.getMonth()]} de ${inicio.getFullYear()}`;\n  } else {\n    return `${inicio.getDate()} de ${meses[inicio.getMonth()]} al ${fin.getDate()} de ${meses[fin.getMonth()]} de ${fin.getFullYear()}`;\n  }\n}\n\n// Versi√≥n con header con degradado azul a magenta e informaci√≥n del periodo\n\nfunction createEmailSafeHeader(date, startDate, endDate) {\n  const periodText = formatearPeriodo(startDate, endDate);\n  const periodInfo = periodText ? `<p style=\"color: #ffffff; font-size: 14px; margin: 5px 0 0 0; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);\">Periodo de Consulta: ${periodText}</p>` : '';\n  \n  \n// Usar una imagen de fondo o celdas con colores s√≥lidos en lugar de gradiente\n  // Usar la imagen como fondo con VML para Outlook\n  return `\n  <!--[if gte mso 9]>\n  <v:rect xmlns:v=\"urn:schemas-microsoft-com:vml\" fill=\"true\" stroke=\"false\" style=\"width:800px;height:150px;\">\n    <v:fill type=\"frame\" src=\"https://media.licdn.com/dms/image/v2/D4E3DAQFqcEmbz29Nmw/image-scale_191_1128/image-scale_191_1128/0/1695664141867/ifx_networks_cover?e=2147483647&v=beta&t=JVG-v8jzdy-D85rsPWHrfn_rzAnV9459-s6uzEw-bPM\" color=\"#1a237e\" />\n    <v:textbox style=\"mso-fit-shape-to-text:true\" inset=\"0,0,0,0\">\n  <![endif]-->\n  <table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" background=\"https://media.licdn.com/dms/image/v2/D4E3DAQFqcEmbz29Nmw/image-scale_191_1128/image-scale_191_1128/0/1695664141867/ifx_networks_cover?e=2147483647&v=beta&t=JVG-v8jzdy-D85rsPWHrfn_rzAnV9459-s6uzEw-bPM\" style=\"background-image: url('https://media.licdn.com/dms/image/v2/D4E3DAQFqcEmbz29Nmw/image-scale_191_1128/image-scale_191_1128/0/1695664141867/ifx_networks_cover?e=2147483647&v=beta&t=JVG-v8jzdy-D85rsPWHrfn_rzAnV9459-s6uzEw-bPM'); background-size: cover; background-position: right center; margin-bottom: 20px;\">\n    <tr>\n      <td align=\"left\" valign=\"middle\" width=\"120\" style=\"padding: 15px;\">\n        <img src=\"https://github.com/ifxnetworks/Ansible/blob/main/Imagen3.png?raw=true\" alt=\"Logo\" style=\"width: 110px; height: auto;\">\n      </td>\n      <td align=\"left\" valign=\"middle\" style=\"padding: 15px;\">\n        <h1 style=\"color: #ffffff; font-size: 24px; margin: 0; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);\">BOLET√çN DE CIBERSEGURIDAD</h1>\n        <p style=\"color: #ffffff; font-size: 16px; margin: 5px 0 0 0; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);\">${date}</p>\n        ${periodInfo}\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\" align=\"right\" style=\"padding-right: 15px; padding-bottom: 5px;\">\n        <p style=\"color: #ffffff; font-size: 11px; margin: 0;\">Generated by <i style=\"font-style: italic;\">aifx</i></p>\n      </td>\n    </tr>\n  </table>\n  <!--[if gte mso 9]>\n    </v:textbox>\n  </v:rect>\n  <![endif]-->`\n}\n\n// Funciones auxiliares\nfunction renderStats(vulnerabilidadesPorCriticidad) {\n  const contadores = {\n    'ALTA': vulnerabilidadesPorCriticidad['ALTA'].length,\n    'MEDIA': vulnerabilidadesPorCriticidad['MEDIA'].length,\n    'BAJA': vulnerabilidadesPorCriticidad['BAJA'].length\n  };\n  \n  const totalVulnerabilidades = contadores.ALTA + contadores.MEDIA + contadores.BAJA;\n  \n  return `\n  <table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n    <tr>\n      <td style=\"padding: 5px;\">\n        <table width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"5\" style=\"background-color: #f8f9fa; border-radius: 5px;\">\n          <tr>\n            <td align=\"center\" valign=\"top\" style=\"width: 25%;\">\n              <div style=\"font-size: 24px; font-weight: bold; color: #dc3545; margin-bottom: 5px;\">${contadores.ALTA}</div>\n              <div style=\"font-size: 12px; color: #666;\">Vulnerabilidades de Alta Criticidad</div>\n            </td>\n            <td align=\"center\" valign=\"top\" style=\"width: 25%;\">\n              <div style=\"font-size: 24px; font-weight: bold; color: #ff9933; margin-bottom: 5px;\">${contadores.MEDIA}</div>\n              <div style=\"font-size: 12px; color: #666;\">Vulnerabilidades de Media Criticidad</div>\n            </td>\n            <td align=\"center\" valign=\"top\" style=\"width: 25%;\">\n              <div style=\"font-size: 24px; font-weight: bold; color: #28a745; margin-bottom: 5px;\">${contadores.BAJA}</div>\n              <div style=\"font-size: 12px; color: #666;\">Vulnerabilidades de Baja Criticidad</div>\n            </td>\n            <td align=\"center\" valign=\"top\" style=\"width: 25%;\">\n              <div style=\"font-size: 24px; font-weight: bold; color: #2c67b2; margin-bottom: 5px;\">${totalVulnerabilidades}</div>\n              <div style=\"font-size: 12px; color: #666;\">Total de Vulnerabilidades</div>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>`;\n}\n\nfunction generarHTMLVulnerabilidad(vuln) {\n  let cvssColor;\n  let cvssBackColor;\n  let cvssValue;\n  \n  // Manejar el caso especial de CVSS \"TBD\"\n  if (vuln.cvss === \"TBD\" || vuln.cvss === null || vuln.cvss === undefined) {\n    cvssColor = '#ff9933'; // Naranja\n    cvssBackColor = '#fff5e6';\n    cvssValue = \"Pendiente\";\n  } else {\n    // Manejar valores num√©ricos normales\n    if (vuln.cvss >= 7) {\n      cvssColor = '#dc3545';\n      cvssBackColor = '#ffeaea';\n    } else if (vuln.cvss >= 4) {\n      cvssColor = '#ff9933';\n      cvssBackColor = '#fff5e6';\n    } else {\n      cvssColor = '#28a745';\n      cvssBackColor = '#e6f5e6';\n    }\n    cvssValue = vuln.cvss;\n  }\n  \n  // Generar HTML para acciones recomendadas\n  let accionesHTML = '';\n  if (vuln.acciones_recomendadas && vuln.acciones_recomendadas.length > 0) {\n    accionesHTML = vuln.acciones_recomendadas.map(accion => \n      `<li style=\"margin-bottom: 5px;\">${accion}</li>`\n    ).join('');\n  }\n  \n  // Generar HTML para referencias\n  let referenciasHTML = '';\n  if (vuln.referencias && vuln.referencias.length > 0) {\n    referenciasHTML = vuln.referencias.map(ref => \n      `<a href=\"${ref}\" style=\"color: #2c67b2; font-size: 13px; word-break: break-all; display: block; margin-bottom: 5px;\">${ref}</a>`\n    ).join('');\n  }\n  \n  return `\n  <table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin-bottom: 20px; border: 1px solid #eaeaea; border-radius: 5px;\">\n    <tr>\n      <td style=\"padding: 15px 20px;\">\n        <table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n          <tr>\n            <td>\n              <div style=\"font-weight: bold; font-size: 18px; color: #2c67b2; margin-bottom: 8px;\">${vuln.fabricante || 'Fabricante no especificado'}</div>\n              <div style=\"font-size: 14px; color: #666; margin-top: 5px;\">\n                <span><strong>CVE:</strong> ${vuln.cve}</span><br>\n                <span><strong>Fecha del Reporte:</strong> ${vuln.fecha_reporte}</span><br>\n                <span><strong>Producto Afectado:</strong> ${vuln.producto}</span><br>\n                <span style=\"display: inline-block; padding: 3px 8px; border-radius: 3px; font-weight: bold; font-size: 12px; margin-top: 5px; background-color: ${cvssBackColor}; color: ${cvssColor};\">CVSS: ${cvssValue}</span>\n              </div>\n            </td>\n          </tr>\n          <tr>\n            <td style=\"padding-top: 15px;\">\n              <table width=\"100%\" border=\"0\" cellpadding=\"12\" cellspacing=\"0\" style=\"background-color: #f8f9fa; border-radius: 5px; margin: 10px 0;\">\n                <tr>\n                  <td>\n                    <div style=\"font-weight: bold; margin-bottom: 5px; color: #555;\">Descripci√≥n T√©cnica</div>\n                    <p>${vuln.descripcion}</p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n          <tr>\n            <td style=\"padding-top: 15px;\">\n              <div style=\"font-weight: bold; margin-bottom: 5px; color: #555;\">Acciones Recomendadas</div>\n              <ul style=\"padding-left: 25px; margin-bottom: 15px;\">\n                ${accionesHTML}\n              </ul>\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <div style=\"font-weight: bold; margin-bottom: 5px; color: #555;\">Referencias</div>\n              ${referenciasHTML}\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>`;\n}\n\n// C√≥digo principal para n8n\nconst items = $input.all();\nconst returnItems = [];\n\nfor (const item of items) {\n  try {\n    // Obtener el per√≠odo desde los par√°metros de entrada (si existen)\n    // Usar item.json directamente, sin confiar en nombres de nodos anteriores\n    const startDate = item.json.startDate || null;\n    const endDate = item.json.endDate || null;\n    \n    console.log(\"Per√≠odo recibido:\", { startDate, endDate });\n    \n    // Extraer y parsear los datos JSON\n    let securityData;\n    \n    if (typeof item.json.output === 'string' && item.json.output.trim().startsWith('{')) {\n      try {\n        securityData = JSON.parse(item.json.output);\n      } catch (e) {\n        console.log('Error al parsear JSON:', e);\n        throw new Error(`No se pudo parsear el JSON: ${e.message}`);\n      }\n    } else {\n      throw new Error('No se encontr√≥ un JSON v√°lido en el campo output');\n    }\n    \n    // Validar la estructura\n    if (!securityData || !securityData.vulnerabilidades || !Array.isArray(securityData.vulnerabilidades)) {\n      throw new Error('Formato JSON inv√°lido: se requiere un array de vulnerabilidades');\n    }\n    \n    // Normalizar criticidad a may√∫sculas\n    securityData.vulnerabilidades.forEach(vuln => {\n      if (vuln.criticidad) {\n        vuln.criticidad = vuln.criticidad.toUpperCase();\n      }\n    });\n    \n    // Clasificar vulnerabilidades por criticidad\n    const vulnerabilidadesPorCriticidad = {\n      'ALTA': [],\n      'MEDIA': [],\n      'BAJA': []\n    };\n\n    // Procesar cada vulnerabilidad \n    securityData.vulnerabilidades.forEach(vuln => {\n      // Convertir a may√∫sculas y normalizar\n      const criticidad = String(vuln.criticidad || '').toUpperCase();\n      \n      // A√±adir a la categor√≠a apropiada si existe\n      if (criticidad === 'ALTA') {\n        vulnerabilidadesPorCriticidad.ALTA.push(vuln);\n      } else if (criticidad === 'MEDIA') {\n        vulnerabilidadesPorCriticidad.MEDIA.push(vuln);\n      } else if (criticidad === 'BAJA') {\n        vulnerabilidadesPorCriticidad.BAJA.push(vuln);\n      }\n    });\n    \n    // Formatear fecha actual\n    const ahora = new Date();\n    const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];\n    const fechaFormateada = `${meses[ahora.getMonth()]} ${ahora.getDate()} de ${ahora.getFullYear()}`;\n    \n    // Total de vulnerabilidades\n    const totalVulnerabilidades = securityData.vulnerabilidades.length;\n    \n    // Construir el HTML - usando tablas para compatibilidad con correo\n    let html = `<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Bolet√≠n de Alertas de Ciberseguridad</title>\n</head>\n<body style=\"margin: 0; padding: 0; background-color: #f8f9fa; color: #333; font-family: Arial, sans-serif; line-height: 1.6;\">\n    <div style=\"max-width: 800px; margin: 0 auto; background-color: #ffffff; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\">\n        <!-- Cabecera con gradiente y per√≠odo -->\n        ${createEmailSafeHeader(fechaFormateada, startDate, endDate)}\n        \n        <!-- Contenido -->\n        <div style=\"padding: 30px;\">\n            <div style=\"background-color: #f1f5f9; border-left: 4px solid #2c67b2; padding: 12px 20px; margin-bottom: 25px; font-size: 14px;\">\n                <strong>FUENTE DEL REPORTE:</strong> ${securityData.metadata.fuente || 'Fuente no disponible'}\n            </div>\n            \n            <!-- Estad√≠sticas -->\n            ${renderStats(vulnerabilidadesPorCriticidad)}`;\n\n    // Si no hay vulnerabilidades, mostrar mensaje especial\n    if (totalVulnerabilidades === 0) {\n      html += `\n            <div style=\"background-color: #f8f9fa; padding: 30px; margin-bottom: 30px; text-align: center; border-radius: 5px; font-size: 18px;\">\n                <strong>¬°Buenas noticias!</strong><br>No se han detectado vulnerabilidades en el per√≠odo actual.\n            </div>`;\n    } else {\n      // Secci√≥n de Alta Criticidad\n      html += `\n            <div style=\"margin-bottom: 30px;\">\n                <div style=\"display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px solid #dee2e6;\">\n                    <div style=\"width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; background-color: #dc3545; display: inline-block;\"></div>\n                    <h2 style=\"font-size: 18px; font-weight: bold; margin: 0;\">CRITICIDAD ALTA</h2>\n                </div>`;\n      \n      if (vulnerabilidadesPorCriticidad['ALTA'].length === 0) {\n        html += `\n                <div style=\"background-color: #f8f9fa; padding: 15px; text-align: center; border-radius: 5px; margin-bottom: 20px; color: #666; font-style: italic;\">\n                    No se han detectado vulnerabilidades de este nivel de criticidad en el per√≠odo actual.\n                </div>`;\n      } else {\n        vulnerabilidadesPorCriticidad['ALTA'].forEach(vuln => {\n          html += generarHTMLVulnerabilidad(vuln);\n        });\n      }\n      \n      html += `\n            </div>`;\n      \n      // Secci√≥n de Media Criticidad\n      html += `\n            <div style=\"margin-bottom: 30px;\">\n                <div style=\"display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px solid #dee2e6;\">\n                    <div style=\"width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; background-color: #ff9933; display: inline-block;\"></div>\n                    <h2 style=\"font-size: 18px; font-weight: bold; margin: 0;\">CRITICIDAD MEDIA</h2>\n                </div>`;\n      \n      if (vulnerabilidadesPorCriticidad['MEDIA'].length === 0) {\n        html += `\n                <div style=\"background-color: #f8f9fa; padding: 15px; text-align: center; border-radius: 5px; margin-bottom: 20px; color: #666; font-style: italic;\">\n                    No se han detectado vulnerabilidades de este nivel de criticidad en el per√≠odo actual.\n                </div>`;\n      } else {\n        vulnerabilidadesPorCriticidad['MEDIA'].forEach(vuln => {\n          html += generarHTMLVulnerabilidad(vuln);\n        });\n      }\n      \n      html += `\n            </div>`;\n      \n      // Secci√≥n de Baja Criticidad\n      html += `\n            <div style=\"margin-bottom: 30px;\">\n                <div style=\"display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px solid #dee2e6;\">\n                    <div style=\"width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; background-color: #28a745; display: inline-block;\"></div>\n                    <h2 style=\"font-size: 18px; font-weight: bold; margin: 0;\">CRITICIDAD BAJA</h2>\n                </div>`;\n      \n      if (vulnerabilidadesPorCriticidad['BAJA'].length === 0) {\n        html += `\n                <div style=\"background-color: #f8f9fa; padding: 15px; text-align: center; border-radius: 5px; margin-bottom: 20px; color: #666; font-style: italic;\">\n                    No se han detectado vulnerabilidades de este nivel de criticidad en el per√≠odo actual.\n                </div>`;\n      } else {\n        vulnerabilidadesPorCriticidad['BAJA'].forEach(vuln => {\n          html += generarHTMLVulnerabilidad(vuln);\n        });\n      }\n      \n      html += `\n            </div>`;\n    }\n    \n    // Secci√≥n de Pautas Generales\n    html += `\n            <div style=\"background-color: #f1f5f9; border-radius: 5px; padding: 20px; margin-top: 30px;\">\n                <h3 style=\"font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #1a2e4a;\">PAUTAS DE ACCI√ìN GENERALES</h3>\n                <ol style=\"padding-left: 25px;\">`;\n    \n    if (securityData.pautas_generales && securityData.pautas_generales.length > 0) {\n      securityData.pautas_generales.forEach(pauta => {\n        html += `\n                    <li style=\"margin-bottom: 10px;\">${pauta}</li>`;\n      });\n    } else {\n      html += `\n                    <li style=\"margin-bottom: 10px;\">No hay pautas generales disponibles.</li>`;\n    }\n    \n    html += `\n                </ol>\n            </div>\n        </div>\n        \n        <div style=\"text-align: center; margin-top: 30px;\">\n            <img src=\"https://github.com/ifxnetworks/Ansible/blob/main/Imagen1nnlnl.jpg?raw=true\" alt=\"Pie de p√°gina\" style=\"max-width: 100%; height: auto;\">\n        </div>\n    </div>\n</body>\n</html>`;\n\n    // Incluir los datos JSON en un campo oculto del HTML\n    const jsonScriptTag = `<script id=\"security-data\" type=\"application/json\" style=\"display:none;\">${JSON.stringify(securityData)}</script>`;\n    html = html.replace('</body>', `${jsonScriptTag}</body>`);\n\n    // Devolver un √∫nico output\n    returnItems.push({\n      json: {\n        htmlEmail: html\n      }\n    });\n  } catch (error) {\n    console.log('Error:', error);\n    const errorMessage = error instanceof Error \n      ? error.message \n      : 'Error desconocido';\n    returnItems.push({\n      json: {\n        error: `Error al procesar los datos: ${errorMessage}`\n      }\n    });\n  }\n}\n\nreturn returnItems;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1980,60],"id":"041717fe-121f-4cc1-8427-93f9d4007d20","name":"HTML Create"},{"parameters":{"toRecipients":"avargasl@ifxcorp.com","subject":"Boletin de Vulnerabilidades - NVD NIST.GOV","bodyContent":"={{ $json.htmlEmail }}","additionalFields":{"bodyContentType":"html"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[2200,60],"id":"f88cd35a-9b3a-491d-a7a8-50ebdf5df7ce","name":"Microsoft Outlook","webhookId":"8d78c886-c815-4b16-af7e-fc137fe9fcfa","credentials":{"microsoftOutlookOAuth2Api":{"id":"WVU9558r90tkJoj9","name":"Outlook Mail JPG"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe5da3ed-b4de-43af-b4d8-0ebcfef32998","leftValue":"={{ $json.totalResults }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,680],"id":"a687c15e-fcec-4381-9d61-1c2acc5d63d0","name":"If21"},{"parameters":{"url":"=https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=Ubiquiti&pubStartDate={{ $json.startDate }}&pubEndDate={{ $json.endDate }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apiKey","value":"29cd63d6-3f9e-4350-ad58-cc6846cc092b"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[360,680],"id":"37e698cc-a318-49b6-9083-4cdd3950bb83","name":"Ubiquiti"}],"connections":{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[{"node":"Format Date","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"HTML Create","type":"main","index":0}]]},"Cisco":{"main":[[{"node":"If5","type":"main","index":0}]]},"Vmware":{"main":[[{"node":"If","type":"main","index":0}]]},"Sophos":{"main":[[{"node":"If1","type":"main","index":0}]]},"HPE":{"main":[[{"node":"If2","type":"main","index":0}]]},"Veeam":{"main":[[{"node":"If3","type":"main","index":0}]]},"Fortinet":{"main":[[{"node":"If4","type":"main","index":0}]]},"Ansible":{"main":[[{"node":"If6","type":"main","index":0}]]},"Kubernetes":{"main":[[{"node":"If7","type":"main","index":0}]]},"SolarWinds":{"main":[[{"node":"If8","type":"main","index":0}]]},"Acronis":{"main":[[{"node":"If9","type":"main","index":0}]]},"Juniper":{"main":[[{"node":"If11","type":"main","index":0}]]},"Huawei":{"main":[[{"node":"If12","type":"main","index":0}]]},"Chrome":{"main":[[{"node":"If13","type":"main","index":0}]]},"Edge":{"main":[[{"node":"If14","type":"main","index":0}]]},"Outlook":{"main":[[{"node":"If15","type":"main","index":0}]]},"Dell":{"main":[[{"node":"If16","type":"main","index":0}]]},"IBM":{"main":[[{"node":"If17","type":"main","index":0}]]},"Hitachi":{"main":[[{"node":"If18","type":"main","index":0}]]},"Pure":{"main":[[{"node":"If19","type":"main","index":0}]]},"Broadcom":{"main":[[{"node":"If20","type":"main","index":0}]]},"Mikrotik":{"main":[[{"node":"If10","type":"main","index":0}]]},"Grupo 1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Grupo 2":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Grupo 3":{"main":[[{"node":"Merge","type":"main","index":2}]]},"Merge":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"If":{"main":[[],[{"node":"Grupo 1","type":"main","index":0}]]},"If1":{"main":[[],[{"node":"Grupo 1","type":"main","index":2}]]},"If2":{"main":[[],[{"node":"Grupo 1","type":"main","index":4}]]},"If3":{"main":[[],[{"node":"Grupo 1","type":"main","index":6}]]},"If4":{"main":[[],[{"node":"Grupo 1","type":"main","index":8}]]},"If5":{"main":[[],[{"node":"Grupo 2","type":"main","index":0}]]},"If6":{"main":[[],[{"node":"Grupo 2","type":"main","index":2}]]},"If7":{"main":[[],[{"node":"Grupo 2","type":"main","index":4}]]},"If8":{"main":[[],[{"node":"Grupo 2","type":"main","index":6}]]},"If9":{"main":[[],[{"node":"Grupo 2","type":"main","index":8}]]},"If10":{"main":[[],[{"node":"Grupo 3","type":"main","index":1}]]},"If11":{"main":[[],[{"node":"Grupo 1","type":"main","index":1}]]},"If12":{"main":[[],[{"node":"Grupo 1","type":"main","index":3}]]},"If13":{"main":[[],[{"node":"Grupo 1","type":"main","index":5}]]},"If14":{"main":[[],[{"node":"Grupo 1","type":"main","index":7}]]},"If15":{"main":[[],[{"node":"Grupo 1","type":"main","index":9}]]},"If16":{"main":[[],[{"node":"Grupo 2","type":"main","index":1}]]},"If17":{"main":[[],[{"node":"Grupo 2","type":"main","index":3}]]},"If18":{"main":[[],[{"node":"Grupo 2","type":"main","index":5}]]},"If19":{"main":[[],[{"node":"Grupo 2","type":"main","index":7}]]},"If20":{"main":[[],[{"node":"Grupo 3","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Summarize","type":"main","index":0}]]},"Gmail":{"main":[[]]},"Summarize":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Format Date":{"main":[[{"node":"Vmware","type":"main","index":0},{"node":"Sophos","type":"main","index":0},{"node":"HPE","type":"main","index":0},{"node":"Veeam","type":"main","index":0},{"node":"Fortinet","type":"main","index":0},{"node":"Cisco","type":"main","index":0},{"node":"Ansible","type":"main","index":0},{"node":"Kubernetes","type":"main","index":0},{"node":"SolarWinds","type":"main","index":0},{"node":"Acronis","type":"main","index":0},{"node":"Mikrotik","type":"main","index":0},{"node":"Juniper","type":"main","index":0},{"node":"Huawei","type":"main","index":0},{"node":"Chrome","type":"main","index":0},{"node":"Edge","type":"main","index":0},{"node":"Outlook","type":"main","index":0},{"node":"Dell","type":"main","index":0},{"node":"IBM","type":"main","index":0},{"node":"Hitachi","type":"main","index":0},{"node":"Pure","type":"main","index":0},{"node":"Broadcom","type":"main","index":0},{"node":"Ubiquiti","type":"main","index":0}]]},"HTML Create":{"main":[[{"node":"Microsoft Outlook","type":"main","index":0}]]},"Ubiquiti":{"main":[[{"node":"If21","type":"main","index":0}]]},"If21":{"main":[[],[{"node":"Grupo 3","type":"main","index":2}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"c525e7b4-581d-4a07-8825-81af3335ad51","triggerCount":2,"tags":[]}