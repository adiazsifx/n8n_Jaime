{"createdAt":"2025-05-28T15:38:23.327Z","updatedAt":"2025-05-28T16:34:17.000Z","id":"AC8dUicxHB4i6xl2","name":"Create/update Collection Qdrant","active":false,"isArchived":false,"nodes":[{"parameters":{"url":"http://192.168.3.13:6333/collections","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-100,-360],"id":"631bec2f-78cd-42c2-8c93-f970da3dc382","name":"HTTP Request","credentials":{"httpBearerAuth":{"id":"LrVcAPhbHcvbYIPa","name":"Qdran Authentication"}}},{"parameters":{"jsCode":"const clientName = \"Cliente de prueba\"; // Asumiendo que el nombre del cliente viene en el campo 'clientName'\n\nif (!clientName) {\n  throw new Error(\"El nombre del cliente es requerido.\");\n}\n\nconst collectionName = `client_${clientName.replace(/[^a-zA-Z0-9_]/g, '_').toLowerCase()}`; // Nombre de la colección basado en el nombre del cliente\n\nreturn [\n  {\n    json: {\n      collectionName: collectionName,\n      operation: \"check_and_create\"\n    }\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-340,-360],"id":"bf07d881-58f6-4101-94a0-754244717fd2","name":"Verificar y Preparar Creación"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-560,-360],"id":"cc53ba4a-26c9-47e8-8dad-4954c2c225e2","name":"When clicking ‘Execute workflow’"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5ba5ac6d-db68-46f5-8dee-4848c312a601","leftValue":"={{ $json.collectionExists }}","rightValue":"=false","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[340,-360],"id":"1f94be23-e7c4-4766-8221-c7bc0cd1b11a","name":"If"},{"parameters":{"method":"PUT","url":"=http://192.168.3.13:6333/collections/{{ $('Verificar y Preparar Creación').item.json.collectionName }}","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"vectors\": {\n    \"size\": 300,\n    \"distance\": \"Cosine\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[560,-200],"id":"696c9c74-25c1-48d5-a7e6-d0d132c13b7f","name":"Create Collection","credentials":{"httpBearerAuth":{"id":"LrVcAPhbHcvbYIPa","name":"Qdran Authentication"}}},{"parameters":{"jsCode":"const collectionsData =$input.first().json.result.collections; // Asumiendo que la respuesta JSON tiene un campo 'result' que es un array de colecciones\nconst clientCollectionName = $('Verificar y Preparar Creación').first().json.collectionName; // Obtén el nombre de la colección del output del primer Function node\n\nif (!collectionsData || !Array.isArray(collectionsData)) {\n  console.log(\"No se encontraron colecciones o el formato de la respuesta es incorrecto.\");\n  return [{ json: { collectionExists: false } }];\n}\n\nconst collectionExists = collectionsData.some(collection => collection.name === clientCollectionName);\n\nreturn [{ json: { collectionExists: collectionExists } }];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[120,-360],"id":"d251ff30-24df-4630-a6d0-2019fa473a98","name":"Verificacion Collection Exists"},{"parameters":{"mode":"insert","qdrantCollection":{"__rl":true,"value":"={{ $('Verificar y Preparar Creación').item.json.collectionName }}","mode":"id"},"options":{"collectionConfig":""}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[560,-460],"id":"e7c92e80-7436-4fd9-9fc6-74d5a2942f68","name":"Insert Documents","credentials":{"qdrantApi":{"id":"RHA3vcrOm5VwmYlq","name":"QdrantApi account"}}},{"parameters":{"mode":"insert","qdrantCollection":{"__rl":true,"value":"={{ $('Verificar y Preparar Creación').item.json.collectionName }}","mode":"id"},"options":{"collectionConfig":""}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[780,-200],"id":"43b78447-393b-493d-a2c9-51a85fcb7091","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"RHA3vcrOm5VwmYlq","name":"QdrantApi account"}}}],"connections":{"HTTP Request":{"main":[[{"node":"Verificacion Collection Exists","type":"main","index":0}]]},"Verificar y Preparar Creación":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"When clicking ‘Execute workflow’":{"main":[[{"node":"Verificar y Preparar Creación","type":"main","index":0}]]},"If":{"main":[[{"node":"Insert Documents","type":"main","index":0}],[{"node":"Create Collection","type":"main","index":0}]]},"Verificacion Collection Exists":{"main":[[{"node":"If","type":"main","index":0}]]},"Create Collection":{"main":[[{"node":"Qdrant Vector Store","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"f52789a9-75f1-4f48-8240-70aaa875de51","triggerCount":0,"tags":[]}