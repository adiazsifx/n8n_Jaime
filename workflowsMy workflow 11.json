{"createdAt":"2025-05-30T10:20:04.502Z","updatedAt":"2025-05-30T11:07:16.000Z","id":"sxOz3SRwd8UIObT0","name":"My workflow 11","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-80,0],"id":"62c668a1-f013-4374-9f48-193aeb373a9a","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"url":"https://api.cloud.llamaindex.ai/api/v1/projects/7573e460-e706-49a6-bea1-08e67d90116d/usage","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/json"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[120,0],"id":"6729cb48-9ba1-4afb-b2d9-b50def2974eb","name":"HTTP Request","credentials":{"httpHeaderAuth":{"id":"rDHcHgP5GNq3qUHB","name":"API Llamaindex"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"eb50c2aa-ac2c-422e-9c11-993ee5ab4088","leftValue":"={{ $json.usage.active_free_credits_usage[0].remaining_balance }}","rightValue":8000,"operator":{"type":"number","operation":"lt"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[320,0],"id":"7d2f1f0f-5966-4e25-a947-6e98c9fdb7e3","name":"If"},{"parameters":{"html":"<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Alerta LlamaIndex</title>\n</head>\n<body style=\"font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5;\">\n    \n    <div style=\"max-width: 600px; margin: 0 auto; background-color: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden;\">\n        \n        <!-- Header -->\n        <div style=\"background-color: #ff6b35; color: white; padding: 30px 20px; text-align: center;\">\n            <h1 style=\"margin: 0; font-size: 24px; font-weight: bold;\">‚ö†Ô∏è Alerta LlamaIndex</h1>\n        </div>\n        \n        <!-- Content -->\n        <div style=\"padding: 40px 30px; text-align: center;\">\n            <div style=\"background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px; padding: 20px; margin-bottom: 30px;\">\n                <h2 style=\"color: #856404; margin: 0 0 10px 0; font-size: 20px;\">üö® L√≠mite Pr√≥ximo</h2>\n                <p style=\"color: #856404; margin: 0; font-size: 16px; font-weight: 500;\">\n                    Quedan <strong> {{ $('Edit Fields').item.json.remaining_balance }} ejecuciones</strong> disponibles en LlamaIndex\n                </p>\n            </div>\n            \n           <div style=\"background-color: #f8f9fa; border-radius: 6px; padding: 25px; margin-bottom: 30px;\">\n                <h3 style=\"color: #495057; margin: 0 0 15px 0; font-size: 18px;\">üìä Estado del Sistema</h3>\n                <div style=\"background-color: #28a745; height: 8px; border-radius: 4px; width: 100%; margin: 15px 0;\">\n                    <div style=\"background-color: #dc3545; height: 8px; border-radius: 4px; width: {{ $('Edit Fields').item.json.used_rate }};\"></div>\n                </div>\n                <p style=\"color: #6c757d; margin: 5px 0 0 0; font-size: 14px;\">\n                    <strong>Cr√≠tico:</strong> Resta el {{ $('Edit Fields').item.json.remaining_rate }}\n                </p>\n            </div>\n            \n            <p style=\"color: #495057; font-size: 16px; line-height: 1.5; margin: 0 0 30px 0;\">\n                Te recomendamos revisar tu plan actual y considerar una actualizaci√≥n para evitar interrupciones en el servicio.\n            </p>\n            \n            <div style=\"margin-top: 20px;\">\n                <a href=\"https://cloud.llamaindex.ai/project/7573e460-e706-49a6-bea1-08e67d90116d\" style=\"background-color: #007bff; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; font-weight: bold; display: inline-block;\">\n                    Revisar Plan\n                </a>\n            </div>\n        </div>\n        \n        <!-- Footer -->\n        <div style=\"background-color: #f8f9fa; padding: 20px; text-align: center; border-top: 1px solid #dee2e6;\">\n            <p style=\"color: #6c757d; margin: 0; font-size: 12px;\">\n                Este es un mensaje autom√°tico del sistema de monitoreo LlamaIndex\n            </p>\n            <p style=\"color: #6c757d; margin: 5px 0 0 0; font-size: 12px;\">\n                Fecha: <span id=\"current-date\"></span>\n            </p>\n        </div>\n        \n    </div>\n    \n    <script>\n        document.getElementById('current-date').textContent = new Date().toLocaleDateString('es-ES');\n    </script>\n    \n</body>\n</html>"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[900,-220],"id":"a8f41fe2-d09a-48a5-9fed-762d0f58e3cd","name":"HTML"},{"parameters":{"resource":"messages-api","instanceName":"whisper_aifx","remoteJid":"573165278069","messageText":"=‚ö†Ô∏è *LLAMAINDEX ALERT*  üî¥ {{ $json.remaining_balance }} ejecuciones restantes\nüìâ Quedan {{ $json.remaining_rate }}\n‚ö° Renovaci√≥n urgente necesaria\nüëÜ Revisar plan ahora\nüìÖ Fecha: {{ $now.format('dd-MMM-yyyy HH:MM') }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[920,80],"id":"3b1a9d80-b861-4802-909a-66d11018345b","name":"Evolution API","credentials":{"evolutionApi":{"id":"9k6KTcMvpINN4jXM","name":"Evolution aifx 3171057858"}}},{"parameters":{"assignments":{"assignments":[{"id":"d60d9b7d-01eb-49cf-ae16-495a8c956f30","name":"remaining_rate","value":"={{ $json.usage.active_free_credits_usage[0].remaining_balance / $json.usage.active_free_credits_usage[0].starting_balance * 100 }}%","type":"number"},{"id":"0b951fd1-57c7-4ba0-a0b9-d3062d565303","name":"remaining_balance","value":"={{ $json.usage.active_free_credits_usage[0].remaining_balance }}","type":"string"},{"id":"ffc3f79a-a677-480b-ae2d-6af147c89822","name":"used_rate","value":"={{ ($json.usage.active_free_credits_usage[0].starting_balance- $json.usage.active_free_credits_usage[0].remaining_balance) / $json.plan.recurring_credits[0].credit_amount * 100 }}%","type":"string"}]},"options":{"ignoreConversionErrors":true}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[600,-80],"id":"7c77a689-8f14-4348-9c11-bc3883168e82","name":"Edit Fields"}],"connections":{"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Edit Fields","type":"main","index":0}],[]]},"HTML":{"main":[[]]},"Edit Fields":{"main":[[{"node":"HTML","type":"main","index":0},{"node":"Evolution API","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"d6db9760-64c8-44b0-80f3-2c8f85066a48","triggerCount":0,"tags":[]}