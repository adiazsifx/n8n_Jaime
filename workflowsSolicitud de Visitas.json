{"createdAt":"2025-06-21T16:09:12.455Z","updatedAt":"2025-06-24T17:15:46.000Z","id":"iKXwCgvfcrBS1ZcC","name":"Solicitud de Visitas","active":true,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"front_request","responseMode":"responseNode","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-460,-40],"id":"69e674cd-b085-41c0-b0fe-a323677354aa","name":"Webhook from WEB","webhookId":"894b0a7a-cb0f-4009-8525-43642884c9ca"},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"request_visitas","mode":"list","cachedResultName":"request_visitas"},"columns":{"mappingMode":"defineBelow","value":{"descripcion":"={{ $json.body.mantenimiento_aprovisionamiento }}","tipo":"={{ $json.body.mantenimiento_aprovisionamiento }}","cliente":"={{ $json.body.cliente }}","pais":"={{ $json.body.pais }}","ciudad":"={{ $json.body.ciudad }}","direccion_cliente":"={{ $json.body.direccion_cliente }}","equipos_llevar_cliente":"={{ $json.body.equipos_llevar_cliente }}","hora":"={{ $json.body.hora }}","ticket":"={{ $json.body.ticket }}","sid":"={{ $json.body.sid }}","nombre_contacto_cliente":"={{ $json.body.nombre_contacto_cliente }}","telefono_cliente":"={{ $json.body.telefono_cliente }}","rq_equipos":"={{ $json.body.rq_equipos }}","donde_recoger_equipo":"={{ $json.body.donde_recoger_equipo }}","guia_envio_equipos":"={{ $json.body.guia_envio_equipos }}","ingeniero_grupo":"={{ $json.body.nombre_grupo_ingenierio }}","gerente_proyecto":"={{ $json.body.gerente_proyecto }}","observaciones":"={{ $json.body.observaciones }}","fecha":"={{ $json.body.fecha }}","adjunta_acta_um":"={{ $json.body.adjuntar_acta_um }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"descripcion","displayName":"descripcion","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"tipo","displayName":"tipo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"adjunta_acta_um","displayName":"adjunta_acta_um","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"cliente","displayName":"cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"pais","displayName":"pais","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"ciudad","displayName":"ciudad","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"direccion_cliente","displayName":"direccion_cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fecha","displayName":"fecha","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"hora","displayName":"hora","required":false,"defaultMatch":false,"display":true,"type":"time","canBeUsedToMatch":true},{"id":"ticket","displayName":"ticket","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"sid","displayName":"sid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nombre_contacto_cliente","displayName":"nombre_contacto_cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"telefono_cliente","displayName":"telefono_cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"equipos_llevar_cliente","displayName":"equipos_llevar_cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"rq_equipos","displayName":"rq_equipos","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"donde_recoger_equipo","displayName":"donde_recoger_equipo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"guia_envio_equipos","displayName":"guia_envio_equipos","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"ingeniero_grupo","displayName":"ingeniero_grupo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"gerente_proyecto","displayName":"gerente_proyecto","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"observaciones","displayName":"observaciones","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"coordenadas","displayName":"coordenadas","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"asunto","displayName":"asunto","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"hora_ingreso","displayName":"hora_ingreso","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"hora_salida","displayName":"hora_salida","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"contratistas","displayName":"contratistas","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"nombregrupo","displayName":"nombregrupo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-260,-40],"id":"bf39d595-4e79-484b-9626-3a609dc6c620","name":"Write DataBase","credentials":{"postgres":{"id":"brzMaPB6iJB9Pcyc","name":"Postgres DB Operaciones"}}},{"parameters":{"assignments":{"assignments":[{"id":"f8294a09-359b-4e79-964f-91d99d8147fd","name":"id","value":"={{ $json.id_req }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[500,-60],"id":"369ef2f3-fff1-4f9b-8886-3851e3c7562e","name":"Set ID Request"},{"parameters":{"respondWith":"json","responseBody":"={\n  \"id\": \"{{ $json.id }}\"\n} ","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[720,-60],"id":"91cbb65c-aecb-4ea0-a6b6-4fd496db4b37","name":"Respond ID"},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Solicitud de Manos Remotas</title>\n</head>\n<body style=\"margin: 0; padding: 20px; font-family: Arial, sans-serif; background-color: #f8fafc; color: #334155;\">\n\n<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n  \n  <!-- Header -->\n  <tr>\n    <td style=\"background-color: #3b82f6; padding: 20px; text-align: center;\">\n      <h1 style=\"margin: 0; color: #ffffff; font-size: 24px; font-weight: bold;\">Solicitud de Manos Remotas</h1>\n    </td>\n  </tr>\n\n  <!-- Content -->\n  <tr>\n    <td style=\"padding: 25px;\">\n      \n      <!-- Request Details -->\n      <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin-bottom: 20px;\">\n        <tr>\n          <td width=\"50%\" style=\"padding-right: 10px;\">\n            <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">ID SOLICITUD</p>\n            <p style=\"margin: 0; font-size: 16px; color: #1e293b; font-weight: bold;\">{{ $json.id_req }}</p>\n          </td>\n          <td width=\"50%\" style=\"padding-left: 10px;\">\n            <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">TICKET</p>\n            <p style=\"margin: 0; font-size: 16px; color: #1e293b; font-weight: bold;\">{{ $json.ticket }}</p>\n          </td>\n        </tr>\n      </table>\n\n      <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin-bottom: 25px;\">\n        <tr>\n          <td width=\"50%\" style=\"padding-right: 10px;\">\n            <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">TIPO DE GESTI√ìN</p>\n            <p style=\"margin: 0; font-size: 16px; color: #059669; font-weight: bold;\">{{ $json.tipo }}</p>\n          </td>\n          <td width=\"50%\" style=\"padding-left: 10px;\">\n            <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">SID</p>\n            <p style=\"margin: 0; font-size: 16px; color: #1e293b; font-weight: bold;\">{{ $json.sid }}</p>\n          </td>\n        </tr>\n      </table>\n\n      <!-- Appointment Details -->\n      <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin-bottom: 25px; background-color: #f1f5f9; border-radius: 6px;\">\n        <tr>\n          <td style=\"padding: 15px;\">\n            <h3 style=\"margin: 0 0 15px 0; color: #3b82f6; font-size: 16px;\">üóìÔ∏è DETALLES DE LA CITA</h3>\n            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n              <tr>\n                <td width=\"50%\" style=\"padding-right: 10px;\">\n                  <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">FECHA</p>\n                  <p style=\"margin: 0; font-size: 14px; color: #1e293b; font-weight: bold;\">{{ $json.fecha.toDateTime().format('dd MMM yyyy') }}</p>\n                </td>\n                <td width=\"50%\" style=\"padding-left: 10px;\">\n                  <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">HORA</p>\n                  <p style=\"margin: 0; font-size: 14px; color: #1e293b; font-weight: bold;\">{{ $json.hora.toDateTime().format('HH:mm') }}</p>\n                </td>\n              </tr>\n            </table>\n          </td>\n        </tr>\n      </table>\n\n      <!-- Client Information -->\n      <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin-bottom: 25px;\">\n        <tr>\n          <td>\n            <h3 style=\"margin: 0 0 15px 0; color: #3b82f6; font-size: 16px; border-bottom: 2px solid #e2e8f0; padding-bottom: 8px;\">üë§ INFORMACI√ìN DEL CLIENTE</h3>\n            \n            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin-bottom: 12px;\">\n              <tr>\n                <td>\n                  <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">CLIENTE</p>\n                  <p style=\"margin: 0 0 12px 0; font-size: 14px; color: #1e293b; font-weight: bold;\">{{ $json.cliente.toUpperCase() }}</p>\n                </td>\n              </tr>\n              <tr>\n                <td>\n                  <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">CONTACTO</p>\n                  <p style=\"margin: 0 0 12px 0; font-size: 14px; color: #1e293b; font-weight: bold;\">{{ $json.cliente.toUpperCase() }}</p>\n                </td>\n              </tr>\n            </table>\n\n            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin-bottom: 12px;\">\n              <tr>\n                <td width=\"33%\" style=\"padding-right: 8px;\">\n                  <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">PA√çS</p>\n                  <p style=\"margin: 0; font-size: 14px; color: #1e293b;\">{{ $json.pais.toUpperCase() }}</p>\n                </td>\n                <td width=\"33%\" style=\"padding: 0 4px;\">\n                  <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">CIUDAD</p>\n                  <p style=\"margin: 0; font-size: 14px; color: #1e293b;\">{{ $json.ciudad.toUpperCase() }}</p>\n                </td>\n                <td width=\"34%\" style=\"padding-left: 8px;\">\n                  <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">TEL√âFONO</p>\n                  <p style=\"margin: 0; font-size: 14px; color: #1e293b;\">{{ $json.telefono_cliente }}</p>\n                </td>\n              </tr>\n            </table>\n\n            <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">DIRECCI√ìN</p>\n            <p style=\"margin: 0; font-size: 14px; color: #1e293b;\">{{ $json.direccion_cliente.toTitleCase() }}</p>\n          </td>\n        </tr>\n      </table>\n\n      <!-- Equipment & Logistics -->\n      <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin-bottom: 25px; background-color: #fef3f2; border-radius: 6px;\">\n        <tr>\n          <td style=\"padding: 15px;\">\n            <h3 style=\"margin: 0 0 15px 0; color: #dc2626; font-size: 16px;\">üì¶ EQUIPOS Y LOG√çSTICA</h3>\n            \n            <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">EQUIPOS A LLEVAR</p>\n            <p style=\"margin: 0 0 12px 0; font-size: 14px; color: #1e293b;\">{{ $json.equipos_llevar_cliente }}</p>\n\n            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin-bottom: 12px;\">\n              <tr>\n                <td width=\"50%\" style=\"padding-right: 10px;\">\n                  <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">RQ EQUIPOS</p>\n                  <p style=\"margin: 0; font-size: 14px; color: #1e293b;\">{{ $json.rq_equipos }}</p>\n                </td>\n                <td width=\"50%\" style=\"padding-left: 10px;\">\n                  <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">GU√çA DE ENV√çO</p>\n                  <p style=\"margin: 0; font-size: 14px; color: #1e293b;\">{{ $json.guia_envio_equipos }}</p>\n                </td>\n              </tr>\n            </table>\n\n            <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">LUGAR DE RECOGIDA</p>\n            <p style=\"margin: 0; font-size: 14px; color: #1e293b;\">{{ $json.donde_recoger_equipo }}</p>\n          </td>\n        </tr>\n      </table>\n\n      <!-- Work Team -->\n      <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin-bottom: 25px;\">\n        <tr>\n          <td>\n            <h3 style=\"margin: 0 0 15px 0; color: #3b82f6; font-size: 16px; border-bottom: 2px solid #e2e8f0; padding-bottom: 8px;\">üë®‚Äçüíª EQUIPO DE TRABAJO</h3>\n            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n              <tr>\n                <td width=\"50%\" style=\"padding-right: 10px;\">\n                  <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">INGENIERO O GRUPO</p>\n                  <p style=\"margin: 0; font-size: 14px; color: #1e293b; font-weight: bold;\">{{ $json.ingeniero_grupo }}</p>\n                </td>\n                <td width=\"50%\" style=\"padding-left: 10px;\">\n                  <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #64748b; font-weight: bold;\">GERENTE DE PROYECTOS</p>\n                  <p style=\"margin: 0; font-size: 14px; color: #1e293b; font-weight: bold;\">{{ $json.gerente_proyecto }}</p>\n                </td>\n              </tr>\n            </table>\n          </td>\n        </tr>\n      </table>\n\n      <!-- Observations -->\n      <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"background-color: #fffbeb; border-left: 4px solid #f59e0b; border-radius: 6px;\">\n        <tr>\n          <td style=\"padding: 15px;\">\n            <h3 style=\"margin: 0 0 10px 0; color: #d97706; font-size: 16px;\">üìù OBSERVACIONES</h3>\n            <p style=\"margin: 0; font-size: 14px; color: #92400e; font-style: italic;\">{{ $json.observaciones.toUpperCase() }}</p>\n          </td>\n        </tr>\n      </table>\n\n    </td>\n  </tr>\n\n  <!-- Footer -->\n  <tr>\n    <td style=\"background-color: #f8fafc; padding: 15px; text-align: center; border-top: 1px solid #e2e8f0;\">\n      <p style=\"margin: 0; font-size: 11px; color: #64748b;\">\n        üìß Reporte generado autom√°ticamente por aifx ‚Ä¢ üóìÔ∏è Fecha: {{ $today.format('dd MMM yyyy') }}<br>\n        El contenido puede contener errores, favor revisar detalladamente.\n      </p>\n    </td>\n  </tr>\n\n</table>\n\n</body>\n</html>"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[500,140],"id":"7bcbd6d3-4d2a-41cf-bf32-a035934404b5","name":"HTML to Mail"},{"parameters":{"resource":"messages-api","instanceName":"whisper_remote_hands","remoteJid":"573165278069","messageText":"=üöÄ **SOLICITUD DE MANOS REMOTAS**\n\nüìã **DATOS GENERALES**\n- **ID:** No. {{ $json.id_req }}\n- **Ticket:** {{ $json.ticket }}\n- **Tipo:** *{{ $json.tipo }}*\n- **SID:** {{ $json.sid }}\n\nüìÖ **CITA PROGRAMADA**\n> **Fecha:** {{ $json.fecha.toDateTime().format('dd MMM yyyy') }}\n> **Hora:** {{ $json.hora.toDateTime().format('HH:mm') }}\n\nüë§ **INFORMACI√ìN DEL CLIENTE**\n**Cliente:** {{ $json.cliente.toUpperCase() }}\n**Contacto:** {{ $json.nombre_contacto_cliente.toUpperCase() }}\n**Ubicaci√≥n:** {{ $json.ciudad.toUpperCase() }}, {{ $json.pais.toUpperCase() }}\n**Tel√©fono:** {{ $json.telefono_cliente }}\n**Direcci√≥n:** {{ $json.direccion_cliente.toTitleCase() }}\n\nüì¶ **EQUIPOS Y LOG√çSTICA**\n**Equipos a llevar:**\n_{{ $json.equipos_llevar_cliente }}_\n\n**RQ Equipos:** {{ $json.rq_equipos }}\n**Gu√≠a de Env√≠o:** {{ $json.guia_envio_equipos }}\n**Recoger en:** {{ $json.donde_recoger_equipo }}\n\nüë®‚Äçüíª **EQUIPO DE TRABAJO**\n**Ingeniero o Grupo:** {{ $json.ingeniero_grupo }}\n**Gerente de Proyectos:** {{ $json.gerente_proyecto }}\n\n‚ö†Ô∏è **OBSERVACIONES IMPORTANTES**\n> *{{ $json.observaciones }}*\n\n---\n> üìß Generado por aifx ‚Ä¢ üóìÔ∏è {{ $today.format('dd MMM yyyy') }}\n> _Verificar detalles antes de proceder_ ","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[500,-260],"id":"4395e989-996d-4f2b-9d4c-0038ebeb6d55","name":"Send Wapp Request","credentials":{"evolutionApi":{"id":"l1h7t9g8yuhuMKwz","name":"Whatsapp Operaciones 573117653488"}}},{"parameters":{"jsCode":"const html = $input.first().json.html\nconst base64String = $('Webhook from WEB').first().json.body.acta_um_file\nreturn { \n  json: { \n    base64Data: base64String,\n    filename: 'acta.pdf',\n    html: html\n  } \n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[720,140],"id":"d5fd5d1e-89c9-48aa-bb00-96addd1e7bcc","name":"Code","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"operation":"toBinary","sourceProperty":"base64Data","options":{"fileName":"acta.pdf"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[1160,40],"id":"d1c48fb5-197d-44d5-96c4-aef8dd7d608f","name":"Convert to File","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5432e1ed-1ff0-428d-8e4a-6cb59a6b291d","leftValue":"={{ $json.base64Data }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[940,140],"id":"ca9d1fa9-a042-474b-b2cb-0ca3405fee83","name":"If"},{"parameters":{"toRecipients":"jaimep@ifxcorp.com","subject":"=Solicitud de Manos Remotas ID No. {{ $('Write DataBase').first().json.id_req }}","bodyContent":"={{ $('HTML to Mail').item.json.html }}","additionalFields":{"attachments":{"attachments":[{"binaryPropertyName":"data"}]},"bodyContentType":"html"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[1380,40],"id":"044d470f-ad09-467e-9c96-d0301eb5b581","name":"Send Mail Acta","webhookId":"f8e5090d-f71c-4f08-8587-21e1268bd881","credentials":{"microsoftOutlookOAuth2Api":{"id":"xSTIlfhp3ac7TN3h","name":"Mail ai@ifxcorp.com"}}},{"parameters":{"resource":"messages-api","operation":"send-document","instanceName":"whisper_remote_hands","remoteJid":"573165278069","media":"={{ $('Code').item.json.base64Data }}","caption":"=üöÄ **SOLICITUD DE MANOS REMOTAS**\n\nüìã **DATOS GENERALES**\n- **ID:** No. {{ $('Write DataBase').item.json.id_req }}\n- **Ticket:** {{ $('Write DataBase').item.json.ticket }}\n- **Tipo:** *{{ $('Write DataBase').item.json.tipo }}*\n- **SID:** {{ $('Write DataBase').item.json.sid }}\n\nüìÖ **CITA PROGRAMADA**\n> **Fecha:** {{ $('Write DataBase').item.json.fecha.toDateTime().format('dd MMM yyyy') }}\n> **Hora:** {{ $('Write DataBase').item.json.hora.toDateTime().format('HH:mm') }}\n\nüë§ **INFORMACI√ìN DEL CLIENTE**\n**Cliente:** {{ $('Write DataBase').item.json.cliente.toUpperCase() }}\n**Contacto:** {{ $('Write DataBase').item.json.nombre_contacto_cliente.toUpperCase() }}\n**Ubicaci√≥n:** {{ $('Write DataBase').item.json.ciudad.toUpperCase() }}, {{ $('Write DataBase').item.json.pais.toUpperCase() }}\n**Tel√©fono:** {{ $('Write DataBase').item.json.telefono_cliente }}\n**Direcci√≥n:** {{ $('Write DataBase').item.json.direccion_cliente.toTitleCase() }}\n\nüì¶ **EQUIPOS Y LOG√çSTICA**\n**Equipos a llevar:**\n_{{ $('Write DataBase').item.json.equipos_llevar_cliente }}_\n\n**RQ Equipos:** {{ $('Write DataBase').item.json.rq_equipos }}\n**Gu√≠a de Env√≠o:** {{ $('Write DataBase').item.json.guia_envio_equipos }}\n**Recoger en:** {{ $('Write DataBase').item.json.donde_recoger_equipo }}\n\nüë®‚Äçüíª **EQUIPO DE TRABAJO**\n**Ingeniero o Grupo:** {{ $('Write DataBase').item.json.ingeniero_grupo }}\n**Gerente de Proyectos:** {{ $('Write DataBase').item.json.gerente_proyecto }}\n\n‚ö†Ô∏è **OBSERVACIONES IMPORTANTES**\n> *{{ $('Write DataBase').item.json.observaciones }}*\n\n---\n> üìß Generado por aifx ‚Ä¢ üóìÔ∏è {{ $today.format('dd MMM yyyy') }}\n> _Verificar detalles antes de proceder_","fileName":"acta.pdf","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[1160,-160],"id":"3582bfe7-58f6-4a0c-8a5c-a60fa266da55","name":"Send Wapp Acta","credentials":{"evolutionApi":{"id":"l1h7t9g8yuhuMKwz","name":"Whatsapp Operaciones 573117653488"}}},{"parameters":{"jsCode":"// Obtener el ID del input\nconst idOriginal = $input.first().json.id.toString();\nconst digits = idOriginal.split('').map(Number);\n\n// M√∫ltiples checksums para mayor complejidad\nlet suma1 = 0;\nlet suma2 = 0;\nlet suma3 = 0;\n\nfor(let i = 0; i < digits.length; i++) {\n    suma1 += digits[i] * (i + 2);           // Pesos crecientes\n    suma2 += digits[i] * Math.pow(3, i);    // Potencias de 3\n    suma3 ^= digits[i] * (i % 2 === 0 ? 7 : 11); // XOR con pesos alternados\n}\n\n// Combinar los checksums con operaciones complejas\nconst combinado = (suma1 * 7 + suma2 * 3 + suma3 * 5) % 97;\nconst digitoVerificador = combinado % 10;\n\nconst id_req = idOriginal + digitoVerificador.toString();\n\n// Retornar el resultado\nreturn [{\n    json: {\n        ...($input.first().json),\n        id_req: id_req\n    }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-40,-40],"id":"e5bdecde-a448-477a-aa4f-eebd3ed1c2d6","name":"Code1"},{"parameters":{"operation":"update","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"request_visitas","mode":"list","cachedResultName":"request_visitas"},"columns":{"mappingMode":"defineBelow","value":{"id":"={{ $json.id }}","id_req":"={{ $json.id_req }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"descripcion","displayName":"descripcion","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"tipo","displayName":"tipo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"adjunta_acta_um","displayName":"adjunta_acta_um","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"cliente","displayName":"cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"pais","displayName":"pais","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"ciudad","displayName":"ciudad","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"direccion_cliente","displayName":"direccion_cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"fecha","displayName":"fecha","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"hora","displayName":"hora","required":false,"defaultMatch":false,"display":true,"type":"time","canBeUsedToMatch":true,"removed":true},{"id":"ticket","displayName":"ticket","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"sid","displayName":"sid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"nombre_contacto_cliente","displayName":"nombre_contacto_cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"telefono_cliente","displayName":"telefono_cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"equipos_llevar_cliente","displayName":"equipos_llevar_cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"rq_equipos","displayName":"rq_equipos","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"donde_recoger_equipo","displayName":"donde_recoger_equipo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"guia_envio_equipos","displayName":"guia_envio_equipos","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"ingeniero_grupo","displayName":"ingeniero_grupo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"gerente_proyecto","displayName":"gerente_proyecto","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"observaciones","displayName":"observaciones","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"coordenadas","displayName":"coordenadas","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"asunto","displayName":"asunto","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"hora_ingreso","displayName":"hora_ingreso","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"hora_salida","displayName":"hora_salida","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"contratistas","displayName":"contratistas","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"nombregrupo","displayName":"nombregrupo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"nombre_tecnico","displayName":"nombre_tecnico","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"telefono_tecnico","displayName":"telefono_tecnico","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"id_req","displayName":"id_req","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[180,-40],"id":"a65d584c-0c4d-4c85-8923-36f44c089b2e","name":"Set id_req","credentials":{"postgres":{"id":"brzMaPB6iJB9Pcyc","name":"Postgres DB Operaciones"}}},{"parameters":{"toRecipients":"jaimep@ifxcorp.com","subject":"=Solicitud de Manos Remotas ID No. {{ $('Write DataBase').first().json.id_req }}","bodyContent":"={{ $('HTML to Mail').item.json.html }}","additionalFields":{"bodyContentType":"html"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[1160,240],"id":"1ca0374b-e7a5-4ee5-aef9-afc1b0fa9d5a","name":"Send Mail No Acta","webhookId":"f8e5090d-f71c-4f08-8587-21e1268bd881","credentials":{"microsoftOutlookOAuth2Api":{"id":"xSTIlfhp3ac7TN3h","name":"Mail ai@ifxcorp.com"}}}],"connections":{"Webhook from WEB":{"main":[[{"node":"Write DataBase","type":"main","index":0}]]},"Write DataBase":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Set ID Request":{"main":[[{"node":"Respond ID","type":"main","index":0}]]},"Respond ID":{"main":[[]]},"HTML to Mail":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"If","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"Send Mail Acta","type":"main","index":0}]]},"If":{"main":[[{"node":"Convert to File","type":"main","index":0},{"node":"Send Wapp Acta","type":"main","index":0}],[{"node":"Send Mail No Acta","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Set id_req","type":"main","index":0}]]},"Set id_req":{"main":[[{"node":"Send Wapp Request","type":"main","index":0},{"node":"Set ID Request","type":"main","index":0},{"node":"HTML to Mail","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","saveDataSuccessExecution":"all","saveExecutionProgress":true,"saveManualExecutions":true},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"f9031b5b-d644-433c-8b47-b7a16c116d5a","triggerCount":1,"tags":[]}