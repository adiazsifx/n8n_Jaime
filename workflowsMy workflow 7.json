{"createdAt":"2025-04-09T17:00:31.382Z","updatedAt":"2025-04-29T11:21:05.000Z","id":"5qVTu0gTT8NtclES","name":"My workflow 7","active":false,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[360,580],"id":"022da5db-161a-44af-8b51-065e2101beaa","name":"Recursive Character Text Splitter"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1,"position":[480,420],"id":"d959dad8-ba7b-42d7-86ba-4fd1118a39fe","name":"Default Data Loader"},{"parameters":{"mode":"insert","qdrantCollection":{"__rl":true,"value":"services_client_test","mode":"list","cachedResultName":"services_client_test"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1,"position":[500,220],"id":"1c6d2353-3e29-4d71-9d94-ff2914231018","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"v6ZCaJ75SthKWZjJ","name":"QdrantAPI AIFX"}}},{"parameters":{"method":"POST","url":"https://portal-gateway.ifxcorp.com/api/service/getActiveServicesOptimized","sendHeaders":true,"headerParameters":{"parameters":[{"name":"access-token","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjb21wYW5pZXMiOnsiY3VzdG9tZXJzIjpbIjE4NzkwIiwiMjQyMDkiXSwiY29tcGFueUlEIjoiMzQ2OTciLCJjb21wYW55Ijp7ImlkIjoiMjQyMDkiLCJ2YWx1ZSI6IkNMSUVOVEUgREUgUFJVRUJBIiwiY291bnRyeSI6IkNvbG9tYmlhIiwic3Vic2lkaWFyeUlkIjoiMyJ9LCJjb250YWN0SWQiOiIzNTI5MDEyIiwiY29udGFjdE5hbWUiOiJBbnRvbmlvIFFBIiwiZW1haWwiOiJzYWRpYW44OEBnbWFpbC5jb20iLCJjb250YWN0VHlwZSI6eyJpZCI6IjEiLCJ2YWx1ZSI6IlTDqWNuaWNvIn0sImNvbnRhY3RSb2xlcyI6W3siaWQiOiI0IiwibmFtZSI6IlTDqWNuaWNvIn1dLCJjb250YWN0UGhvbmUiOiIiLCJjb250YWN0TW9iaWxlIjoiMTExMTExMTExIiwicGVybWlzc2lvbnMiOlt7Im5hbWUiOiJjb250YWN0IiwibGV2ZWwiOiIxIn0seyJuYW1lIjoic2VydmljZSIsImxldmVsIjoiNSJ9LHsibmFtZSI6Imludm9pY2UiLCJsZXZlbCI6IjEifSx7Im5hbWUiOiJhY2NudHN0YXQiLCJsZXZlbCI6IjEifSx7Im5hbWUiOiJjYXNlIiwibGV2ZWwiOiI1In0seyJuYW1lIjoidXNlciIsImxldmVsIjoiMSJ9LHsibmFtZSI6ImRhdGFjZW50ZXJhY2NycSIsImxldmVsIjoiMSJ9XX0sIm9wdEF1dGgiOnsiZW5hYmxlZCI6dHJ1ZSwidmVyaWZpZWQiOnRydWUsImlhY2hhdCI6ZmFsc2V9LCJpYXQiOjE3NDQyMTc1MzIsImV4cCI6MTc0NDIyMTEzMn0.KlzmajhpMTOzOUp98ESNO2jg2eE9GUrqXJf1gYimpfY"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\"customerId\":\"34697\",\"serviceStatus\":\"activo\"}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[240,0],"id":"bbfb8075-6f96-488a-b083-38185afe263a","name":"HTTP Request"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"185e8a31-646f-4237-8619-a7f99cb85960","name":"When clicking ‘Test workflow’"},{"parameters":{"model":"embedding-model","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[260,380],"id":"fde327a8-5b1a-40ed-b38e-d0617c598fa2","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"3ksygUY2AafRzzfk","name":"Proxy LiteLLM"}}},{"parameters":{"fieldToSplitOut":"services","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[460,0],"id":"a1040cfa-4399-4053-bbf6-cf5761a0f924","name":"Split Out","alwaysOutputData":true},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[1280,20],"id":"5346b143-de36-4f34-94ce-c4e0a8b69fe9","name":"When chat message received","webhookId":"1f294a5a-fc13-44fc-b2f8-9419c07dfb05"},{"parameters":{"hasOutputParser":true,"options":{"systemMessage":"ERES UN AGENTE EXPERTO EN CONSULTAS SOBRE SERVICIOS DE TELECOMUNICACIONES. TU FUNCIÓN PRINCIPAL ES RESPONDER PREGUNTAS DEL CLIENTE UTILIZANDO INFORMACIÓN INDEXADA EN UNA BASE DE DATOS RAG. CADA REGISTRO REPRESENTA UN SERVICIO ACTIVO O INACTIVO DEL CLIENTE.\n\n### TU OBJETIVO ES:\n- IDENTIFICAR EL/LOS SERVICIO(S) RELACIONADO(S) A LA CONSULTA DEL CLIENTE\n- RESPONDER CON UN RESUMEN EN FORMATO JSON ESTRUCTURADO\n- USAR SOLO LA INFORMACIÓN QUE ESTÉ PRESENTE EN LOS DOCUMENTOS RECUPERADOS\n- SIEMPRE RESPONDER EN EL MISMO IDIOMA EN EL QUE FUE FORMULADA LA PREGUNTA DEL CLIENTE\n\n---\n\n### FORMATO DE SALIDA ESPERADO (JSON):\n{\n  \"servicios\": [\n    {\n      \"nombre\": \"<name>\",\n      \"id\": \"<id>\",\n      \"codigo\": \"<code>\",\n      \"estado\": \"<status>\",\n      \"familia\": \"<family>\",\n      \"tipoProducto\": \"<productType>\",\n      \"paisInstalacion\": \"<countryInstall>\",\n      \"ciudadInstalacion\": \"<cityInstall>\",\n      \"direccionInstalacion\": \"<addressInstall>\",\n      \"anchoBanda\": {\n        \"valor\": \"<bandwidthService>\",\n        \"unidad\": \"<bandwidthServiceUnit>\"\n      }\n    }\n  ]\n}\n\n---\n\n### CHAIN OF THOUGHTS PARA RAZONAMIENTO PASO A PASO:\n\n1. **ENTENDER**: IDENTIFICA CLARAMENTE LA PREGUNTA O NECESIDAD DEL CLIENTE\n2. **BÁSICOS**: LOCALIZA TODOS LOS CAMPOS DISPONIBLES RELACIONADOS EN EL DOCUMENTO DE RAG\n3. **DESCOMPONER**: VERIFICA SI EL CLIENTE PIDE INFORMACIÓN GENERAL, FILTRADA (por ciudad, tipo de servicio, estado, etc.), O DETALLADA POR ID O CÓDIGO\n4. **ANALIZAR**: REVISA CADA DOCUMENTO Y EXTRAÉ LOS CAMPOS NECESARIOS\n5. **CONSTRUIR**: FORMATEA UNA RESPUESTA EN JSON CON LOS CAMPOS CLAVE\n6. **CASOS BORDE**: SI NO HAY SERVICIOS ENCONTRADOS, DEVUELVE UN JSON VACÍO: `\"servicios\": []`\n7. **RESPUESTA FINAL**: DEVUELVE LA RESPUESTA EN EL FORMATO ESTRUCTURADO Y EN EL MISMO IDIOMA DE LA PREGUNTA\n\n---\n\n### QUÉ NO HACER:\n\n- ❌ **NO INVENTES DATOS** QUE NO ESTÉN EN LOS DOCUMENTOS\n- ❌ **NO RESPONDAS EN FORMATO LIBRE**, SOLO EN JSON\n- ❌ **NO USES DATOS DE FUENTES EXTERNAS**\n- ❌ **NO OMITAS CAMPOS RELEVANTES COMO \"id\", \"estado\" O \"tipoProducto\"**\n- ❌ **NO RESPONDAS EN UN IDIOMA DIFERENTE AL DE LA PREGUNTA**\n- ❌ **NO RESPONDAS SI NO HAY DATOS**, DEVUELVE UN JSON VACÍO EN ESE CASO\n\n---\n\n### EJEMPLO DE RESPUESTA VÁLIDA:\n\n#### Consulta del cliente (en español): \"¿Qué servicios tengo activos en Honduras?\"\n\n{\n  \"servicios\": [\n    {\n      \"nombre\": \"1941143-IFX Cloud Server\",\n      \"id\": \"1837348\",\n      \"codigo\": \"1941143\",\n      \"estado\": \"Activo\",\n      \"familia\": \"Managed Cloud\",\n      \"tipoProducto\": \"Cloud Server\",\n      \"paisInstalacion\": \"Honduras\",\n      \"ciudadInstalacion\": \"Choluteca\",\n      \"direccionInstalacion\": \"pruebas NVS 1\",\n      \"anchoBanda\": {\n        \"valor\": \"10\",\n        \"unidad\": \"\"\n      }\n    }\n  ]\n}\n```\n\n#### Consulta del cliente (en inglés): \"Do I have any Cloud services in Honduras?\"\n\n```json\n{\n  \"services\": [\n    {\n      \"name\": \"1941143-IFX Cloud Server\",\n      \"id\": \"1837348\",\n      \"code\": \"1941143\",\n      \"status\": \"Active\",\n      \"family\": \"Managed Cloud\",\n      \"productType\": \"Cloud Server\",\n      \"countryInstall\": \"Honduras\",\n      \"cityInstall\": \"Choluteca\",\n      \"addressInstall\": \"pruebas NVS 1\",\n      \"bandwidth\": {\n        \"value\": \"10\",\n        \"unit\": \"\"\n      }\n    }\n  ]\n}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[1620,40],"id":"e668354a-3c64-42b9-a84d-a64825721ac0","name":"AI Agent1"},{"parameters":{"model":{"__rl":true,"value":"llama-3.3-70B-Instruct","mode":"list","cachedResultName":"llama-3.3-70B-Instruct"},"options":{"temperature":0.7}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1340,260],"id":"26a6ec37-a6e1-47a0-ab9b-942e807e3d38","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"3ksygUY2AafRzzfk","name":"Proxy LiteLLM"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1540,280],"id":"02b1ad39-90af-42d0-8ec9-8648ddd33b73","name":"Window Buffer Memory"},{"parameters":{"mode":"retrieve-as-tool","toolName":"serviceclient","toolDescription":"Informacion de los servicios del cliente.","qdrantCollection":{"__rl":true,"value":"services_client_test","mode":"list","cachedResultName":"services_client_test"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1,"position":[1640,380],"id":"d666736f-289f-42a0-a1e2-de84c3a3a62f","name":"Qdrant Vector Store1","credentials":{"qdrantApi":{"id":"v6ZCaJ75SthKWZjJ","name":"QdrantAPI AIFX"}}},{"parameters":{"model":"embedding-model","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[1820,540],"id":"56ea9f5c-8982-428c-8822-7cca36929ca0","name":"Embeddings OpenAI2","credentials":{"openAiApi":{"id":"3ksygUY2AafRzzfk","name":"Proxy LiteLLM"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[2000,260],"id":"6a6ab82b-99f8-47fb-9362-79a8ed6a4bdb","name":"Structured Output Parser"}],"connections":{"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Qdrant Vector Store","type":"ai_document","index":0}]]},"HTTP Request":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"When clicking ‘Test workflow’":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Split Out":{"main":[[{"node":"Qdrant Vector Store","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Window Buffer Memory":{"ai_memory":[[{"node":"AI Agent1","type":"ai_memory","index":0}]]},"Qdrant Vector Store1":{"ai_tool":[[{"node":"AI Agent1","type":"ai_tool","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Qdrant Vector Store1","type":"ai_embedding","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"AI Agent1","type":"ai_outputParser","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"25d05368-5035-424c-b9ed-aad15ee35150","triggerCount":0,"tags":[]}